/*
 * Tipped - The jQuery Tooltip - v3.1.8
 * (c) 2010-2013 Nick Stakenburg
 *
 * http://projects.nickstakenburg.com/tipped
 *
 * License: http://projects.nickstakenburg.com/tipped/license
 */
var Tipped={version:"3.1.8"};Tipped.Skins={base:{afterUpdate:false,ajax:{cache:true,type:"get"},background:{color:"#f2f2f2",opacity:1},border:{size:1,color:"#000",opacity:1},closeButtonSkin:"default",containment:{selector:"viewport"},fadeIn:180,fadeOut:220,showDelay:75,hideDelay:25,radius:{size:5,position:"background"},hideAfter:false,hideOn:{element:"self",event:"mouseleave"},hideOthers:false,hook:"topleft",inline:false,offset:{x:0,y:0},onHide:false,onShow:false,shadow:{blur:2,color:"#000",offset:{x:0,y:0},opacity:0.12},showOn:"mousemove",spinner:true,stem:{height:9,width:18,offset:{x:9,y:9},spacing:2},target:"self"},reset:{ajax:false,closeButton:false,hideOn:[{element:"self",event:"mouseleave"},{element:"tooltip",event:"mouseleave"}],hook:"topmiddle",stem:true},dark:{background:{color:"#282828"},border:{color:"#9b9b9b",opacity:0.4,size:1},shadow:{opacity:0.02},spinner:{color:"#fff"}},light:{background:{color:"#fff"},border:{color:"#646464",opacity:0.4,size:1},shadow:{opacity:0.04}},gray:{background:{color:[{position:0,color:"#8f8f8f"},{position:1,color:"#808080"}]},border:{color:"#131313",size:1,opacity:0.6}},tiny:{background:{color:"#161616"},border:{color:"#969696",opacity:0.35,size:1},fadeIn:0,fadeOut:0,radius:4,stem:{width:11,height:6,offset:{x:6,y:6}},shadow:false,spinner:{color:"#fff"}},yellow:{background:"#ffffaa",border:{size:1,color:"#6d5208",opacity:0.4}},red:{background:{color:[{position:0,color:"#e13c37"},{position:1,color:"#e13c37"}]},border:{size:1,color:"#150201",opacity:0.6},spinner:{color:"#fff"}},green:{background:{color:[{position:0,color:"#4bb638"},{position:1,color:"#4aab3a"}]},border:{size:1,color:"#122703",opacity:0.6},spinner:{color:"#fff"}},blue:{background:{color:[{position:0,color:"#4588c8"},{position:1,color:"#3d7cb9"}]},border:{color:"#020b17",opacity:0.6},spinner:{color:"#fff"}}};(function(b){b.extend(Tipped.Skins,{black:b.extend(true,{},Tipped.Skins.dark,{radius:0}),white:b.extend(true,{},Tipped.Skins.light,{radius:0})})})(jQuery);Tipped.Skins.CloseButtons={base:{diameter:17,border:2,x:{diameter:10,size:2,opacity:1},states:{"default":{background:{color:[{position:0,color:"#1a1a1a"},{position:0.46,color:"#171717"},{position:0.53,color:"#121212"},{position:0.54,color:"#101010"},{position:1,color:"#000"}],opacity:1},x:{color:"#fafafa",opacity:1},border:{color:"#fff",opacity:1}},hover:{background:{color:"#333",opacity:1},x:{color:"#e6e6e6",opacity:1},border:{color:"#fff",opacity:1}}},shadow:{blur:1,color:"#000",offset:{x:0,y:0},opacity:0.5}},reset:{},"default":{},light:{diameter:17,border:2,x:{diameter:10,size:2,opacity:1},states:{"default":{background:{color:[{position:0,color:"#797979"},{position:0.48,color:"#717171"},{position:0.52,color:"#666"},{position:1,color:"#666"}],opacity:1},x:{color:"#fff",opacity:0.95},border:{color:"#676767",opacity:1}},hover:{background:{color:[{position:0,color:"#868686"},{position:0.48,color:"#7f7f7f"},{position:0.52,color:"#757575"},{position:1,color:"#757575"}],opacity:1},x:{color:"#fff",opacity:1},border:{color:"#767676",opacity:1}}}}};eval(function(k,a,c,o,m,n){m=function(b){return(b<a?"":m(parseInt(b/a)))+((b=b%a)>35?String.fromCharCode(b+29):b.toString(36))};if(!"".replace(/^/,String)){while(c--){n[m(c)]=o[c]||m(c)}o=[function(b){return n[b]}];m=function(){return"\\w+"};c=1}while(c--){if(o[c]){k=k.replace(new RegExp("\\b"+m(c)+"\\b","g"),o[c])}}return k}('(12(a){12 c(a,b){13 c=[a,b];1a c.15=a,c.17=b,c}12 f(a){1N.5v&&5v[5v.6z?"6z":"8c"](a)}12 j(a){11.1g=a}12 k(a){13 b={};28(13 c 5w a)b[c]=a[c]+"2w";1a b}12 l(a,b){1a 1b.8d(a*a+b*b)}12 m(a){1a 2E*a/1b.2Z}12 n(a){1a a*1b.2Z/2E}12 o(a){1a 1/1b.4A(a)}12 v(b){1f(b){11.1g=b,u.1z(b);13 c=11.2e();11.19=a.1k({},c.19),11.2x=1,11.1o={},11.1V=a(b).1X("2p-1V"),u.30(11),11.29=11.19.1u.1D,11.6A=11.19.1l&&11.29,11.3a={x:0,y:0},11.3l={17:0,15:0},11.1P()}}12 x(b,c){11.1g=b,11.1g&&c&&(11.19=a.1k({31:3,1A:{x:0,y:0},1Q:"#4B",1K:.5,2L:1},20[2]||{}),11.2x=11.19.2L,11.1o={},11.1V=a(b).1X("2p-1V"),w.30(11),11.1P())}12 z(b){11.1g=b,11.1g&&(11.19=a.1k({31:5,1A:{x:0,y:0},1Q:"#4B",1K:.5,2L:1},20[1]||{}),11.2x=11.19.2L,11.1V=a(b).1X("2p-1V"),y.30(11),11.1P())}12 A(b,c){28(13 d 5w c)c[d]&&c[d].3D&&c[d].3D===5x?(b[d]=a.1k({},b[d])||{},A(b[d],c[d])):b[d]=c[d];1a b}12 C(b,c){1f(11.1g=b,11.1g){13 e=a(b).1X("2p-1V");e&&B.1z(b),e=h(),a(b).1X("2p-1V",e),11.1V=e;13 f;"8e"!=a.1p(c)||d.2j(c)?f=20[2]||{}:(f=c,c=1r),11.19=B.6B(f);13 g=b.6C("5y");1f(!c){13 i=b.6C("1X-2p");i?c=i:g&&(c=g)}g&&(a(b).1X("5z",g),b.8f("5y","")),11.2F=c,11.2k=11.19.2k||+B.19.4C,11.1o={2G:{14:1,18:1},5A:[],3b:[],2q:{4D:!1,2l:!1,1L:!1,3c:!1,1P:!1,4E:!1,5B:!1,3E:!1},5C:""};13 j=11.19.1C;11.1C="2M"==j?"2M":"4F"!=j&&j?d.2j(j)?j:j&&1x.6D(j)||11.1g:11.1g,11.6E(),B.30(11)}}13 b=6F.3F.8g,d={8h:12(c,d){13 e=c;1a 12(){13 c=[a.1v(e,11)].6G(b.5D(20));1a d.5E(11,c)}},2j:12(a){1a a&&1==a.8i},4G:12(a,c){13 d=b.5D(20,2);1a 8j(12(){1a a.5E(a,d)},c)},44:12(a){1a d.4G.5E(11,[a,1].6G(b.5D(20,1)))},5F:12(a){1a{x:a.5G,y:a.6H}},1g:{4H:12(a){13 b=0,d=0;8k b+=a.4I||0,d+=a.4J||0,a=a.4K;8l(a);1a c(d,b)},4L:12(b){13 e=a(b).1A(),f=d.1g.4H(b),g={17:a(1N).4I(),15:a(1N).4J()};1a e.15+=f.15-g.15,e.17+=f.17-g.17,c(e.15,e.17)},5H:12(){12 a(a){28(13 b=a;b&&b.4K;)b=b.4K;1a b}1a 12(b){13 c=a(b);1a!(!c||!c.3d)}}()}},e=12(a){12 b(b){13 c=5I(b+"([\\\\d.]+)").8m(a);1a c?5J(c[1]):!0}1a{3m:!(!1N.8n||-1!==a.3n("5K"))&&b("8o "),5K:a.3n("5K")>-1&&(!!1N.5L&&5L.6I&&5J(5L.6I())||7.55),5M:a.3n("6J/")>-1&&b("6J/"),4M:a.3n("4M")>-1&&-1===a.3n("8p")&&b("8q:"),6K:!!a.3e(/8r.*8s.*8t/),4N:a.3n("4N")>-1&&b("4N/")}}(8u.8v),g={32:{46:{5N:"1.4.4",5O:1N.46&&46.8w.8x}},6L:12(){12 b(b){28(13 c=b.3e(a),d=c&&c[1]&&c[1].2N(".")||[],e=0,f=0,g=d.2a;g>f;f++)e+=2O(d[f]*1b.6M(10,6-2*f));1a c&&c[3]?e-1:e}13 a=/^(\\d+(\\.?\\d+){0,3})([A-6N-8y-]+[A-6N-8z-9]+)?/;1a 12(a){11.32[a].6O||(11.32[a].6O=!0,(!11.32[a].5O||b(11.32[a].5O)<b(11.32[a].5N)&&!11.32[a].6P)&&(11.32[a].6P=!0,f("1S 8A "+a+" >= "+11.32[a].5N)))}}()},h=12(){13 a=0,b="8B";1a 12(c){28(c=c||b,a++;1x.6D(c+a);)a++;1a c+a}}(),i=12(){13 b=[];1a{1t:12(c){28(13 d=1r,e=0;b.2a>e;e++)b[e]&&b[e].47==c.47&&b[e].1p.6Q()==c.1p.6Q()&&a.6R(b[e].1X||{})==a.6R(c.1X||{})&&(d=b[e].4O);1a d},4P:12(c,d){11.1z(c.47),b.2n(a.1k({},c,{4O:d}))},1z:12(a){28(13 c=0;b.2a>c;c++)b[c]&&b[c].47==a&&3G b[c]},6S:12(){b=[]}}}();a.1k(1S,12(){1a{2H:{3f:12(){13 a=1x.22("3f");1a!(!a.3o||!a.3o("2d"))}(),3H:12(){6T{1a!!("8C"5w 1N||1N.6U&&1x 8D 6U)}6V(a){1a!1}}(),48:12(){13 b=["8E","8F","8G"],c=!1;1a a.1w(b,12(a,b){6T{1x.8H(b),c=!0}6V(d){}}),c}()},3p:12(){(11.2H.3f||e.3m)&&(g.6L("46"),a(1x).6W(12(){B.6X()}))},4Q:12(a,b,c){1a j.4Q(a,b,c),11.1t(a)},1t:12(a){1a 3q j(a)},5P:12(a){1a B.5P(a)},1W:12(a){1a 11.1t(a).1W(),11},1I:12(a){1a 11.1t(a).1I(),11},33:12(a){1a 11.1t(a).33(),11},2P:12(a){1a 11.1t(a).2P(),11},1z:12(a){1a 11.1t(a).1z(),11},4R:12(){1a B.4R(),11},5Q:12(a){1a B.5Q(a),11},5R:12(a){1a B.5R(a),11},1L:12(b){1f(d.2j(b))1a B.5S(b);1f("5T"!=a.1p(b)){13 c=a(b),e=0;1a a.1w(c,12(a,b){B.5S(b)&&e++}),e}1a B.3I().2a},5U:12(){1a B.5U(),11}}}()),a.1k(j,{4Q:12(b,c){1f(b){13 e=20[2]||{},f=[];1a B.6Y(),d.2j(b)?f.2n(3q C(b,c,e)):a(b).1w(12(a,b){f.2n(3q C(b,c,e))}),f}}}),a.1k(j.3F,{49:12(){1a B.2r.4S={x:0,y:0},B.1t(11.1g)},1W:12(){1a a.1w(11.49(),12(a,b){b.1W()}),11},1I:12(){1a a.1w(11.49(),12(a,b){b.1I()}),11},33:12(){1a a.1w(11.49(),12(a,b){b.33()}),11},2P:12(){1a a.1w(11.49(),12(a,b){b.2P()}),11},1z:12(){1a B.1z(11.1g),11}});13 p={4T:12(){13 b;1a b=e.6K?{14:1N.5V,18:1N.5W}:{18:a(1N).18(),14:a(1N).14()}}},q={3r:1b.1E(1b.4U(1N.3r?5J(1N.3r)||1:1,2)),3p:12(){12 a(a){13 b=a.3o("2d");b.8I(q.3r,q.3r)}1a 1N.4V&&!1S.2H.3f&&e.3m?12(b){4V.8J(b),a(b)}:12(b){a(b)}}(),3J:12(b,c){a(b).3g({14:c.14*11.3r,18:c.18*11.3r}).1q(k(c))},6Z:12(b){13 c=a.1k({17:0,15:0,14:0,18:0,1n:0},20[1]||{}),d=c,e=d.15,f=d.17,g=d.14,h=d.18,i=d.1n;1a i?(b.2f(),b.3s(e+i,f),b.26(e+g-i,f+i,i,n(-90),n(0),!1),b.26(e+g-i,f+h-i,i,n(0),n(90),!1),b.26(e+i,f+h-i,i,n(90),n(2E),!1),b.26(e+i,f+i,i,n(-2E),n(-90),!1),b.2g(),b.34(),3t 0):(b.70(e,f,g,h),3t 0)},8K:12(b,c){28(13 d=a.1k({x:0,y:0,1Q:"#4B"},20[2]||{}),e=0,f=c.2a;f>e;e++)28(13 g=0,h=c[e].2a;h>g;g++){13 i=2O(c[e].3u(g))*(1/9);b.2Q=t.2R(d.1Q,i),i&&b.70(d.x+g,d.y+e,1,1)}},4a:12(b,c){13 d;1f("2s"==a.1p(c))d=t.2R(c);1G 1f("2s"==a.1p(c.1Q))d=t.2R(c.1Q,"2y"==a.1p(c.1K)?c.1K:1);1G 1f(a.71(c.1Q)){13 e=a.1k({3K:0,3L:0,3M:0,3N:0},20[2]||{});d=q.72.73(b.8L(e.3K,e.3L,e.3M,e.3N),c.1Q,c.1K)}1a d}};q.72={73:12(b,c){28(13 d="2y"==a.1p(20[2])?20[2]:1,e=0,f=c.2a;f>e;e++){13 g=c[e];("5T"==a.1p(g.1K)||"2y"!=a.1p(g.1K))&&(g.1K=1),b.8M(g.1e,t.2R(g.1Q,g.1K*d))}1a b}};13 r={74:["3O","4b","3P","3Q","4c","4d","4e","4f","4g","4h","4i","3R"],4j:{75:/^(17|15|1R|1O)(17|15|1R|1O|2t|2S)$/,1J:/^(17|1R)/,35:/(2t|2S)/,76:/^(17|1R|15|1O)/},77:12(){13 a={17:"18",15:"14",1R:"18",1O:"14"};1a 12(b){1a a[b]}}(),35:12(a){1a!!a.3v().3e(11.4j.35)},78:12(a){1a!11.35(a)},2I:12(a){1a a.3v().3e(11.4j.1J)?"1J":"2b"},5X:12(a){13 b=1r,c=a.3v().3e(11.4j.76);1a c&&c[1]&&(b=c[1]),b},2N:12(a){1a a.3v().3e(11.4j.75)}},s={5Y:12(a){13 b=a.19.1l;1a{14:b.14,18:b.18}},4k:12(b,c){13 d=a.1k({3S:"1E"},20[2]||{}),e=b.19.1l,f=e.14,g=e.18,h=11.4W(f,g,c);1a d.3S&&(h.14=1b[d.3S](h.14),h.18=1b[d.3S](h.18)),{14:h.14,18:h.18}},4W:12(a,b,c){13 d=m(1b.79(.5*(b/a))),e=2E-d,f=1b.4A(n(e-90))*c,g=a+2*f,h=g*b/a;1a{14:g,18:h}},3T:12(a,b){13 c=11.4k(a,b),d=11.5Y(a),f=(r.35(a.29),1b.1E(c.18+b));1a a.19.1l.1A||0,a.19.1n&&a.19.1n.2u||0,{2z:{1c:{14:1b.1E(c.14),18:1b.1E(f)}},1i:{1c:c},1l:{1c:{14:d.14,18:d.18}}}},5Z:12(b,c,d){13 f=b.19,g={17:0,15:0},h={17:0,15:0},i=a.1k({},c),j=b.1i,k=k||11.3T(b,b.1i),l=k.2z.1c;d&&(l.18=d,j=0);13 m=r.2N(b.29),n=r.2I(b.29);1f(b.19.1l){13 o=r.5X(b.29);1f("17"==o?g.17=l.18-j:"15"==o&&(g.15=l.18-j),"1J"==n){1T(m[2]){1h"2t":1h"2S":h.15=.5*i.14;1B;1h"1O":h.15=i.14}"1R"==m[1]&&(h.17=i.18-j+l.18)}1G{1T(m[2]){1h"2t":1h"2S":h.17=.5*i.18;1B;1h"1R":h.17=i.18}"1O"==m[1]&&(h.15=i.14-j+l.18)}i[r.77(o)]+=l.18-j}1G 1f("1J"==n){1T(m[2]){1h"2t":1h"2S":h.15=.5*i.14;1B;1h"1O":h.15=i.14}"1R"==m[1]&&(h.17=i.18)}1G{1T(m[2]){1h"2t":1h"2S":h.17=.5*i.18;1B;1h"1R":h.17=i.18}"1O"==m[1]&&(h.15=i.14)}13 p=f.1n&&f.1n.2u||0,q=f.1i&&f.1i.2u||0;1f(b.19.1l){13 t=p&&"1m"==f.1n.1e?p:0,u=p&&"1i"==f.1n.1e?p:p+q,v=q+t+.5*k.1l.1c.14-.5*k.1i.1c.14,w=u>v?u-v:0,x=1b.1E(q+t+.5*k.1l.1c.14+w);1f("1J"==n)1T(m[2]){1h"15":h.15+=x;1B;1h"1O":h.15-=x}1G 1T(m[2]){1h"17":h.17+=x;1B;1h"1R":h.17-=x}}13 y;1f(f.1l&&(y=f.1l.1A)){13 z=s.60(y,b.6A,c,k.1i.1c,q,p);1f(y=z.1A,z.4l,"1J"==n)1T(m[2]){1h"15":h.15+=y.x;1B;1h"1O":h.15-=y.x}1G 1T(m[2]){1h"17":h.17+=y.y;1B;1h"1R":h.17-=y.y}}13 B;1f(f.1l&&(B=f.1l.8N))1f("1J"==n)1T(m[1]){1h"17":h.17-=B;1B;1h"1R":h.17+=B}1G 1T(m[1]){1h"15":h.15-=B;1B;1h"1O":h.15+=B}1a{1c:i,1e:{17:0,15:0},1m:{1e:g,1c:c},1l:{1c:l},2J:h}},60:12(b,c,d,e,f,g){13 h=r.2I(c),i=a.1k({},b),j={x:0,y:0},k=0;1a"1J"==h&&(k=d.14-e.14-2*f-2*g)<2*b.x&&(j.x=i.x,/(1O)$/.3h(c)&&(j.x*=-1),i.x=0),"2b"==h&&(k=d.18-e.18-2*f-2*g)<2*b.y&&(j.y=i.y,/(1R)$/.3h(c)&&(j.y*=-1),i.y=0),{1A:i,4l:j}}},t=12(){12 d(a){13 b=a;1a b.7a=a[0],b.7b=a[1],b.7c=a[2],b}12 e(a){1a 2O(a,16)}12 f(a){13 b=6F(3);1f(0==a.3n("#")&&(a=a.4X(1)),a=a.3v(),""!=a.61(c,""))1a 1r;3==a.2a?(b[0]=a.3u(0)+a.3u(0),b[1]=a.3u(1)+a.3u(1),b[2]=a.3u(2)+a.3u(2)):(b[0]=a.4X(0,2),b[1]=a.4X(2,4),b[2]=a.4X(4));28(13 f=0;b.2a>f;f++)b[f]=e(b[f]);1a d(b)}12 g(a,b){13 c=f(a);1a c[3]=b,c.1K=b,c}12 h(b,c){1a"5T"==a.1p(c)&&(c=1),"8O("+g(b,c).8P()+")"}12 i(a){1a"#"+(j(a)[2]>50?"4B":"8Q")}12 j(a){1a k(f(a))}12 k(a){13 f,g,h,a=d(a),b=a.7a,c=a.7b,e=a.7c,i=b>c?b:c;e>i&&(i=e);13 j=c>b?b:c;1f(j>e&&(j=e),h=i/8R,g=0!=i?(i-j)/i:0,0==g)f=0;1G{13 k=(i-b)/(i-j),l=(i-c)/(i-j),m=(i-e)/(i-j);f=b==i?m-l:c==i?2+k-m:4+l-k,f/=6,0>f&&(f+=1)}f=1b.23(7d*f),g=1b.23(62*g),h=1b.23(62*h);13 n=[];1a n[0]=f,n[1]=g,n[2]=h,n.8S=f,n.8T=g,n.8U=h,n}13 b="8V",c=5I("["+b+"]","g");1a{8W:f,2R:h,8X:i}}(),u={4Y:{},1t:12(b){1f(!b)1a 1r;13 c=1r,d=a(b).1X("2p-1V");1a d&&(c=11.4Y[d]),c},30:12(a){11.4Y[a.1V]=a},1z:12(a){13 b=11.1t(a);b&&(3G 11.4Y[b.1V],b.1z())}};a.1k(v.3F,12(){12 b(){11.1o.1u={};13 b=11.29;a.1w(r.74,a.1v(12(b,c){13 d,e=11.1o.1u[c]={};11.29=c;13 f=11.2o();d=f,e.2J=d.2J;13 g=d.1H.1c,h={17:d.1H.1e.17,15:d.1H.1e.15};1f(e.1H={1c:g,1e:h},e.1D={1c:d.21.1c},11.1s){13 i=11.1s.2o(),j=i.21.1e,k=e.1H.1e;a.1k(!0,e,{2J:i.2J,1H:{1e:{17:k.17+j.17,15:k.15+j.15}},1D:{1c:i.1D.1c}})}},11)),11.29=b}12 c(){11.36(),11.19.1s&&(w.1z(11.1g),11.19.1y&&11.19.1y.1s&&y.1z(11.1g)),11.2T&&(11.2T.1z(),11.2T=1r),11.1j&&(a(11.1j).1z(),11.1j=1r)}12 d(){11.1H&&(11.1y&&(a(11.1y).1z(),11.1y=1r,11.63=1r,11.64=1r),a(11.1H).1z(),11.1l=1r,11.1m=1r,11.1H=1r,11.1o={})}12 f(){13 a=11.2e();11.2G=a.1o.2G;13 b=a.19;11.1n=b.1n&&b.1n.2u||0,11.1i=b.1i&&b.1i.2u||0,11.2m=b.2m;13 c=1b.4U(11.2G.18,11.2G.14);11.1n>c/2&&(11.1n=1b.65(c/2)),"1i"==11.19.1n.1e&&11.1n>11.1i&&(11.1i=11.1n),11.1o={19:{1n:11.1n,1i:11.1i,2m:11.2m}}}12 g(){11.36(),1N.4V&&1N.4V.8Y(1x);13 b=11.2e(),c=11.19;11.1H=a("<2h>").1Y("8Z")[0],a(b.4Z).1Z(11.1H),11.51(),11.7e(b),c.1y&&(11.7f(b),c.1y.1s&&(11.2U?(11.2U.19=c.1y.1s,11.2U.1P()):11.2U=3q z(11.1g,a.1k({2L:11.2x},c.1y.1s)))),e.3m&&7>e.3m&&a(b.1j).66(11.2T=a("<91>").1Y("92").3g({93:0,4m:"94:\'\';"})),11.52(),c.1s&&(11.1s?(11.1s.19=c.1s,11.1s.1P()):11.1s=3q x(11.1g,11,a.1k({2L:11.2x},c.1s))),11.7g()}12 h(){13 b=11.2e(),c=a(b.1j),d=a(b.1j).67(".7h").7i()[0];1f(d){a(d).1q({14:"68",18:"68"});13 e=2O(c.1q("17")),f=2O(c.1q("15")),g=2O(c.1q("14"));c.1q({15:"-7j",17:"-7j",14:"95",18:"68"}),b.1F("1L")||a(b.1j).1W();13 h=B.53.69(d);b.19.3i&&"2y"==a.1p(b.19.3i)&&h.14>b.19.3i&&(a(d).1q({14:b.19.3i+"2w"}),h=B.53.69(d)),b.1F("1L")||a(b.1j).1I(),b.1o.2G=h,c.1q({15:f+"2w",17:e+"2w",14:g+"2w"}),11.1P()}}12 i(a,b,c){13 d=!1;11.4n(a)&&(d=!0),11.7k(b)&&(d=!0),c&&11.7l(c)&&(d=!0),d&&11.1P()}12 j(a){13 b=!1;1a(11.3l.15!=a.15||11.3l.17!=a.17)&&(b=!0,11.3l=a),b}12 l(a){13 b=!1;1a(11.3a.x!=a.x||11.3a.y!=a.y)&&(b=!0,11.3a=a),b}12 m(a){13 c=!1;1a 11.29!=a&&(c=!0,11.29=a),c}12 o(){1a B.1t(11.1g)[0]}12 p(){1a s.3T(11,11.1i)}12 u(){13 b=11.2e().19.1y,c=b.3w+2*b.1i;a(11.63).1q({15:-1*c+"2w"}),a(11.64).1q({15:0})}12 v(){13 b=11.2e().19.1y,c=b.3w+2*b.1i;a(11.63).1q({15:0}),a(11.64).1q({15:c+"2w"})}12 A(b){13 c=b.19.1y,d={14:c.3w+2*c.1i,18:c.3w+2*c.1i};a(b.1j).1Z(a(11.1y=1x.22("2h")).1Y("7m").1q(k(d)).1Z(a(11.7n=1x.22("2h")).1Y("96").1q(k(d)))),11.6a(b,"6b"),11.6a(b,"6c"),1S.2H.3H||e.4N||a(11.1y).3U("4o",a.1v(11.7o,11)).3U("54",a.1v(11.7p,11))}12 C(b,c){13 d=b.19.1y,e=d.3w,f=d.1i||0,g=d.x.3w,h=d.x.2u,j=(d.x.97,d.2q[c||"6b"]),l={14:e+2*f,18:e+2*f};g>=e&&(g=e-2);13 m;a(11.7n).1Z(a(11[c+"7q"]=1x.22("2h")).1Y("98").1q(a.1k(k(l),{15:("6c"==c?l.14:0)+"2w"}))),a(1x.3d).1Z(a(m=1x.22("3f"))),q.3J(m,l),q.3p(m);13 o=m.3o("2d");o.2L=11.2x,a(11[c+"7q"]).1Z(m),o.99(l.14/2,l.18/2),o.2Q=q.4a(o,j.1m,{3K:0,3L:0-e/2,3M:0,3N:0+e/2}),o.2f(),o.26(0,0,e/2,0,2*1b.2Z,!0),o.2g(),o.34(),f&&(o.2Q=q.4a(o,j.1i,{3K:0,3L:0-e/2-f,3M:0,3N:0+e/2+f}),o.2f(),o.26(0,0,e/2,1b.2Z,0,!1),o.1d((e+f)/2,0),o.26(0,0,e/2+f,0,1b.2Z,!0),o.26(0,0,e/2+f,1b.2Z,0,!0),o.1d(e/2,0),o.26(0,0,e/2,0,1b.2Z,!1),o.2g(),o.34());13 p=g/2,r=h/2;1f(r>p){13 s=r;r=p,p=s}o.2Q=t.2R(j.x.1Q||j.x,j.x.1K||1),o.56(n(45)),o.2f(),o.3s(0,0),o.1d(0,p);28(13 u=0;4>u;u++)o.1d(0,p),o.1d(r,p),o.1d(r,p-(p-r)),o.1d(p,r),o.1d(p,0),o.56(n(90));o.2g(),o.34()}12 D(b){13 l,m,o,p,q,c=a.1k({1l:!1,3x:1r,9a:1r,2f:!1,2g:!1,3y:1r,3z:1r,1n:0,1i:0,57:0,37:{x:0,y:0}},20[1]||{}),d=c.3y,e=c.3z,f=c.37,g=c.1i,h=c.1n,i=c.3x,j=d.1m.1e,k=d.1m.1c,t={x:1b.2V(11.3a.x),y:1b.2V(11.3a.y)},u={x:0,y:0},v={x:0,y:0};1f(e){l=e.1l.1c,m=e.2z.1e,o=e.2z.1c,p=o.14-l.14;13 w=c.57,x=g+h+.5*l.14-.5*e.1i.1c.14;q=1b.1E(w>x?w-x:0);13 y=s.60(f,i,k,e.1i.1c,g,h);f=y.1A,v=y.4l,u={x:1b.1U(k.14-2*1b.1U(q,f.x||0)-e.1i.1c.14-(2*h||0),0),y:1b.1U(k.18-2*1b.1U(q,f.y||0)-e.1i.1c.18-(2*h||0),0)},r.35(i)&&(u.x*=.5,u.y*=.5),t.x=1b.4U(t.x,u.x),t.y=1b.4U(t.y,u.y),r.35(i)&&(0>11.3a.x&&t.x>0&&(t.x*=-1),0>11.3a.y&&t.y>0&&(t.y*=-1)),11.3l&&11.3l.3A&&a.1w(11.3l.3A,12(b,c){a.1w("17 1O 1R 15".2N(" "),12(a,b){c==b&&5I("("+b+")$").3h(i)&&(t[/^(15|1O)$/.3h(b)?"x":"y"]=0)})})}13 z,A;1f(h?(z=j.15+g+h,A=j.17+g):(z=j.15+g,A=j.17+g),f&&f.x&&/^(3O|3R)$/.3h(i)&&(z+=f.x),c.2f&&b.2f(),b.3s(z,A),c.1l)1T(i){1h"3O":z=j.15+g,h&&(z+=h),z+=1b.1U(q,f.x||0),z+=t.x,b.1d(z,A),A-=l.18,z+=.5*l.14,b.1d(z,A),A+=l.18,z+=.5*l.14,b.1d(z,A);1B;1h"4b":1h"58":z=j.15+.5*k.14-.5*l.14,z+=t.x,b.1d(z,A),A-=l.18,z+=.5*l.14,b.1d(z,A),A+=l.18,z+=.5*l.14,b.1d(z,A),z=j.15+.5*k.14-.5*o.14,b.1d(z,A);1B;1h"3P":z=j.15+k.14-g-l.14,h&&(z-=h),z-=1b.1U(q,f.x||0),z-=t.x,b.1d(z,A),A-=l.18,z+=.5*l.14,b.1d(z,A),A+=l.18,z+=.5*l.14,b.1d(z,A)}1f(h?h&&(b.26(j.15+k.14-g-h,j.17+g+h,h,n(-90),n(0),!1),z=j.15+k.14-g,A=j.17+g+h):(z=j.15+k.14-g,A=j.17+g,b.1d(z,A)),c.1l)1T(i){1h"3Q":A=j.17+g,h&&(A+=h),A+=1b.1U(q,f.y||0),A+=t.y,b.1d(z,A),z+=l.18,A+=.5*l.14,b.1d(z,A),z-=l.18,A+=.5*l.14,b.1d(z,A);1B;1h"4c":1h"59":A=j.17+.5*k.18-.5*l.14,A+=t.y,b.1d(z,A),z+=l.18,A+=.5*l.14,b.1d(z,A),z-=l.18,A+=.5*l.14,b.1d(z,A);1B;1h"4d":A=j.17+k.18-g,h&&(A-=h),A-=l.14,A-=1b.1U(q,f.y||0),A-=t.y,b.1d(z,A),z+=l.18,A+=.5*l.14,b.1d(z,A),z-=l.18,A+=.5*l.14,b.1d(z,A)}1f(h?h&&(b.26(j.15+k.14-g-h,j.17+k.18-g-h,h,n(0),n(90),!1),z=j.15+k.14-g-h,A=j.17+k.18-g):(z=j.15+k.14-g,A=j.17+k.18-g,b.1d(z,A)),c.1l)1T(i){1h"4e":z=j.15+k.14-g,h&&(z-=h),z-=1b.1U(q,f.x||0),z-=t.x,b.1d(z,A),z-=.5*l.14,A+=l.18,b.1d(z,A),z-=.5*l.14,A-=l.18,b.1d(z,A);1B;1h"4f":1h"5a":z=j.15+.5*k.14+.5*l.14,z+=t.x,b.1d(z,A),z-=.5*l.14,A+=l.18,b.1d(z,A),z-=.5*l.14,A-=l.18,b.1d(z,A);1B;1h"4g":z=j.15+g+l.14,h&&(z+=h),z+=1b.1U(q,f.x||0),z+=t.x,b.1d(z,A),z-=.5*l.14,A+=l.18,b.1d(z,A),z-=.5*l.14,A-=l.18,b.1d(z,A)}1f(h?h&&(b.26(j.15+g+h,j.17+k.18-g-h,h,n(90),n(2E),!1),z=j.15+g,A=j.17+k.18-g-h):(z=j.15+g,A=j.17+k.18-g,b.1d(z,A)),c.1l)1T(i){1h"4h":A=j.17+k.18-g,h&&(A-=h),A-=1b.1U(q,f.y||0),A-=t.y,b.1d(z,A),z-=l.18,A-=.5*l.14,b.1d(z,A),z+=l.18,A-=.5*l.14,b.1d(z,A);1B;1h"4i":1h"5b":A=j.17+.5*k.18+.5*l.14,A+=t.y,b.1d(z,A),z-=l.18,A-=.5*l.14,b.1d(z,A),z+=l.18,A-=.5*l.14,b.1d(z,A);1B;1h"3R":A=j.17+g+l.14,h&&(A+=h),A+=1b.1U(q,f.y||0),A+=t.y,b.1d(z,A),z-=l.18,A-=.5*l.14,b.1d(z,A),z+=l.18,A-=.5*l.14,b.1d(z,A)}1a h?h&&(b.26(j.15+g+h,j.17+g+h,h,n(-2E),n(-90),!1),z=j.15+g+h,A=j.17+g,z+=1,b.1d(z,A)):(z=j.15+g,A=j.17+g,b.1d(z,A)),c.2g&&b.2g(),{x:z,y:A,1l:t,5c:v,37:f}}12 E(b){13 o,p,q,r,s,t,c=a.1k({1l:!1,3x:1r,2f:!1,2g:!1,3y:1r,3z:1r,1n:0,1i:0,7r:0,37:{x:0,y:0},5d:1r},20[1]||{}),d=c.3y,e=c.3z,g=(c.7r,c.37),h=c.1i,i=c.1n&&c.1n.2u||0,j=c.7s,k=c.3x,l=d.1m.1e,m=d.1m.1c,u=c.5d&&c.5d.1l||{x:0,y:0};1f(e){o=e.1l.1c,p=e.2z.1e,q=e.2z.1c,r=e.1i.1c,s=q.14-o.14;13 v=h+j+.5*o.14-.5*r.14;t=1b.1E(i>v?i-v:0)}13 w=l.15+h+j,x=l.17+h;j&&(w+=1),a.1k({},{x:w,y:x}),c.2f&&b.2f();13 z=a.1k({},{x:w,y:x});1f(x-=h,b.1d(w,x),i?i&&(b.26(l.15+i,l.17+i,i,n(-90),n(-2E),!0),w=l.15,x=l.17+i):(w=l.15,x=l.17,b.1d(w,x)),c.1l)1T(k){1h"3R":x=l.17+h,j&&(x+=j),x-=.5*r.14,x+=.5*o.14,x+=1b.1U(t,g.y||0),x+=u.y,b.1d(w,x),w-=r.18,x+=.5*r.14,b.1d(w,x),w+=r.18,x+=.5*r.14,b.1d(w,x);1B;1h"4i":1h"5b":x=l.17+.5*m.18-.5*r.14,x+=u.y,b.1d(w,x),w-=r.18,x+=.5*r.14,b.1d(w,x),w+=r.18,x+=.5*r.14,b.1d(w,x);1B;1h"4h":x=l.17+m.18-h-r.14,j&&(x-=j),x+=.5*r.14,x-=.5*o.14,x-=1b.1U(t,g.y||0),x-=u.y,b.1d(w,x),w-=r.18,x+=.5*r.14,b.1d(w,x),w+=r.18,x+=.5*r.14,b.1d(w,x)}1f(i?i&&(b.26(l.15+i,l.17+m.18-i,i,n(-2E),n(-9b),!0),w=l.15+i,x=l.17+m.18):(w=l.15,x=l.17+m.18,b.1d(w,x)),c.1l)1T(k){1h"4g":w=l.15+h,j&&(w+=j),w-=.5*r.14,w+=.5*o.14,w+=1b.1U(t,g.x||0),w+=u.x,b.1d(w,x),x+=r.18,w+=.5*r.14,b.1d(w,x),x-=r.18,w+=.5*r.14,b.1d(w,x);1B;1h"4f":1h"5a":w=l.15+.5*m.14-.5*r.14,w+=u.x,b.1d(w,x),x+=r.18,w+=.5*r.14,b.1d(w,x),x-=r.18,w+=.5*r.14,b.1d(w,x),w=l.15+.5*m.14+r.14,b.1d(w,x);1B;1h"4e":w=l.15+m.14-h-r.14,j&&(w-=j),w+=.5*r.14,w-=.5*o.14,w-=1b.1U(t,g.x||0),w-=u.x,b.1d(w,x),x+=r.18,w+=.5*r.14,b.1d(w,x),x-=r.18,w+=.5*r.14,b.1d(w,x)}1f(i?i&&(b.26(l.15+m.14-i,l.17+m.18-i,i,n(90),n(0),!0),w=l.15+m.14,x=l.17+m.14+i):(w=l.15+m.14,x=l.17+m.18,b.1d(w,x)),c.1l)1T(k){1h"4d":x=l.17+m.18-h,x+=.5*r.14,x-=.5*o.14,j&&(x-=j),x-=1b.1U(t,g.y||0),x-=u.y,b.1d(w,x),w+=r.18,x-=.5*r.14,b.1d(w,x),w-=r.18,x-=.5*r.14,b.1d(w,x);1B;1h"4c":1h"59":x=l.17+.5*m.18+.5*r.14,x+=u.y,b.1d(w,x),w+=r.18,x-=.5*r.14,b.1d(w,x),w-=r.18,x-=.5*r.14,b.1d(w,x);1B;1h"3Q":x=l.17+h,j&&(x+=j),x+=r.14,x-=.5*r.14-.5*o.14,x+=1b.1U(t,g.y||0),x+=u.y,b.1d(w,x),w+=r.18,x-=.5*r.14,b.1d(w,x),w-=r.18,x-=.5*r.14,b.1d(w,x)}1f(i?i&&(b.26(l.15+m.14-i,l.17+i,i,n(0),n(-90),!0),w=l.15+m.14-i,x=l.17):(w=l.15+m.14,x=l.17,b.1d(w,x)),c.1l)1T(k){1h"3P":w=l.15+m.14-h,w+=.5*r.14-.5*o.14,j&&(w-=j),w-=1b.1U(t,g.x||0),w-=u.x,b.1d(w,x),x-=r.18,w-=.5*r.14,b.1d(w,x),x+=r.18,w-=.5*r.14,b.1d(w,x);1B;1h"4b":1h"58":w=l.15+.5*m.14+.5*r.14,w+=u.x,b.1d(w,x),x-=r.18,w-=.5*r.14,b.1d(w,x),x+=r.18,w-=.5*r.14,b.1d(w,x),w=l.15+.5*m.14-r.14,b.1d(w,x),b.1d(w,x);1B;1h"3O":w=l.15+h+r.14,w-=.5*r.14,w+=.5*o.14,j&&(w+=j),w+=1b.1U(t,g.x||0),w+=u.x,b.1d(w,x),x-=r.18,w-=.5*r.14,b.1d(w,x),x+=r.18,w-=.5*r.14,b.1d(w,x)}b.1d(z.x,z.y-h),b.1d(z.x,z.y),c.2g&&b.2g()}12 F(b){13 c=11.2o(),d=11.19.1l&&11.4p(),e=11.29&&11.29.3v(),f=11.1n,h=11.1i,i=11.2m,k=({14:2*h+2*i+11.2G.14,18:2*h+2*i+11.2G.18},b.19.1l&&b.19.1l.1A||{x:0,y:0}),l=0,m=0;f&&(l="1m"==11.19.1n.1e?f:0,m="1i"==11.19.1n.1e?f:l+h),a(1x.3d).1Z(11.2W=1x.22("3f")),q.3J(11.2W,c.1H.1c),q.3p(11.2W);13 n=11.2W.3o("2d");n.2L=11.2x,a(11.1H).1Z(11.2W),n.2Q=q.4a(n,11.19.1m,{3K:0,3L:c.1m.1e.17+h,3M:0,3N:c.1m.1e.17+c.1m.1c.18-h}),n.9c=0;13 o;1f(o=11.6d(n,{2f:!0,2g:!0,1i:h,1n:l,57:m,3y:c,3z:d,1l:11.19.1l,3x:e,37:k}),n.34(),h){13 p=q.4a(n,11.19.1i,{3K:0,3L:c.1m.1e.17,3M:0,3N:c.1m.1e.17+c.1m.1c.18});n.2Q=p,o=11.6d(n,{2f:!0,2g:!1,1i:h,1n:l,57:m,3y:c,3z:d,1l:11.19.1l,3x:e,37:k}),11.7t(n,{2f:!1,2g:!0,1i:h,7s:l,1n:{2u:m,1e:11.19.1n.1e},3y:c,3z:d,1l:11.19.1l,3x:e,37:o.37,5d:o}),n.34()}11.3B=o}12 G(){13 i,a=11.2e(),b=11.2G,c=a.19,d=11.1n,f=11.1i,g=11.2m,h={14:2*f+2*g+b.14,18:2*f+2*g+b.18};1f(11.19.1l){13 j=11.4p();i=j.2z.1c}13 k=s.5Z(11,h),l=k.1c,m=k.1e,h=k.1m.1c,o=k.1m.1e;k.1l.1c;13 r,t,u,q={17:0,15:0},v={14:l.14,18:l.18};1f(c.1y){13 w=d;"1m"==c.1n.1e&&(w+=f);13 x=w-1b.9d(n(45))*w,y="1O";11.29.3v().3e(/^(3P|3Q)$/)&&(y="15");13 z=c.1y.3w+2*c.1y.1i,r={14:z,18:z};1f(q.15=o.15-z/2+("15"==y?x:h.14-x),q.17=o.17-z/2+x,"15"==y){1f(0>q.15){13 A=1b.2V(q.15);v.14+=A,m.15+=A,q.15=0}}1G{13 B=q.15+z-v.14;B>0&&(v.14+=B)}1f(0>q.17){13 C=1b.2V(q.17);v.18+=C,m.17+=C,q.17=0}1f(11.19.1y.1s){13 D=11.19.1y.1s,E=D.31,F=D.1A;1f(t={14:r.14+2*E,18:r.18+2*E},u={17:q.17-E+F.y,15:q.15-E+F.x},"15"==y){1f(0>u.15){13 A=1b.2V(u.15);v.14+=A,m.15+=A,q.15+=A,u.15=0}}1G{13 B=u.15+t.14-v.14;B>0&&(v.14+=B)}1f(0>u.17){13 C=1b.2V(u.17);v.18+=C,m.17+=C,q.17+=C,u.17=0}}}13 G=k.2J;G.17+=m.17,G.15+=m.15;13 H={15:1b.1E(m.15+o.15+11.1i+11.19.2m),17:1b.1E(m.17+o.17+11.1i+11.19.2m)},I={1D:{1c:{14:1b.1E(v.14),18:1b.1E(v.18)}},21:{1c:{14:1b.1E(v.14),18:1b.1E(v.18)}},1H:{1c:l,1e:{17:1b.23(m.17),15:1b.23(m.15)}},1m:{1c:{14:1b.1E(h.14),18:1b.1E(h.18)},1e:{17:1b.23(o.17),15:1b.23(o.15)}},2J:{17:1b.23(G.17),15:1b.23(G.15)},2F:{1e:H}};1a 11.19.1y&&(I.1y={1c:{14:1b.1E(r.14),18:1b.1E(r.18)},1e:{17:1b.23(q.17),15:1b.23(q.15)}},11.19.1y.1s&&(I.2U={1c:{14:1b.1E(t.14),18:1b.1E(t.18)},1e:{17:1b.23(u.17),15:1b.23(u.15)}})),I}12 H(){13 b=11.2o(),c=11.2e();a(c.1j).1q(k(b.1D.1c)),a(c.4Z).1q(k(b.21.1c)),11.2T&&11.2T.1q(k(b.1D.1c)),a(11.1H).1q(a.1k(k(b.1H.1c),k(b.1H.1e))),11.1y&&(a(11.1y).1q(k(b.1y.1e)),b.2U&&a(11.2U.1j).1q(k(b.2U.1e))),a(c.38).1q(k(b.2F.1e))}12 I(a){11.2x=a||0,11.1s&&(11.1s.2x=11.2x)}12 J(a){11.7u(a),11.1P()}1a{51:f,7g:b,1P:g,1z:c,36:d,2e:o,2P:h,5e:i,7l:j,7k:l,4n:m,7f:A,6a:C,7e:F,6d:D,7t:E,7o:u,7p:v,4p:p,2o:G,52:H,7u:I,9e:J}}());13 w={3j:{},1t:12(b){1f(!b)1a 1r;13 c=1r,d=a(b).1X("2p-1V");1a d&&(c=11.3j[d]),c},30:12(a){11.3j[a.1V]=a},1z:12(a){13 b=11.1t(a);b&&(3G 11.3j[b.1V],b.1z())},4q:12(a){1a 1b.2Z/2-1b.6M(a,1b.4A(a)*1b.2Z)}};w.4r={4k:12(a,b){13 c=u.1t(a.1g),d=c.4p().1i.1c,e=11.4W(d.14,d.18,b,{3S:!1});1a{14:e.14,18:e.18}},9f:12(a,b,c){13 d=.5*a,e=m(1b.9g(d/l(d,b))),f=2E-e-90,g=o(n(f))*c,h=2*(d+g),i=h/a*b;1a{14:h,18:i}},4W:12(a,b,c){13 d=m(1b.79(.5*(b/a))),e=2E-d,f=1b.4A(n(e-90))*c,g=a+2*f,h=g*b/a;1a{14:g,18:h}},3T:12(b){13 c=u.1t(b.1g),d=b.19.31,e=r.78(c.29),g=(r.2I(c.29),w.4r.4k(b,d)),h={2z:{1c:{14:1b.1E(g.14),18:1b.1E(g.18)},1e:{17:0,15:0}}};1f(d){h.2X=[];28(13 i=0;d>=i;i++){13 j=w.4r.4k(b,i,{3S:!1}),k={1e:{17:h.2z.1c.18-j.18,15:e?d-i:(h.2z.1c.14-j.14)/2},1c:j};h.2X.2n(k)}}1G h.2X=[a.1k({},h.2z)];1a h},56:12(a,b,c){s.56(a,b.3k(),c)}},a.1k(x.3F,12(){12 b(){1a B.1t(11.1g)[0]}12 c(){1a u.1t(11.1g)}12 d(){11.36()}12 e(){11.1j&&(a(11.1j).1z(),11.1l=1r,11.1m=1r,11.1H=1r,11.1j=1r,11.1o={})}12 f(){}12 g(){11.36(),11.51();13 b=11.2e(),c=11.3k();11.1j=a("<2h>").1Y("9h")[0],a(b.1j).66(11.1j),c.2T&&a(b.1j).66(c.2T),c.2o(),a(11.1j).1q({17:0,15:0}),11.7v(),11.52()}12 h(){1a 11.19.1K/(11.19.31+1)}12 i(){13 b=11.3k(),c=b.2o(),d=11.2e(),e=11.2o(),f=11.19.31,g=w.4r.3T(11),h=b.29,i=r.5X(h),j={17:f,15:f};1f(d.19.1l){13 l=g.2X[g.2X.2a-1];"15"==i&&(j.15+=1b.1E(l.1c.18)),"17"==i&&(j.17+=1b.1E(l.1c.18))}13 m=b.1o.19,n=m.1n,o=m.1i;"1m"==d.19.1n.1e&&n&&(n+=o);13 p=e.1H.1c;a(11.1j).1Z(a(11.1H=1x.22("2h")).1Y("9i").1q(k(p))).1q(k(p)),a(1x.3d).1Z(a(11.2W=1x.22("3f"))),q.3J(11.2W,e.1H.1c),q.3p(11.2W);13 s=11.2W.3o("2d");s.2L=11.2x,a(11.1H).1Z(11.2W);28(13 u=f+1,v=0;f>=v;v++)s.2Q=t.2R(11.19.1Q,w.4q(v*(1/u))*(11.19.1K/u)),q.6Z(s,{14:c.1m.1c.14+2*v,18:c.1m.1c.18+2*v,17:j.17-v,15:j.15-v,1n:n+v});1f(b.19.1l){13 x={x:j.15,y:j.17},y=g.2X[0].1c,z=b.19.1l,A=o;A+=.5*z.14;13 B=b.19.1n&&"1m"==b.19.1n.1e?b.19.1n.2u||0:0;B&&(A+=B);13 C=o+B+.5*z.14-.5*y.14,D=1b.1E(n>C?n-C:0),E=b.3B&&b.3B.1l||{x:0,y:0},F=b.3B&&b.3B.5c||{x:0,y:0};1f(A+=1b.1U(D,b.19.1l.1A&&b.19.1l.1A[i&&/^(15|1O)$/.3h(i)?"y":"x"]||0),"17"==i||"1R"==i){1T(h){1h"3O":1h"4g":x.x+=A+E.x-F.x;1B;1h"4b":1h"58":1h"4f":1h"5a":x.x+=.5*c.1m.1c.14+E.x;1B;1h"3P":1h"4e":x.x+=c.1m.1c.14-(A-E.x+F.x)}"1R"==i&&(x.y+=c.1m.1c.18);28(13 v=0,G=g.2X.2a;G>v;v++){s.2Q=t.2R(11.19.1Q,w.4q(v*(1/u))*(11.19.1K/u));13 f=g.2X[v];s.2f(),"17"==i?(s.3s(x.x,x.y-v),s.1d(x.x-.5*f.1c.14,x.y-v),s.1d(x.x,x.y-v-f.1c.18),s.1d(x.x+.5*f.1c.14,x.y-v)):(s.3s(x.x,x.y+v),s.1d(x.x-.5*f.1c.14,x.y+v),s.1d(x.x,x.y+v+f.1c.18),s.1d(x.x+.5*f.1c.14,x.y+v)),s.2g(),s.34()}}1G{1T(h){1h"3R":1h"3Q":x.y+=A+E.y-F.y;1B;1h"4i":1h"5b":1h"4c":1h"59":x.y+=.5*c.1m.1c.18+E.y;1B;1h"4h":1h"4d":x.y+=c.1m.1c.18-(A-E.y+F.y)}"1O"==i&&(x.x+=c.1m.1c.14);28(13 v=0,G=g.2X.2a;G>v;v++){s.2Q=t.2R(11.19.1Q,w.4q(v*(1/u))*(11.19.1K/u));13 f=g.2X[v];s.2f(),"15"==i?(s.3s(x.x-v,x.y),s.1d(x.x-v,x.y-.5*f.1c.14),s.1d(x.x-v-f.1c.18,x.y),s.1d(x.x-v,x.y+.5*f.1c.14)):(s.3s(x.x+v,x.y),s.1d(x.x+v,x.y-.5*f.1c.14),s.1d(x.x+v+f.1c.18,x.y),s.1d(x.x+v,x.y+.5*f.1c.14)),s.2g(),s.34()}}}}12 j(){13 b=11.3k();b.2G,b.1n;13 e=b.2o(),g=(11.2e(),11.19.31),h=a.1k({},e.1m.1c);h.14+=2*g,h.18+=2*g;13 i,k;1f(b.19.1l){13 l=w.4r.3T(11);i=l.2z.1c,k=i.18}13 m=s.5Z(b,h,k),n=m.1c,o=m.1e,h=m.1m.1c,p=m.1m.1e,r=e.1H.1e,t=e.1m.1e,u={17:r.17+t.17-(p.17+g)+11.19.1A.y,15:r.15+t.15-(p.15+g)+11.19.1A.x},v=e.2J,x=e.21.1c,y={17:0,15:0};1f(0>u.17){13 z=1b.2V(u.17);y.17+=z,u.17=0,v.17+=z}1f(0>u.15){13 A=1b.2V(u.15);y.15+=A,u.15=0,v.15+=A}13 B={18:1b.1U(n.18+u.17,x.18+y.17),14:1b.1U(n.14+u.15,x.14+y.15)},C={15:1b.1E(y.15+e.1H.1e.15+e.1m.1e.15+b.1i+b.2m),17:1b.1E(y.17+e.1H.1e.17+e.1m.1e.17+b.1i+b.2m)},D={1D:{1c:B},21:{1c:x,1e:y},1j:{1c:n,1e:u},1H:{1c:n,1e:{17:1b.23(o.17),15:1b.23(o.15)}},1m:{1c:{14:1b.1E(h.14),18:1b.1E(h.18)},1e:{17:1b.23(p.17),15:1b.23(p.15)}},2J:v,2F:{1e:C}};1a D}12 l(){13 b=11.2o(),c=11.3k(),d=11.2e();1f(a(d.1j).1q(k(b.1D.1c)),a(d.4Z).1q(a.1k(k(b.21.1e),k(b.21.1c))),c.2T&&c.2T.1q(k(b.1D.1c)),d.19.1y){13 e=c.2o(),f=b.21.1e,g=e.1y.1e;1f(a(c.1y).1q(k({17:f.17+g.17,15:f.15+g.15})),d.19.1y.1s){13 h=e.2U.1e;a(c.2U.1j).1q(k({17:f.17+h.17,15:f.15+h.15}))}}a(11.1j).1q(a.1k(k(b.1j.1c),k(b.1j.1e))),a(11.1H).1q(k(b.1H.1c)),a(d.38).1q(k(b.2F.1e))}1a{51:f,1z:d,36:e,1P:g,2e:b,3k:c,2o:j,7w:h,7v:i,52:l}}());13 y={3j:{},1t:12(b){1f(!b)1a 1r;13 c=a(b).1X("2p-1V");1a c?11.3j[c]:1r},30:12(a){11.3j[a.1V]=a},1z:12(a){13 b=11.1t(a);b&&(3G 11.3j[b.1V],b.1z())}};a.1k(z.3F,12(){12 b(){1a B.1t(11.1g)[0]}12 c(){1a u.1t(11.1g)}12 d(){1a 11.19.1K/(11.19.31+1)}12 e(){11.36()}12 f(){11.1j&&(a(11.1j).1z(),11.1j=1r)}12 g(){11.36();13 c=(11.2e(),11.3k()),d=c.2o().1y.1c,e=a.1k({},d),f=11.19.31;e.14+=2*f,e.18+=2*f,a(c.1y).6e(a(11.1j=1x.22("2h")).1Y("9j")),a(1x.3d).1Z(a(11.4s=1x.22("3f"))),q.3J(11.4s,e),q.3p(11.4s);13 g=11.4s.3o("2d");g.2L=11.2x,a(11.1j).1Z(11.4s);28(13 h=e.14/2,i=e.18/2,j=d.18/2,k=f+1,l=0;f>=l;l++)g.2Q=t.2R(11.19.1Q,w.4q(l*(1/k))*(11.19.1K/k)),g.2f(),g.26(h,i,j+l,n(0),n(7d),!0),g.2g(),g.34()}1a{1P:g,1z:e,36:f,2e:b,3k:c,7w:d}}());13 B={2A:{},19:{3V:"6f",4C:9k},6X:12(){12 b(){13 b=["2B"];1S.2H.3H&&(b.2n("9l"),a(1x.3d).3U("2B",12(){1a 3t 0})),a.1w(b,12(b,c){a(1x.7x).9m(".3C .7m, .3C .9n-1D",c,12(b){b.9o(),b.9p(),B.6g(a(b.1C).5f(".3C")[0]).1I()})}),a(1N).3U("3J",a.1v(11.7y,11))}1a b}(),7y:12(){11.5g&&(1N.6h(11.5g),11.5g=1r),11.5g=d.4G(a.1v(12(){13 b=11.3I();a.1w(b,12(a,b){b.1e()})},11),9q)},5h:12(b){13 d,c=a(b).1X("2p-1V");1f(!c){13 e=11.6g(a(b).5f(".3C")[0]);e&&e.1g&&(c=a(e.1g).1X("2p-1V"))}1a c&&(d=11.2A[c])?d:3t 0},5P:12(a){13 b;1a d.2j(a)&&(b=11.5h(a)),b&&b.1g},1t:12(b){13 c=[];1f(d.2j(b)){13 e=11.5h(b);e&&(c=[e])}1G a.1w(11.2A,12(d,e){e.1g&&a(e.1g).7z(b)&&c.2n(e)});1a c},6g:12(b){1f(!b)1a 1r;13 c=1r;1a a.1w(11.2A,12(a,d){d.1F("1P")&&d.1j===b&&(c=d)}),c},9r:12(b){13 c=[];1a a.1w(11.2A,12(d,e){e.1g&&a(e.1g).7z(b)&&c.2n(e)}),c},1W:12(b){1f(d.2j(b)){13 c=b,e=11.1t(c)[0];e&&e.1W()}1G a(b).1w(a.1v(12(a,b){13 c=11.1t(b)[0];c&&c.1W()},11))},1I:12(b){1f(d.2j(b)){13 c=11.1t(b)[0];c&&c.1I()}1G a(b).1w(a.1v(12(a,b){13 c=11.1t(b)[0];c&&c.1I()},11))},33:12(b){1f(d.2j(b)){13 c=b,e=11.1t(c)[0];e&&e.33()}1G a(b).1w(a.1v(12(a,b){13 c=11.1t(b)[0];c&&c.33()},11))},4R:12(){a.1w(11.3I(),12(a,b){b.1I()})},2P:12(b){1f(d.2j(b)){13 c=b,e=11.1t(c)[0];e&&e.2P()}1G a(b).1w(a.1v(12(a,b){13 c=11.1t(b)[0];c&&c.2P()},11))},3I:12(){13 b=[];1a a.1w(11.2A,12(a,c){c.1L()&&b.2n(c)}),b},5S:12(b){13 c=!1;1a d.2j(b)&&a.1w(11.3I()||[],12(a,d){1a d.1g==b?(c=!0,!1):3t 0}),c},7A:12(){13 c,b=0;1a a.1w(11.2A,12(a,d){d.2k>b&&(b=d.2k,c=d)}),c},7B:12(){1>=11.3I().2a&&a.1w(11.2A,12(b,c){c.1F("1P")&&!c.19.2k&&a(c.1j).1q({2k:c.2k=+B.19.4C})})},30:12(a){11.2A[a.1V]=a},5i:12(b){13 c=11.5h(b);1f(c){13 d=a(c.1g).1X("2p-1V");3G 11.2A[d],c.1I(),c.1z()}},1z:12(b){d.2j(b)?11.5i(b):a(b).1w(a.1v(12(a,b){11.5i(b)},11))},6Y:12(){a.1w(11.2A,a.1v(12(a,b){b.1g&&!d.1g.5H(b.1g)&&11.5i(b.1g)},11))},5Q:12(a){11.19.3V=a||"6f"},5R:12(a){11.19.4C=a||0},5U:12(){a.1w(11.2A,a.1v(12(a,b){b.1o&&b.1o.2l&&(b.1o.2l.6i(),b.1o.2l=1r),b.27("3c",!1)},11)),i.6S()},6B:12(){12 f(d){13 e;1a e="2s"==a.1p(d)?{1g:c.25&&c.25.1g||b.25.1g,2v:d}:A(a.1k({},b.25),d)}12 g(f){1a b=1S.2C.7C,c=A(a.1k({},b),1S.2C.6j),d=1S.2C.6k.7C,e=A(a.1k({},d),1S.2C.6k.6j),g=h,h(f)}12 h(g){g.21=g.21&&1S.2C[g.21]?g.21:1S.2C[B.19.3V]?B.19.3V:"6f";13 h=g.21?a.1k({},1S.2C[g.21]||1S.2C[B.19.3V]):{},i=A(a.1k({},c),h),j=A(a.1k({},i),g);1f(j.2c){13 k=c.2c||{},l=b.2c;"4t"==a.1p(j.2c)&&(j.2c={3W:k.3W||l.3W,1p:k.1p||l.1p}),j.2c=A(a.1k({},l),j.2c)}1f(j.1m&&"2s"==a.1p(j.1m)&&(j.1m={1Q:j.1m,1K:1}),j.1i){13 m,n=c.1i||{},o=b.1i;m="2y"==a.1p(j.1i)?{2u:j.1i,1Q:n.1Q||o.1Q,1K:n.1K||o.1K}:A(a.1k({},o),j.1i),j.1i=0===m.2u?!1:m}1f(j.1n){13 p;p="2y"==a.1p(j.1n)?{2u:j.1n,1e:c.1n&&c.1n.1e||b.1n.1e}:A(a.1k({},b.1n),j.1n),j.1n=0===p.2u?!1:p}13 q,s=s=j.1u&&j.1u.1C||"2s"==a.1p(j.1u)&&j.1u||c.1u&&c.1u.1C||"2s"==a.1p(c.1u)&&c.1u||b.1u&&b.1u.1C||b.1u,t=j.1u&&j.1u.1D||c.1u&&c.1u.1D||b.1u&&b.1u.1D||B.2r.6l(s);1f(j.1u?"2s"==a.1p(j.1u)?q={1C:j.1u,1D:B.2r.7D(j.1u)}:(q={1D:t,1C:s},j.1u.1D&&(q.1D=j.1u.1D),j.1u.1C&&(q.1C=j.1u.1C)):q={1D:t,1C:s},"2M"==j.1C){13 u=r.2I(q.1C);q.1C="1J"==u?q.1C.61(/(15|1O)/,"2t"):q.1C.61(/(17|1R)/,"2t")}j.1u=q;13 v;1f("2M"==j.1C?(v=a.1k({},b.1A),a.1k(v,1S.2C.6j.1A||{}),g.21&&a.1k(v,(1S.2C[g.21]||1S.2C[B.19.3V]).1A||{}),v=B.2r.7E(b.1A,b.1u,q.1C,!0),g.1A&&(v=a.1k(v,g.1A||{})),j.3X=0):v={x:j.1A.x,y:j.1A.y},j.1A=v,j.1y&&j.7F){13 w=a.1k({},1S.2C.6k[j.7F]),x=A(a.1k({},e),w);1f(x.2q&&a.1w(["6b","6c"],12(b,c){13 f=x.2q[c],g=e.2q&&e.2q[c];1f(f.1m){13 h=g&&g.1m;1f("2y"==a.1p(f.1m))f.1m={1Q:h&&h.1Q||d.2q[c].1m.1Q,1K:f.1m};1G 1f("2s"==a.1p(f.1m)){13 i=h&&"2y"==a.1p(h.1K)&&h.1K||d.2q[c].1m.1K;f.1m={1Q:f.1m,1K:i}}1G f.1m=A(a.1k({},d.2q[c].1m),f.1m)}1f(f.1i){13 j=g&&g.1i;f.1i="2y"==a.1p(f.1i)?{1Q:j&&j.1Q||d.2q[c].1i.1Q,1K:f.1i}:A(a.1k({},d.2q[c].1i),f.1i)}}),x.1s){13 z=e.1s&&e.1s.3D&&e.1s.3D==5x?e.1s:d.1s;x.1s.3D&&x.1s.3D==5x&&(z=A(z,x.1s)),x.1s=z}j.1y=x}1f(j.1s){13 C;C="4t"==a.1p(j.1s)?c.1s&&"4t"==a.1p(c.1s)?b.1s:c.1s?c.1s:b.1s:A(a.1k({},b.1s),j.1s||{}),"2y"==a.1p(C.1A)&&(C.1A={x:C.1A,y:C.1A}),j.1s=C}1f(j.1l){13 D={};D="4t"==a.1p(j.1l)?A({},b.1l):A(A({},b.1l),a.1k({},j.1l)),"2y"==a.1p(D.1A)&&(D.1A={x:D.1A,y:D.1A}),j.1l=D}1f(j.2Y&&("2s"==a.1p(j.2Y)?j.2Y={5j:j.2Y,7G:!0}:"4t"==a.1p(j.2Y)&&(j.2Y=j.2Y?{5j:"4T",7G:!0}:!1)),j.25&&"2B-9s"==j.25&&(j.7H=!0,j.25=!1),j.25)1f(a.71(j.25)){13 E=[];a.1w(j.25,12(a,b){E.2n(f(b))}),j.25=E}1G j.25=[f(j.25)];1a j.2K&&"2s"==a.1p(j.2K)&&(j.2K=[""+j.2K]),j.2m=0,j.1M&&(1N.6m||(j.1M=!1)),j}13 b,c,d,e;1a g}()};B.2r=12(){12 c(c){13 d=r.2N(c),e=d[1],f=d[2],g=r.2I(c),h=a.1k({1J:!0,2b:!0},20[1]||{});1a"1J"==g?(h.2b&&(e=b[e]),h.1J&&(f=b[f])):(h.2b&&(f=b[f]),h.1J&&(e=b[e])),e+f}12 f(a){13 d=r.2N(a);1a c(d[1]+b[d[2]])}12 h(b,c){a(b.1j).1q({17:c.17+"2w",15:c.15+"2w"})}12 j(a,b,d,e){13 g=y(a,b,d,e),h=d&&"2s"==7I d.1p?d.1p:"";1f(/9t$/.3h(h),1===g.3Y.3Z)1a l(a,g),g;13 m=b,n=e,o={1J:!g.3Y.1J,2b:!g.3Y.2b},p={1J:!1,2b:!1},q=r.2I(b);1a((p.2b="1J"==q&&o.2b)||(p.1J="2b"==q&&o.1J))&&(m=c(b,p),n=c(e,p),g=y(a,m,d,n),1===g.3Y.3Z)?(l(a,g),g):(g=k(g,a),l(a,g),g)}12 k(a,b){13 c=z(b),d=c.1c,e=c.1e,f=u.1t(b.1g).1o.1u[a.1u.1D].1D.1c,g=a.1e,h={17:0,15:0,3A:[]};1a e.15>g.15&&(h.15=e.15-g.15,h.3A.2n("15"),a.1e.15=e.15),e.17>g.17&&(h.17=g.17-e.17,h.3A.2n("17"),a.1e.17=e.17),e.15+d.14<g.15+f.14&&(h.15=e.15+d.14-(g.15+f.14),h.3A.2n("1O"),a.1e.15=e.15+d.14-f.14),e.17+d.18<g.17+f.18&&(h.17=e.17+d.18-(g.17+f.18),h.3A.2n("1R"),a.1e.17=e.17+d.18-f.18),a.7J=h,a}12 l(a,b){a.5e(b.1u.1D,b.3Y.4l,b.7J),h(a,b.1e)}12 m(a){1a a&&(/^2M|2B|3H$/.3h("2s"==7I a.1p&&a.1p||"")||a.5G>=0)}12 n(a,b,c){1a a>=b&&c>=a}12 o(a,b,c,d){13 e=n(a,c,d),f=n(b,c,d);1f(e&&f)1a b-a;1f(e&&!f)1a d-a;1f(!e&&f)1a b-c;13 g=n(c,a,b),h=n(d,a,b);1a g&&h?d-c:g&&!h?b-c:!g&&h?d-a:0}12 q(a,b){1a o(a.1e.15,a.1e.15+a.1c.14,b.1e.15,b.1e.15+b.1c.14)*o(a.1e.17,a.1e.17+a.1c.18,b.1e.17,b.1e.17+b.1c.18)}12 s(a,b){13 c=a.1c.14*a.1c.18;1a c?q(a,b)/c:0}12 t(a,b){13 c=r.2N(b),d=r.2I(b),e={15:0,17:0};1f("1J"==d){1T(c[2]){1h"2t":1h"2S":e.15=.5*a.14;1B;1h"1O":e.15=a.14}"1R"==c[1]&&(e.17=a.18)}1G{1T(c[2]){1h"2t":1h"2S":e.17=.5*a.18;1B;1h"1R":e.17=a.18}"1O"==c[1]&&(e.15=a.14)}1a e}12 v(b){13 c=d.1g.4L(b),e=d.1g.4H(b),f={17:a(1N).4I(),15:a(1N).4J()};1a c.15+=-1*(e.15-f.15),c.17+=-1*(e.17-f.17),c}12 y(b,e,f,g){13 h,i,j,k=u.1t(b.1g),l=k.19,n=l.1A,o=m(f);1f(o||!f){1f(j={14:24,18:24},o){13 p=d.5F(f);h={17:p.y-.5*j.18+6,15:p.x-.5*j.14+6}}1G{13 q=b.1o.2v;h={17:(q?q.y:0)-.5*j.18+6,15:(q?q.x:0)-.5*j.14+6}}b.1o.2v={x:h.15,y:h.17}}1G h=v(f),j={14:a(f).7K(),18:a(f).7L()};1f(l.1l&&"2M"!=l.1C){13 y=r.2N(g),A=r.2N(e),C=r.2I(g),D=k.1o.19,E=k.4p().1i.1c,F=D.1n,G=D.1i,H=F&&"1m"==l.1n.1e?F:0,I=F&&"1i"==l.1n.1e?F:F+G,J=G+H+.5*l.1l.14-.5*E.14,K=I>J?I-J:0;4u=1b.1E(G+H+.5*l.1l.14+K+l.1l.1A["1J"==C?"x":"y"]),"1J"==C&&"15"==y[2]&&"15"==A[2]||"1O"==y[2]&&"1O"==A[2]?(j.14-=2*4u,h.15+=4u):("2b"==C&&"17"==y[2]&&"17"==A[2]||"1R"==y[2]&&"1R"==A[2])&&(j.18-=2*4u,h.17+=4u)}i=a.1k({},h);13 L=o?c(l.1u.1D):l.1u.1C,M=t(j,L),N=t(j,g);({17:h.17+M.17+n.y,15:h.15+M.15+n.x}),h={15:h.15+N.15,17:h.17+N.17};13 P=a.1k({},n);P=x(P,L,g,"2M"==k.19.1C),h.17+=P.y,h.15+=P.x;13 k=u.1t(b.1g),Q=k.1o.1u,R=a.1k({},Q[e]),S={x:0,y:0},y=r.2N(g);1f("2t"!=y[2]){13 C=C=r.2I(g),T=B.2r.6l(g,"2b"==C?{1J:!0,2b:!1}:{1J:!1,2b:!0});e==T&&(S.y=k.3B.5c.y,S.x=k.3B.5c.x)}13 U={17:h.17-R.2J.17-S.y,15:h.15-R.2J.15-S.x};R.1D.1e=U;13 V={1J:!0,2b:!0},W={x:0,y:0};1f(b.19.2Y){13 X=z(b),Y=b.19.1s?w.1t(b.1g):k,Z=Y.2o().1D.1c;V.3Z=s({1c:Z,1e:U},X),1>V.3Z&&((U.15<X.1e.15||U.15+Z.14>X.1e.15+X.1c.14)&&(V.1J=!1,W.x=U.15<X.1e.15?U.15-X.1e.15:U.15+Z.14-(X.1e.15+X.1c.14)),(U.17<X.1e.17||U.17+Z.18>X.1e.17+X.1c.18)&&(V.2b=!1,W.y=U.17<X.1e.17?U.17-X.1e.17:U.17+Z.18-(X.1e.17+X.1c.18)))}1G V.3Z=1;V.4l=W;13 $=Q[e].1H,7M=s({1c:j,1e:i},{1c:$.1c,1e:{17:U.17+$.1e.17,15:U.15+$.1e.15}});1a{1e:U,3Z:{1C:7M},3Y:V,1u:{1D:e,1C:g}}}12 z(b){13 c={17:a(1N).4I(),15:a(1N).4J()},e=b.19,f=e.1C;("2M"==f||"4F"==f)&&(f=b.1g);13 g=a(f).5f(e.2Y.5j).7i()[0];1f(!g||"4T"==e.2Y.5j)1a{1c:p.4T(),1e:c};13 h=d.1g.4L(g),i=d.1g.4H(g);1a h.15+=-1*(i.15-c.15),h.17+=-1*(i.17-c.17),{1c:{14:a(g).5V(),18:a(g).5W()},1e:h}}13 b={15:"1O",1O:"15",17:"1R",1R:"17",2t:"2t",2S:"2S"};e.3m&&9>e.3m||e.4M&&2>e.4M||e.5M&&9u>e.5M;13 x=12(){13 a=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]],b={3R:0,3O:0,4b:1,58:1,3P:2,3Q:2,4c:5,59:5,4d:8,4e:8,4f:7,5a:7,4g:6,4h:6,4i:3,5b:3};1a 12(c,d,e,f){13 g=a[b[d]],h=a[b[e]],i=[1b.65(.5*1b.2V(g[0]-h[0]))?-1:1,1b.65(.5*1b.2V(g[1]-h[1]))?-1:1];1a r.35(d)||!r.35(e)||f||("1J"==r.2I(e)?i[0]=0:i[1]=0),{x:i[0]*c.x,y:i[1]*c.y}}}();1a{1t:y,4P:j,6l:c,7D:f,7N:v,7E:x,6n:m}}(),B.2r.4S={x:0,y:0},a(1x).6W(12(){13 b=B.2r;a(1x).3U("5k",12(a){b.4S={x:a.5G,y:a.6H}})}),B.53=12(){12 b(){a(1x.3d).1Z(a(1x.22("2h")).1Y("9v").1Z(a(1x.22("2h")).1Y("3C").1Z(a(11.1j=1x.22("2h")).1Y("7O"))))}12 c(b){1a{14:a(b).5V(),18:a(b).5W()}}12 e(b){13 d=c(b),e=b.4K;1a e&&a(e).1q({14:d.14+"2w"})&&c(b).18>d.18&&d.14++,a(e).1q({14:"62%"}),d}12 f(b,c,e){11.1j||11.1P();13 f=b.19,g=a.1k({1M:!1},20[3]||{});!f.7P&&!d.2j(c)||a(c).1X("7Q")||(f.7P&&"2s"==a.1p(c)&&(b.39=a("#"+c)[0],c=b.39),!b.40&&c&&d.1g.5H(c)&&(a(b.39).1X("7R",a(b.39).1q("7S")),b.40=1x.22("2h"),a(b.39).6e(a(b.40).1I())));13 h=1x.22("2h");a(11.1j).1Z(a(h).1Y("7h 9w").1Z(c)),d.2j(c)&&a(c).1W(),f.21&&a(h).1Y("9x"+b.19.21);13 i=a(h).67("7T[4m]").9y(12(){1a!(a(11).3g("18")&&a(11).3g("14"))});1f(i.2a>0&&!b.1F("3E")){b.27("3E",!0),f.1M&&(g.1M||b.1M||(b.1M=b.6o(f.1M)),b.1F("1L")&&(b.1e(),a(b.1j).1W()),b.1M.6p());13 j=0,k=1b.1U(9z,9A*(i.2a||0));b.2i("3E"),b.41("3E",a.1v(12(){i.1w(12(){11.6q=12(){}}),j>=i.2a||(11.5l(b,h),e&&e())},11),k),a.1w(i,a.1v(12(c,d){13 f=3q 9B;f.6q=a.1v(12(){f.6q=12(){};13 c=f.14,g=f.18,k=a(d).3g("14"),l=a(d).3g("18");k&&l||(!k&&l?(c=1b.23(l*c/g),g=l):!l&&k&&(g=1b.23(k*g/c),c=k),a(d).3g({14:c,18:g}),j++),j==i.2a&&(b.2i("3E"),b.1M&&(b.1M.1z(),b.1M=1r),b.1F("1L")&&a(b.1j).1I(),11.5l(b,h),e&&e())},11),f.4m=d.4m},11))}1G 11.5l(b,h),e&&e()}12 g(b,c){13 d=e(c),f={14:d.14-(2O(a(c).1q("2m-15"))||0)-(2O(a(c).1q("2m-1O"))||0),18:d.18-(2O(a(c).1q("2m-17"))||0)-(2O(a(c).1q("2m-1R"))||0)};b.19.3i&&"2y"==a.1p(b.19.3i)&&f.14>b.19.3i&&(a(c).1q({14:b.19.3i+"2w"}),d=e(c)),b.1o.2G=d,a(b.38).7U(c)}1a{1P:b,42:f,5l:g,69:e}}(),a.1k(C.3F,12(){12 b(a,b,c){11.1o.3b[a]=d.4G(b,c)}12 c(a){1a 11.1o.3b[a]}12 e(a){11.1o.3b[a]&&(1N.6h(11.1o.3b[a]),3G 11.1o.3b[a])}12 f(){a.1w(11.1o.3b,12(a,b){1N.6h(b)}),11.1o.3b=[]}12 g(b,c,d,e){c=c;13 f=a.1v(d,e||11);11.1o.5A.2n({1g:b,7V:c,7W:f}),a(b).3U(c,f)}12 h(){a.1w(11.1o.5A,12(b,c){a(c.1g).7X(c.7V,c.7W)})}12 j(a,b){11.1o.2q[a]=b}12 l(a){1a 11.1o.2q[a]}12 m(){11.2D(11.1g,"4o",11.5m),11.2D(11.1g,"54",a.1v(12(a){11.6r(a)},11)),11.19.2K&&a.1w(11.19.2K,a.1v(12(b,c){13 d=!1;"2B"==c&&(11.19.25&&a.1w(11.19.25,12(a,b){1a"4F"==b.1g&&"2B"==b.2v?(d=!0,!1):3t 0}),11.27("5B",d)),11.2D(11.1g,c,"2B"==c?d?11.33:11.1W:a.1v(12(){11.7Y()},11))},11)),11.19.25?a.1w(11.19.25,a.1v(12(b,c){13 d;1T(c.1g){1h"4F":1f(11.1F("5B")&&"2B"==c.2v)1a;d=11.1g;1B;1h"1C":d=11.1C}d&&11.2D(d,c.2v,"2B"==c.2v?11.1I:a.1v(12(){11.6s()},11))},11)):11.19.7Z&&11.19.2K&&!a.6t("2B",11.19.2K)>-1&&11.2D(11.1g,"54",a.1v(12(){11.2i("1W")},11));13 b=!1;!11.19.9C&&11.19.2K&&((b=a.6t("5k",11.19.2K)>-1)||a.6t("5n",11.19.2K)>-1)&&"2M"==11.1C&&11.2D(11.1g,b?"5k":"5n",12(a){11.1F("4E")&&11.1e(a)})}12 n(){11.2D(11.1j,1S.2H.3H?"5n":"4o",11.5m),11.2D(11.1j,"54",11.6r),11.2D(11.1j,1S.2H.3H?"5n":"4o",a.1v(12(){11.5o("4v")||11.1W()},11)),11.19.25&&a.1w(11.19.25,a.1v(12(b,c){13 d;1T(c.1g){1h"1D":d=11.1j}d&&11.2D(d,c.2v,c.2v.3e(/^(2B|5k|4o)$/)?11.1I:a.1v(12(){11.6s()},11))},11))}12 o(a,b,c){13 d=u.1t(11.1g);d&&d.5e(a,b,c)}12 p(a){13 b=u.1t(11.1g);b&&b.4n(a)}12 q(){11.4n(11.19.1u.1D)}12 r(){a(11.1j=1x.22("2h")).1Y("3C"),11.80()}12 s(){11.1P();13 a=u.1t(11.1g);a?a.1P():(3q v(11.1g),11.27("4E",!0))}12 t(){11.1F("1P")||(a(1x.3d).1Z(a(11.1j).1q({15:"-5p",17:"-5p",2k:11.2k}).1Z(a(11.4Z=1x.22("2h")).1Y("9D")).1Z(a(11.38=1x.22("2h")).1Y("7O"))),a(11.1j).1Y("9E"+11.19.21),11.19.7H&&(a(11.1g).1Y("81"),11.2D(1x.7x,"2B",a.1v(12(b){1f(11.1L()){13 c=a(b.1C).5f(".3C, .81")[0];(!c||c&&c!=11.1j&&c!=11.1g)&&11.1I()}},11))),1S.2H.48&&(11.19.4w||11.19.3X)&&(11.5q(11.19.4w),a(11.1j).1Y("6u")),11.82(),11.27("1P",!0),B.30(11))}12 w(){13 c;11.2F,11.40&&11.39&&((c=a(11.39).1X("7R"))&&a(11.39).1q({7S:c}),a(11.40).6e(11.39).1z(),11.40=1r)}12 x(){d.44(a.1v(12(){11.83()},11)),11.84(),11.6v(),d.44(a.1v(12(){a(11.1j).67("7T[4m]").7X("9F")},11)),u.1z(11.1g),11.1F("1P")&&11.1j&&(a(11.1j).1z(),11.1j=1r);13 c,b="5z";(c=a(11.1g).1X(b))&&a(11.1g).3g("5y",c).85("5z"),a(11.1g).85("2p-1V")}12 y(b){13 c=a.1k({4x:11.19.4x,1M:!1},20[1]||{});11.1P(),11.1F("1L")&&a(11.1j).1I(),B.53.42(11,b,a.1v(12(){13 b=11.1F("1L");b||11.27("1L",!0),11.86(),b||11.27("1L",!1),11.1F("1L")&&(a(11.1j).1I(),11.1e(),11.5r(),a(11.1j).1W()),11.27("3c",!0),c.4x&&c.4x(11.38.4y,11.1g),c.4z&&c.4z()},11),{1M:c.1M})}12 z(b){13 c,d={47:11.2F,1p:11.19.2c.1p,1X:11.19.2c.1X||{},87:11.19.2c.87||"7U"};1f(!(11.1F("2l")||11.19.2c.3W&&11.1F("3c"))){1f(11.19.2c.3W&&(c=i.1t(d)))1a 11.6w(c,{4z:a.1v(12(){11.1F("1L")&&11.19.43&&11.19.43(11.38.4y,11.1g)},11)}),3t 0;11.27("2l",!0),11.19.1M&&(11.1M?11.1M.6p():(11.1M=11.6o(11.19.1M),11.27("3c",!1)),11.1e(b)),11.1o.2l&&(11.1o.2l.6i(),11.1o.2l=1r),11.1o.2l=a.2c(a.1k({},d,{9G:a.1v(12(b,c,e){0!==e.9H&&(i.4P(d,e.4O),11.6w(e.4O,{4z:a.1v(12(){11.27("2l",!1),11.1F("1L")&&11.19.43&&11.19.43(11.38.4y,11.1g),11.1M&&(11.1M.1z(),11.1M=1r)},11)}))},11)}))}}12 A(b){13 c=a.1k({1M:11.19.1M&&11.1M},20[1]||{});11.42(b,c)}12 C(){13 b=1x.22("2h");a(b).1X("7Q",!0);13 c=6m.4Q(b,a.1k({},20[0]||{})),d=6m.5Y(b);1a a(b).1q(k(d)),11.42(b,{4x:!1,4z:12(){c.6p()}}),c}12 E(){1f(11.1F("1P")&&!11.19.2k){13 b=B.7A();b&&b!=11&&11.2k<=b.2k&&a(11.1j).1q({2k:11.2k=b.2k+1})}}12 F(){13 a=u.1t(11.1g);a&&(a.2P(),11.1L()&&11.1e())}12 G(a){1f(1S.2H.48){a=a||0;13 b=11.1j.9I;b.9J=a+"5s",b.9K=a+"5s",b.9L=a+"5s",b.9M=a+"5s"}}12 H(b){11.2i("1I"),11.2i("4v"),11.1F("1L")||11.5o("1W")||11.41("1W",a.1v(12(){11.2i("1W"),11.1W(b)},11),11.19.7Z||1)}12 I(b){1f(11.2i("1I"),11.2i("4v"),!11.1L()){1f("12"==a.1p(11.2F)||"12"==a.1p(11.1o.5t)){"12"!=a.1p(11.1o.5t)&&(11.1o.5t=11.2F);13 c=11.1o.5t(11.1g)||!1;1f(c!=11.1o.5C&&(11.1o.5C=c,11.27("3c",!1),11.6v()),11.2F=c,!c)1a}11.19.9N&&B.4R(),11.27("1L",!0),11.19.2c?11.88(b):11.1F("3c")||11.42(11.2F),11.1F("4E")&&11.1e(b),11.5r(),11.19.5u&&d.44(a.1v(12(){11.5m()},11)),"12"==a.1p(11.19.43)&&(!11.19.2c||11.19.2c&&11.19.2c.3W&&11.1F("3c"))&&11.19.43(11.38.4y,11.1g),1S.2H.48&&(11.19.4w||11.19.3X)&&(11.5q(11.19.4w),a(11.1j).1Y("89").8a("6u")),a(11.1j).1W()}}12 J(){11.2i("1W"),11.1F("1L")&&(11.27("1L",!1),1S.2H.48&&(11.19.4w||11.19.3X)?(11.5q(11.19.3X),a(11.1j).8a("89").1Y("6u"),11.41("4v",a.1v(11.6x,11),11.19.3X)):11.6x(),11.1o.2l&&(11.1o.2l.6i(),11.1o.2l=1r,11.27("2l",!1)))}12 K(){11.1F("1P")&&(a(11.1j).1q({15:"-5p",17:"-5p"}),B.7B(),"12"!=a.1p(11.19.8b)||11.1M||11.19.8b(11.38.4y,11.1g))}12 L(){11.2i("1W"),!11.5o("1I")&&11.1F("1L")&&11.41("1I",a.1v(12(){11.2i("1I"),11.2i("4v"),11.1I()},11),11.19.9O||1)}12 M(a){11[11.1L()?"1I":"1W"](a)}12 N(){1a 11.1F("1L")}12 O(){11.27("4D",!0),11.1F("1L")&&11.5r(),11.19.5u&&11.2i("6y")}12 P(){11.27("4D",!1),11.19.5u&&11.41("6y",a.1v(12(){11.2i("6y"),11.1F("4D")||11.1I()},11),11.19.5u)}13 D=12(b){1f(11.1L()){13 c;1f("2M"==11.19.1C){13 e=B.2r.6n(b),f=B.2r.4S;1f(e)f.x||f.y?(11.1o.2v={x:f.x,y:f.y},c=1r):c=b;1G{1f(f.x||f.y)11.1o.2v={x:f.x,y:f.y};1G 1f(!11.1o.2v){13 g=B.2r.7N(11.1g);11.1o.2v={x:g.15,y:g.17}}c=1r}}1G c=11.1C;1f(B.2r.4P(11,11.19.1u.1D,c,11.19.1u.1C),b&&B.2r.6n(b)){13 h={14:a(11.1j).7K(),18:a(11.1j).7L()},i=d.5F(b),g=d.1g.4L(11.1j);i.x>=g.15&&i.x<=g.15+h.14&&i.y>=g.17&&i.y<=g.17+h.18&&d.44(a.1v(12(){11.2i("1I")},11))}}};1a{1P:t,6E:r,86:s,80:m,82:n,1W:I,1I:J,6x:K,33:M,1L:N,7Y:H,6s:L,5q:G,27:j,1F:l,5m:O,6r:P,5o:c,41:b,2i:e,84:f,2D:g,83:h,5e:o,4n:p,9P:q,2P:F,42:y,88:z,6w:A,6o:C,1e:D,5r:E,6v:w,1z:x}}()),1S.3p()})(46);',62,610,"|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||this|function|var|width|left||top|height|options|return|Math|dimensions|lineTo|position|if|element|case|border|container|extend|stem|background|radius|_cache|type|css|null|shadow|get|hook|proxy|each|document|closeButton|remove|offset|break|target|tooltip|ceil|getState|else|bubble|hide|horizontal|opacity|visible|spinner|window|right|build|color|bottom|Tipped|switch|max|uid|show|data|addClass|append|arguments|skin|createElement|round||hideOn|arc|setState|for|_hookPosition|length|vertical|ajax||getTooltip|beginPath|closePath|div|clearTimer|isElement|zIndex|xhr|padding|push|getOrderLayout|tipped|states|Position|string|middle|size|event|px|_globalAlpha|number|box|tooltips|click|Skins|setEvent|180|content|contentDimensions|support|getOrientation|anchor|showOn|globalAlpha|mouse|split|parseInt|refresh|fillStyle|hex2fill|center|iframeShim|closeButtonShadow|abs|bubbleCanvas|blurs|containment|PI|add|blur|scripts|toggle|fill|isCenter|cleanup|cornerOffset|contentElement|inlineContent|_stemCorrection|timers|updated|body|match|canvas|attr|test|maxWidth|shadows|getSkin|_adjustment|IE|indexOf|getContext|init|new|devicePixelRatio|moveTo|void|charAt|toLowerCase|diameter|hookPosition|layout|stemLayout|sides|_corrections|t_Tooltip|constructor|preloading_images|prototype|delete|touch|getVisible|resize|x1|y1|x2|y2|topleft|topright|righttop|lefttop|math|getLayout|bind|defaultSkin|cache|fadeOut|contained|overlap|inlineMarker|setTimer|update|onShow|defer||jQuery|url|cssTransitions|items|createFillStyle|topmiddle|rightmiddle|rightbottom|bottomright|bottommiddle|bottomleft|leftbottom|leftmiddle|regex|getBorderDimensions|correction|src|setHookPosition|mouseenter|getStemLayout|transition|Stem|closeButtonCanvas|boolean|sideOffset|fadeTransition|fadeIn|afterUpdate|firstChild|callback|cos|000|startingZIndex|active|skinned|self|delay|cumulativeScrollOffset|scrollTop|scrollLeft|parentNode|cumulativeOffset|Gecko|Chrome|responseText|set|create|hideAll|mouseBuffer|viewport|min|G_vmlCanvasManager|getCenterBorderDimensions|substring|skins|skinElement||prepare|order|UpdateQueue|mouseleave||rotate|borderRadius|topcenter|rightcenter|bottomcenter|leftcenter|corner|corrections|setHookPositionAndStemCorrection|closest|_resizeTimer|_getTooltip|_remove|selector|mousemove|_updateTooltip|setActive|touchmove|getTimer|10000px|setFadeDuration|raise|ms|contentFunction|hideAfter|console|in|Object|title|tipped_restore_title|events|toggles|fnCallContent|call|apply|pointer|pageX|isAttached|RegExp|parseFloat|Opera|opera|WebKit|required|available|findElement|setDefaultSkin|setStartingZIndex|isVisibleByElement|undefined|clearAjaxCache|innerWidth|innerHeight|getSide|getDimensions|getBubbleLayout|nullifyCornerOffset|replace|100|defaultCloseButton|hoverCloseButton|floor|prepend|find|auto|getMeasureElementDimensions|drawCloseButtonState|default|hover|_drawBackgroundPath|before|dark|getByTooltipElement|clearTimeout|abort|reset|CloseButtons|getInversedPosition|Spinners|isPointerEvent|insertSpinner|play|onload|setIdle|hideDelayed|inArray|t_hidden|_restoreInlineContent|afterAjaxUpdate|_hide|idle|warn|_stemPosition|createOptions|getAttribute|getElementById|_preBuild|Array|concat|pageY|version|AppleWebKit|MobileSafari|check|pow|Za|checked|notified|toUpperCase|param|clear|try|DocumentTouch|catch|ready|startDelegating|removeDetached|drawRoundedRectangle|fillRect|isArray|Gradient|addColorStops|positions|toOrientation|side|toDimension|isCorner|atan|red|green|blue|360|drawBubble|drawCloseButton|createHookCache|t_ContentContainer|first|25000px|setStemCorrection|setAdjustment|t_Close|closeButtonShift|closeButtonMouseover|closeButtonMouseout|CloseButton|stemOffset|backgroundRadius|_drawBorderPath|setGlobalAlpha|drawBackground|getBlurOpacity|documentElement|onWindowResize|is|getHighestTooltip|resetZ|base|getTooltipPositionFromTarget|adjustOffsetBasedOnHooks|closeButtonSkin|flip|hideOnClickOutside|typeof|adjustment|outerWidth|outerHeight|_|getAbsoluteOffset|t_Content|inline|isSpinner|tipped_restore_inline_display|display|img|html|eventName|handler|unbind|showDelayed|showDelay|createPreBuildObservers|t_hideOnClickOutside|createPostBuildObservers|clearEvents|clearTimers|removeData|_buildSkin|dataType|ajaxUpdate|t_visible|removeClass|onHide|log|sqrt|object|setAttribute|slice|wrap|nodeType|setTimeout|do|while|exec|attachEvent|MSIE|KHTML|rv|Apple|Mobile|Safari|navigator|userAgent|fn|jquery|z_|z0|requires|_t_uid_|ontouchstart|instanceof|WebKitTransitionEvent|TransitionEvent|OTransitionEvent|createEvent|scale|initElement|drawPixelArray|createLinearGradient|addColorStop|spacing|rgba|join|fff|255|hue|saturation|brightness|0123456789abcdef|hex2rgb|getSaturatedBW|init_|t_Bubble||iframe|t_iframeShim|frameBorder|javascript|15000px|t_CloseButtonShift|lineCap|t_CloseState|translate|stemCorrection|270|lineWidth|sin|setOpacity|getCenterBorderDimensions2|acos|t_Shadow|t_ShadowBubble|t_CloseButtonShadow|999999|touchstart|delegate|close|preventDefault|stopPropagation|200|getBySelector|outside|move|530|t_UpdateQueue|t_clearfix|t_Content_|filter|8e3|750|Image|fixed|t_Skin|t_Tooltip_|load|success|status|style|MozTransitionDuration|webkitTransitionDuration|OTransitionDuration|transitionDuration|hideOthers|hideDelay|resetHookPosition".split("|"),0,{}));function reloadEventbox(n){var o;if(typeof(n)=="string"){o=$.parseJSON(n)}else{o=n}var p=typeof o.eventText;var m=parseInt(o.friendly)+parseInt(o.neutral)+parseInt(o.hostile);if(m>0){if($("#eventboxFilled .event_list").length>0){return}var l;var q=$('<p class="event_list">');if($("body").attr("id")==="galaxy"){q.append('<span class="next_event">'+eventboxLoca.nextEvent+': <span class="countdown" id="tempcounter" name="countdown"></span></span>').append('<span class="next_event">'+eventboxLoca.nextEventText+': <span class="'+o.eventType+'">'+o.eventText+"</span></span>");l=q}else{var k=(m===1)?eventboxLoca.mission:eventboxLoca.missions;l=$('<p class="event_list">'+m+" "+k+": </p>");if(o.friendly){l.append('<span class="undermark">'+o.friendly+" "+eventboxLoca.friendly+"</span>")}if(o.neutral){if(o.friendly){l.append(", ")}l.append('<span class="middlemark">'+o.neutral+" "+eventboxLoca.neutral+"</span>")}if(o.hostile){if(o.friendly||o.neutral){l.append(", ")}l.append('<span class="overmark">'+o.hostile+" "+eventboxLoca.hostile+"</span>")}q.append('<span class="next_event">'+eventboxLoca.nextEvent+': <span class="countdown" id="tempcounter" name="countdown"></span></span>').append('<span class="next_event">'+eventboxLoca.nextEventText+': <span class="'+o.eventType+'">'+o.eventText+"</span></span>");l.append(q)}$("#eventboxFilled").prepend(l)}if(p==="string"||p==="undefined"){$("#eventboxLoading").hide();if(m>0){$("#eventboxBlank").hide();$("#eventboxFilled").show();new simpleCountdown(getElementByIdWithCache("tempcounter"),o.eventTime,function(){setTimeout(getAjaxEventbox,3000)})}else{$("#eventboxBlank").show();$("#eventboxFilled").hide()}}}function reloadResources(d,g){var f;if(typeof(d)=="string"){f=$.parseJSON(d)}else{f=d}reloadResourceTicker(f);$("#resources_metal").html(f.metal.resources["actualFormat"]);$("#resources_metal").attr("class",f.metal["class"]);changeTooltip($("#metal_box"),f.metal.tooltip);$("#resources_crystal").html(f.crystal.resources["actualFormat"]);$("#resources_crystal").attr("class",f.crystal["class"]);changeTooltip($("#crystal_box"),f.crystal.tooltip);$("#resources_deuterium").html(f.deuterium.resources["actualFormat"]);$("#resources_deuterium").attr("class",f.deuterium["class"]);changeTooltip($("#deuterium_box"),f.deuterium.tooltip);$("#resources_energy").html(f.energy.resources["actualFormat"]);$("#resources_energy").attr("class",f.energy["class"]);changeTooltip($("#energy_box"),f.energy.tooltip);$("#resources_darkmatter").html(f.darkmatter.resources["actualFormat"]);$("#resources_darkmatter").attr("class",f.darkmatter["class"]);changeTooltip($("#darkmatter_box"),f.darkmatter.tooltip);honorScore=f.honorScore;darkMatter=f.darkmatter.resources["actual"];if(typeof(g)=="function"){g(f)}}function reloadResourceTicker(b){if(typeof(b)=="string"){b=$.parseJSON(b)}resourceTickerMetal={available:b.metal.resources["actual"],limit:b.metal.resources["max"],production:b.metal.resources["production"],valueElem:"resources_metal"};resourceTickerCrystal={available:b.crystal.resources["actual"],limit:b.crystal.resources["max"],production:b.crystal.resources["production"],valueElem:"resources_crystal"};resourceTickerDeuterium={available:b.deuterium.resources["actual"],limit:b.deuterium.resources["max"],production:b.deuterium.resources["production"],valueElem:"resources_deuterium"};if(!vacation){if(typeof(metalTicker)!="undefined"){timerHandler.removeCallback(metalTicker.intervalObj)}if(typeof(crystalTicker)!="undefined"){timerHandler.removeCallback(crystalTicker.intervalObj)}if(typeof(deuteriumTicker)!="undefined"){timerHandler.removeCallback(deuteriumTicker.intervalObj)}metalTicker=new resourceTicker(resourceTickerMetal);crystalTicker=new resourceTicker(resourceTickerCrystal);deuteriumTicker=new resourceTicker(resourceTickerDeuterium)}}function reloadRightmenu(b){$.get(b,{},displayRightmenu)}function displayRightmenu(b){$("#rechts").replaceWith(b);initPlanetSorting()}function ajaxFormSubmit(m,g,l){var k=$("#"+m+"").serialize();var h=null;if(l!=null&&typeof l=="function"){h=l}$.ajax({type:"POST",url:g,data:k,success:h})}function initConnectionErrorFunction(){if(isMobile){document.addEventListener("deviceready",function(){$(document).ajaxError(function(k,h,f,g){HostApp.ShowNoConnectionScreen()})},false)}}function initAllianceInfo(){initConnectionErrorFunction();initTooltips();initOverlays();initHideElements()}function manageTabs(g){var d="#"+g;var f=$(d).attr("rel");if($(d).hasClass("opened")){$(d).addClass("closed");$(d).removeClass("opened");$("#"+f).hide()}else{$(d).removeClass("closed");$(d).addClass("opened");$("#"+f).show()}}function ajaxLoad(b){$("#eins select").ogameDropDown("destroy");$("#eins").html('<div class="ajaxLoad">'+LocalizationStrings.loading+"</div>");$.post(b,{ajax:1},function(a){$("#eins").html(a).find("select").ogameDropDown()})}function initAlliance(){initToggleHeader("alliance");$(".navi").click(function(){var b=$(this).attr("rel");$("#tab-ally li").removeClass("aktiv");$(this).parent().addClass("aktiv");hideTipsOnTabChange();ajaxLoad(b)})}function initAllianceBroadcast(){$("#allianceBroadCast").submit(function(){var b=$(this);if($.trim(b.find('textarea[name="text"]').val()).length==0){errorBoxNotify(LocalizationStrings.error,chatLoca.TEXT_EMPTY,LocalizationStrings.ok);return false}$.post(b.attr("action"),b.serialize()+"&ajax=1",function(g){try{var a=$.parseJSON(g);if(typeof a.message!="undefined"){errorBoxNotify(LocalizationStrings.error,a.message,LocalizationStrings.ok)}}catch(f){$("#eins").html(g)}});return false})}function initAllianceManagement(){$(".contentz").tabs({activate:hideTipsOnTabChange});$(".allyTagChange").tabs({activate:hideTipsOnTabChange});$(".quitAlly").tabs({activate:hideTipsOnTabChange});$(".dissolve").bind("click",dissolve);$(".deleteRank").bind("click",deleteRank);$(".transferLeadership").bind("click",transferLeadership);$(".takeoverLeadership").bind("click",takeoverLeadership)}function initBBCodeEditor(K,H,C,E,D,v){var A;if(typeof(E)=="undefined"||E==null){A=$("textarea:not(.markItUpEditor)")}else{A=$(E).filter(":not(.markItUpEditor)")}if(A.length==0){return}var C=C||false;var u=[];for(var B=6;B<=30;B+=2){u.push({name:B,openWith:"[size="+B+"]",closeWith:"[/size]",placeHolder:"Text",className:"fontSize"+B})}var G=[];$.each(H,function(a,b){G.push({name:b,replaceWith:"[item]"+a+"[/item]"})});function J(h){if(h.selection.length==0){return}var g=$(h.textarea);var d=g.getSelection();var b=g.val().indexOf(h.openWith,d.start);var a=b+h.openWith.length;var f=typeof(h.placeHolder)=="string"?h.placeHolder.length:0;var c={start:a,end:a+f};g.setSelection(c)}function I(a){var c=a.openWith;var f=$(a.textarea);var d=f.getSelection();f.siblings(".colorpicker").val("").colorpicker("open").colorpicker("option","close",function(h,l){var k=c.replace(/%colorCode%/,l.formatted);var g="%colorCode%".length-l.formatted.length;d.start=d.start-g;d.end=d.end-g;f.val(f.val().replace(c,k)).setSelection(d)});var b=f.siblings(".markItUpHeader").find("."+a.className);$(".ui-colorpicker:visible").css("top",b.offset().top+b.height()).css("left",b.offset().left);$(".ui-colorpicker").draggable();$(".ui-colorpicker-rgb-r .ui-colorpicker-number").focus();return a}function w(g){var b=$(g.textarea);var f=b.getSelection();var d=g.openWith;var a=$("#backgroundImagePicker");if(a.is(":visible")){a.dialog("close")}a.find("input:checked").prop("checked",false);a.find(".url").val("http://").focus();openOverlay(a,{type:"inline",title:K.backgroundImage,close:function(){var o=a.find(".url").val();var l=a.find(".repeatX:checked").length;var m=a.find(".repeatY:checked").length;var h="";if(l&&m){h="yes"}else{if(l){h="yes-x"}else{if(m){h="yes-y"}}}if(h.length){o+=" image-repeat="+h}var k=d.replace(/%image%/,o);var n="%image%".length-o.length;f.start=f.start-n;f.end=f.end-n;b.val(b.val().replace(d,k)).setSelection(f)}});var c=b.siblings(".markItUpHeader").find("."+g.className);a.parent().css("top",c.offset().top+c.height()).css("left",c.offset().left);return g}var y=v?[{name:K.bold,key:"B",openWith:"[b]",closeWith:"[/b]",className:"bold"},{name:K.italic,key:"I",openWith:"[i]",closeWith:"[/i]",className:"italic"},{name:K.fontColor,afterInsert:I,openWith:"[color=%colorCode%]",closeWith:"[/color]",placeHolder:K.textPlaceHolder,className:"fontColor"},{name:K.fontSize,className:"fontSize",dropMenu:u},{name:K.list,openWith:"[*]",multiline:true,openBlockWith:"[list]\n",closeBlockWith:"\n[/list]",className:"list",afterMultiInsert:J,placeHolder:K.textPlaceHolder},{name:K.coordinates,openWith:"[coordinates]",closeWith:"[/coordinates]",placeHolder:K.coordinatePlaceHolder,className:"coordinates"}]:[{name:K.bold,key:"B",openWith:"[b]",closeWith:"[/b]",className:"bold"},{name:K.italic,key:"I",openWith:"[i]",closeWith:"[/i]",className:"italic"},{name:K.fontColor,afterInsert:I,openWith:"[color=%colorCode%]",closeWith:"[/color]",placeHolder:K.textPlaceHolder,className:"fontColor"},{name:K.fontSize,className:"fontSize",dropMenu:u},{name:K.list,openWith:"[*]",multiline:true,openBlockWith:"[list]\n",closeBlockWith:"\n[/list]",className:"list",afterMultiInsert:J,placeHolder:K.textPlaceHolder},{name:K.link,key:"L",openWith:"[url=[!["+K.link+":!:http://]!]]",closeWith:"[/url]",placeHolder:K.textPlaceHolder,className:"link"},{name:K.coordinates,openWith:"[coordinates]",closeWith:"[/coordinates]",placeHolder:K.coordinatePlaceHolder,className:"coordinates"}];var F=v?[{name:K.underline,key:"U",openWith:"[u]",closeWith:"[/u]",className:"underline"},{name:K.stroke,key:"S",openWith:"[s]",closeWith:"[/s]",className:"strikeThrough"},{name:K.sub,openWith:"[sub]",closeWith:"[/sub]",className:"sub"},{name:K.sup,openWith:"[sup]",closeWith:"[/sup]",className:"sup"},{separator:"-"},{name:K.item,className:"item",dropMenu:G},{name:K.player,openWith:"[player]",closeWith:"[/player]",placeHolder:K.playerPlaceHolder,className:"player"},{separator:"-"},{name:K.alignLeft,openWith:"[align=left]",closeWith:"[/align]",className:"leftAlign"},{name:K.alignCenter,openWith:"[align=center]",closeWith:"[/align]",className:"centerAlign"},{name:K.alignRight,openWith:"[align=right]",closeWith:"[/align]",className:"rightAlign"},{name:K.alignJustify,openWith:"[align=justify]",closeWith:"[/align]",className:"justifyAlign"},{separator:"-"},{name:K.code,openWith:"[code]",closeWith:"[/code]",className:"code"},{separator:"-"},{name:K.email,key:"E",openWith:"[email=[!["+K.email+":!:]!]]",closeWith:"[/email]",placeHolder:K.textPlaceHolder,className:"email"},{name:K.preview,className:"preview",call:"preview"}]:[{name:K.underline,key:"U",openWith:"[u]",closeWith:"[/u]",className:"underline"},{name:K.stroke,key:"S",openWith:"[s]",closeWith:"[/s]",className:"strikeThrough"},{name:K.sub,openWith:"[sub]",closeWith:"[/sub]",className:"sub"},{name:K.sup,openWith:"[sup]",closeWith:"[/sup]",className:"sup"},{name:K.backgroundColor,afterInsert:I,openWith:"[background color=%colorCode%]",closeWith:"[/background]",placeHolder:K.textPlaceHolder,className:"backgroundColor"},{name:K.backgroundImage,afterInsert:w,openWith:"[background image=%image%]",closeWith:"[/background]",placeHolder:K.textPlaceHolder,className:"backgroundImage"},{separator:"-"},{name:K.item,className:"item",dropMenu:G},{name:K.player,openWith:"[player]",closeWith:"[/player]",placeHolder:K.playerPlaceHolder,className:"player"},{name:K.tooltip,openWith:'[tooltip position="top" text="[![Tooltip Text:!:Tooltip Text]!]"]',closeWith:"[/tooltip]",placeHolder:K.textPlaceHolder,className:"tooltip"},{separator:"-"},{name:K.alignLeft,openWith:"[align=left]",closeWith:"[/align]",className:"leftAlign"},{name:K.alignCenter,openWith:"[align=center]",closeWith:"[/align]",className:"centerAlign"},{name:K.alignRight,openWith:"[align=right]",closeWith:"[/align]",className:"rightAlign"},{name:K.alignJustify,openWith:"[align=justify]",closeWith:"[/align]",className:"justifyAlign"},{separator:"-"},{name:K.block,openWith:"[p]",closeWith:"[/p]",className:"block"},{name:K.code,openWith:"[code]",closeWith:"[/code]",className:"code"},{name:K.spoiler,openWith:"[spoiler]",closeWith:"[/spoiler]",className:"spoiler"},{separator:"-"},{name:K.hr,openWith:"[hr]",className:"hr"},{separator:"-"},{name:K.picture,key:"Z",replaceWith:"[img][!["+K.picture+":!:http://]!][/img]",className:"picture"},{name:K.email,key:"E",openWith:"[email=[!["+K.email+":!:]!]]",closeWith:"[/email]",placeHolder:K.textPlaceHolder,className:"email"},{name:K.preview,className:"preview",call:"preview"}];if(!C){$.each(F,function(a){if(this.className=="picture"||this.className=="backgroundImage"){F.splice(a,1)}})}if(isMobile){$.each(y,function(a){if(this.className=="fontColor"||this.className=="backgroundColor"){y.splice(a,1)}});$.each(F,function(a){if(this.className=="fontColor"||this.className=="backgroundColor"){F.splice(a,1)}})}var x={onShiftEnter:{keepDefault:false,replaceWith:"\n"},onCtrlEnter:{keepDefault:false,openWith:"\n[p]",closeWith:"[/p]"},onTab:{keepDefault:false,replaceWith:"\t"},markupSet:[y,F],resizeHandle:false,previewParserPath:bbcodePreviewUrl+"&imgAllowed="+(C?1:0),previewAutoRefresh:true,previewParserVar:"text",previewInElement:$('<div class="miu_preview_container"></div>'),afterInsert:function(a){$(a.textarea).trigger("keyup")}};$.colorpicker.regional.custom=K.colorPicker;A.each(function(){var a=$(this);a.markItUp(x).after($('<input type="hidden" class="colorpicker"/>').colorpicker({color:"#000000",colorFormat:"#HEX",hsv:false,parts:"popup",regional:"custom",showCancelButton:false}));x.previewInElement.insertAfter(a);$(".miu_advanced .preview").hide();var b=$('<div class="miu_footer clearfix"></div>');b.append('<a role="button" class="fright txt_link preview_link">'+K.preview+"</a>").append('<span class="fleft"><span class="cnt_chars">'+D+"</span> "+K.charsLeft+"</span>");b.insertAfter(a);$(".toggle_miu_advanced").on("click.bbCodeEditor",function(){if($(".miu_advanced").is(":visible")){$(".miu_advanced").hide();$(this).removeClass("hide_miu_advanced").addClass("show_miu_advanced")}else{$(".miu_advanced").show();$(this).removeClass("show_miu_advanced").addClass("hide_miu_advanced")}});a.on("keyup.bbCodeEditor",function(){if(a.val().length>D){a.val(a.val().substr(0,D))}a.closest(".markItUpContainer").find(".cnt_chars").html(D-a.val().length)});$(".miu_preview_container").hide();$(".preview_link").on("click.bbCodeEditor",function(){$(".miu_preview_container").show();$(".preview").click()});if(isMobile){a.siblings(".markItUpHeader").find("a").attr("title","");a.siblings(".markItUpHeader").find("li:not(.markItUpDropMenu) a").bind("mouseup",function(){a.focus()})}else{a.siblings(".markItUpHeader").find("ul ul a").attr("title","")}if($("#backgroundImagePicker").length==0){$("body").append($('<div id="backgroundImagePicker" style="display: none;"><table><tr><td>'+K.backgroundImage+':</td><td><input type="text" class="url"/></td></tr><tr><td>'+K.backgroundImagePicker.repeatX+':</td><td><input type="checkbox" class="repeatX"/></td></tr><tr><td>'+K.backgroundImagePicker.repeatY+':</td><td><input type="checkbox" class="repeatY"/></td></tr></table><div><a href="javascript:void(0);" class="btn_blue">'+K.backgroundImagePicker.ok+"</a></div></div>"));$("#backgroundImagePicker").find("a").bind("click",function(){$("#backgroundImagePicker").dialog("close")})}})}function initBBCodes(){$(document).undelegate(".spoilerHeader","click").delegate(".spoilerHeader","click",function(){var b=this;$(this).next(".spoilerText").toggle(0,function(){Tipped.refresh(b)})})}ogame.buddies={initBuddyList:function(){$.tablesorter.addParser({id:"coordinates",is:function(b){return false},format:function(g){var d=$.trim(g).slice(1,-1).split(":");var f=(d[0]*16384)+(d[1]*32)+d[2]*1;return f},type:"numeric"});$.tablesorter.addParser({id:"commaDigit",is:function(f,c){var g=c.config;return jQuery.tablesorter.isDigit(f.replace(/\./g,""),g)},format:function(b){return jQuery.tablesorter.formatFloat(b.replace(/\./g,""))},type:"numeric"});$(".content_table").tablesorter({widgets:["zebra"],headers:{0:{sorter:false},2:{sorter:"commaDigit"},5:{sorter:"coordinates"},6:{sorter:false}},cssHeader:"ct_sortable_title",cssAsc:"ct_sort_asc",cssDesc:"ct_sort_desc"});$("#buddylist").off(".buddyList");$("#buddylist").on("click.buddyList",".deleteBuddy",deleteBuddy);$("#chatContent").on("click.chat_info",".deleteBuddy",deleteBuddy)},initBuddies:function(){$(".zebra tr").mouseover(function(){$(this).addClass("over")}).mouseout(function(){$(this).removeClass("over")});$(".js_accordion").accordion({collapsible:true,heightStyle:"content"});$(".js_tabs").tabs();$(".js_scrollbar").mCustomScrollbar({theme:"ogame"})}};function initInviteCodes(){$("#buddyinvite .code").click(function(){$(this).selectText()})}function incrementBuddyCount(){var c=parseInt($("#buddyCount").text())+1;var d=parseInt($("#newRequestCount").text())-1;updateRequestCount(d);updateBuddyCount(c)}function updateRequestCount(b){$("#newRequestCount").html(b)}function updateBuddyCount(b){$("#buddyCount").html(b)}function reportMessage(g,d,f){$.ajax({type:"POST",url:"?page=reportSpam_ajax",dataType:"json",data:{messageId:g,from:d,to:f},success:function(a){fadeBox(a.message,!a.result)},error:function(){}})}function requestsReady(){$(document).on("click",".acceptRequest",acceptRequest);$(document).on("click",".rejectRequest",rejectRequest);$(document).on("click",".cancelRequest",cancelRequest);$(document).on("click",".reportRequest",reportRequest)}function initBuddyRequestForm(){$(".overlayDiv .buddyRequest form").unbind("submit").bind("submit",function(){var b=$(this);e.preventDefault();$.post(b.attr("action"),b.serialize(),"html").done(function(a){document.open();document.write(a);document.close()}).fail(function(){var a=window.location.href;window.location=a.substring(0,a.indexOf("?"))+"?page=buddies"}).always(function(){return false})});$(".buddyRequest").each(function(){var c=$(this);var d=c.parents(".ui-dialog").find(".ui-dialog-title");if(!d.find("span.buddyName").length){d.append($(document.createElement("span")).addClass("buddyName").text(" ("+c.attr("data-title")+")"))}})}function initBuyResourceOverlay(h,f,k){$(".close_buyResourceOverlay").on("click",function(){$("#buyResourceOverlayBody").closest(".ui-dialog").find(".ui-icon-closethick").click()});var g=function(){if(h&&f){errorBoxDecision(k.allNetworkAttention,k.slotWarning,k.allYes,k.allNo,sendDMAcceptanceForm)}else{sendDMAcceptanceForm()}};$("#premiumConfirmButton").on("click",function(a){a.preventDefault();g()});$(document).on("ajaxShowOverlay",function(a){$("#premiumConfirmButton").focus()});$("#premiumConfirmButton").on("keyup",function(a){a.stopPropagation();if(a.keyCode==13){g()}})}function sendDMAcceptanceForm(){$("#premiumAcceptForm").submit();return}function openBuyResourceDialog(b){openOverlay(b,{"class":"buyResourceDialog"})}function abortBuyResource(){$(".overlaydiv .abort_button").on("click",function(){$(".overlaydiv").dialog("close")})}function initBuyResources(){refreshBars("bar_container","filllevel_bar");$(".fill_resource").on("click",".fillup",onChangeToPremium).on("click",".btn_premium",submitBuyRequest)}function onChangeToPremium(h){var g=$(h.currentTarget).find(".btn_blue"),k=g.closest(".fillup"),f=g.closest(".fill_resource_ctn").find(".premium_bar");$(".fillup").removeClass("premium").parent().find(".current_stock span").removeClass("premium_txt").each(function(){var a=$(this);a.text(a.data("currentAmount"))});$(".fill_resource .btn_premium").html(loca.fillUpResource).attr("class","btn_blue");$(".premium_bar").css("width","0%").data("premiumPercent",0);if(g.attr("disabled")=="disabled"){return}g.html(loca.buyNow).attr("class","btn_premium small");k.addClass("premium");k.parent().find(".current_stock span").addClass("premium_txt").text(g.data("newValueFormatted"));f.data("premiumPercent",g.data("premiumPercent"));changeTooltip(f,"+"+tsdpkt(Math.floor(g.data("premiumValue"))));refreshBars("bar_container","filllevel_bar","premium_bar")}function submitBuyRequest(m){var o=$(m.currentTarget),n=o.data("resource"),h=o.data("premiumCosts"),l=o.data("packageType"),k=o.data("traderBuyResource");$.ajax({url:"index.php?page=traderOverview",data:{buyResource:n,buyPackage:l,costs:h,token:k,ajax:1},type:"POST",dataType:"json",success:function(a){refreshToken=function(b){$(".btn_blue").each(function(){$(this).data("traderBuyResource",b)})};refreshToken(a.buyResourceToken);if(!a.success){fadeBox(a.message,true);return}getAjaxResourcebox(function(b){$(".fill_resource .bar_container").each(function(){var c=$(this);c.data("currentAmount",b[c.data("resource")]["resources"]["actual"]);c.parent().find(".current_stock span").html(a[c.data("resource")]).data("currentAmount",a[c.data("resource")]);refreshBars("fill_resource .bar_container","filllevel_bar")})});$(".fill_resource .fillup").each(function(){var b=$(this);var c=b.find("a");var f=c.data("resource");var g=c.data("packageType");if(!a.possiblePackages[f][g]["isBuyable"]){c.attr("disabled","disabled");b.attr("disabled","disabled");b.addClass("disabled")}c.data("premiumCosts",a.possiblePackages[f][g]["costs"]);c.data("premiumValue",a.possiblePackages[f][g]["resources"]);c.data("newValueFormatted",a.possiblePackages[f][g]["newValueFormatted"]);if(a.possiblePackages[f][g]["displayCosts"]){b.find(".fillup_cost .premium_txt").html(a.possiblePackages[f][g]["formattedCosts"])}else{b.find(".fillup_cost").addClass("overmark").html("-")}if(g==3){var d=c.data("buyButtonClass");if(!a.possiblePackages[f][g]["isCapped"]&&b.children("."+d).length){b.children("."+d).removeClass(d).addClass("fillup_100percent");b.children(".fillup_txt").html(loca.fillUpTo)}}})},error:function(){}})}ogame.chat={socket:null,connected:false,connecting:false,timeout:null,retryInterval:5000,playerId:null,data:{},playerList:null,isLoadingPlayerList:false,playerListSelector:new Array,initConnection:function(){var c=ogame.chat;if(c.connecting||c.connected){c.socket.disconnect()}c.connecting=true;try{c.socket=io.connect("/chat",nodeParams);c.socket.on("connect",function(){clearTimeout(this.timeout);c.socket.emit("authorize",session,function(a){c.connecting=false;if(a){c.connected=true}else{c.socket.disconnect()}})});c.socket.on("chat",function(a){c.messageReceived(a)});c.socket.on("disconnect",function(){c.connected=false;c.connecting=false})}catch(d){c.connecting=false}},initialize:function(){var b=ogame.chat;loadScript(nodeUrl,b.initConnection);$(".new_msg_count[data-playerid]").each(function(){b.saveMessageCounter($(this).data("new-messages"),$(this).data("playerid"))});this.updateTotalNewChatCounter();$(".js_playerlist").on("click",".playerlist_item",function(){var a=$(this).hasClass("nothingThere");if(!a){var d=$(this).data("msgid");if(d){b.loadChatLogWithPlayer(this,d)}else{b.loadChatLogWithPlayer(this)}}});$("#chatMsgList").on("click",".msg",function(){b.saveMessageCounter(0,$(this).data("playerid"));ogame.messagemarker.setPartnerId($(this).data("playerid"));ogame.messagemarker.updateNewMarker();ogame.chat.updateTotalNewChatCounter();var a=$(".playerlist .playerlist_item[data-playerId="+$(this).data("playerid")+"]").data("msgid");if(a){b.loadChatLogWithPlayer(this,a)}else{b.loadChatLogWithPlayer(this)}});$(".chat").on("click",".sys_msg",function(f){var g=$(this).data("foreign-player-id");var a={playerId:g,ajax:1};$.ajax({url:chatUrlLoadMoreMessages,type:"POST",dataType:"html",data:a,success:function(c){$(".chat").each(function(k,d){if(g==$(d).data("foreign-player-id")){$(d).html(c)}})},error:function(k,c,d){}})});$("body").on("click",".js_openChat",function(){b.loadChatLogWithPlayer(this)});if(typeof $.cookie("maximizeId")=="string"||typeof $.cookie("maximizeId")=="number"){$('#chatMsgList .msg[data-playerid="'+$.cookie("maximizeId")+'"]').trigger("click");$.cookie("maximizeId",null)}},getTotalNewChatCounter:function(){return ogame.messagecounter.sumNewChatMessages},updateTotalNewChatCounter:function(){var b=0;if(ogame.messagecounter.newChats!==undefined){for(key in ogame.messagecounter.newChats){if(ogame.messagecounter.newChats.hasOwnProperty(key)){b+=ogame.messagecounter.newChats[key]}}}ogame.messagecounter.initialize(ogame.messagecounter.type_chat,ogame.chat.playerId);if(ogame.messagecounter.sumNewChatMessages!==b){ogame.messagecounter.initChatCounter(b);ogame.messagecounter.sumNewChatMessages=b;ogame.messagecounter.update()}return b},retryConnection:function(){var b=ogame.chat;setTimeout(function(){b.initConnection()},5000)},sendMessage:function(s,n,m){var o=ogame.chat;if($.trim(n).length==0){r("TEXT_EMPTY");return}var v={playerId:s,text:n,mode:1,ajax:1};if(typeof m!=="undefined"&&typeof m.id!=="undefined"){v.msg2reply=m.id}function u(){$.ajax({url:chatUrl,type:"POST",dataType:"json",data:v,success:function(a){p(a)},error:function(a,b,c){}})}function q(a){if(typeof a.refAuthor!=="undefined"&&typeof a.refContent!=="undefined"){$refData={author:a.refAuthor,text:a.refContent}}else{$refData=0}o.addChatItem(a.targetId,a.text,a.id,false,$refData,a.date)}function r(a){if(chatLoca[a]!==undefined){errorBoxNotify(LocalizationStrings.error,chatLoca[a],LocalizationStrings.ok)}else{errorBoxNotify(LocalizationStrings.error,a,LocalizationStrings.ok)}}function p(a){switch(a.status){case"NOT_AUTHORIZED":u();break;case"OK":q(a);ogame.chat.cleanupUrl();break;default:r(a.status)}}u()},messageReceived:function(d){var g=ogame.chat;if(typeof d.refAuthor!=="undefined"&&typeof d.refText!=="undefined"){$refData={author:d.refAuhtor,text:d.refText}}else{$refData=0}if($(".chat_bar_list").length){if(typeof g.data[d.senderId]=="undefined"&&!(g.data[d.senderId])){g.loadChatLogWithPlayer(d.senderId,null,function(){g.addChatItem(d.senderId,d.text,d.id,true,$refData,d.date)},false)}else{g.addChatItem(d.senderId,d.text,d.id,true,$refData,d.date)}}ogame.messagemarker.setPartnerId(d.senderId);if(!g.isOpen(d.senderId)){ogame.messagecounter.initialize(ogame.messagecounter.type_chat,d.senderId);var f=parseInt(ogame.messagecounter.newChats[d.senderId]);if(isNaN(f)){f=0}f++;g.saveMessageCounter(f,d.senderId);ogame.messagemarker.updateNewMarker()}else{g.saveMessageCounter(0,$(this).data("playerid"));ogame.messagemarker.updateNewMarker()}},cleanupUrl:function(){var l=window.location.href;var k=l.indexOf("&");if(k>0){var h=l.indexOf("?");var m=l.substring(0,h);var g=m+"?page=chat";window.history.pushState({},"",g)}},saveMessageCounter:function(c,d){if(isNaN(d)||d===0){return false}$('.new_msg_count[data-playerid="'+d+'"]').data("new-messages",c);ogame.messagecounter.newChats[d]=c},isOpen:function(f){var g=false;var d=$(".chatContent").data("chatplayerid");if(d!="undefined"&&d==f){g=true}else{$(".chat_box").each(function(){if($(this).attr("data-playerid")==f){if($(this).css("display")=="block"){g=true}}})}return g},loadChatLogWithPlayer:function(q,o,m,k){var n=ogame.chat;var p;if(typeof k=="undefined"){k=true}if(typeof q=="number"){p=q}else{p=$(q).attr("data-playerId")}var l={playerId:p,mode:2,ajax:1,updateUnread:(k?1:0)};if(typeof o=="number"){l.msg2reply=o}$.ajax({url:chatUrl,type:"POST",data:l,success:function(a){a=JSON.parse(a);n.data[a.playerId]={playerstatus:a.playerstatus,playerName:a.playerName,playerId:a.playerId,chatItems:a.chatItems,chatItemsByDateAsc:a.chatItemsByDateAsc};if(typeof m=="function"){m()}else{if($(q).parents("#chatBarPlayerList").length||$("body")[0].id!="chat"){n.showChat(a)}else{n.showChatHistory(a)}}},error:function(c,a,b){}})},initChat:function(b){ogame.chat.playerId=b;ogame.chat.initPlayerlist();ogame.chat.initialize();ogame.chat.toggleVisibility();ogame.chat.setVisibilityState();ogame.chat.initMaximize();ogame.chat.getInMaxChat()},getLastChatItemData:function(){var m=ogame.chat;var k=null;$(".chat_box_ctn .mCustomScrollBox .mCSB_container").each(function(){var a=$(this).children("ul.chat").children("li:last");if(k===null||a.attr("data-chat-id")>k.attr("data-chat-id")){k=a}});if(k===null){$("ul.largeChat").each(function(){var a=$(this).children("li:last");if(k===null||a.attr("data-chat-id")>k.attr("data-chat-id")){k=a}})}var l=k.children(".msg_head").find(".msg_date").html();var g=k.find(".msg_content").html();var h={date:l,text:g};return h},addChatItem:function(E,A,C,v,y,r){var u=ogame.chat;var q=$(".chat_bar_list").find("[data-playerid='"+E+"']");var x={};x.date=getFormatedDate(r,"[d].[m].[Y] <span>[H]:[i]:[s]</span>");x.newClass="new";if(v){x.playerName=u.data[E].playerName;x.altClass=""}else{x.playerName=playerName;x.altClass="odd"}x.chatID=C;x.chatContent=A;if(typeof y=="object"){x.refData=y}if(!q.length){var D=u.createChatBarContainer(E);u.updateChatBar(D);q=$(".chat_bar_list").find("[data-playerid='"+E+"']")}var w=u.createChatItem(x);var s=u.getLastChatItemData();if(x.date!=s.date||x.chatContent!=s.text){q.find(".chat").append(w);u.updateCustomScrollbar(q.find(".chat_box_ctn"));var B=$(".js_chatHistory");if(B.length&&B.data("chatplayerid")==E){B.find(".chat.clearfix").append(w.clone());u.updateCustomScrollbar($(".largeChatContainer"))}}},addToMoreBox:function(n){var m=ogame.chat;var l=n.length;if(l&&$(".more_chat_bar_items").length<1){$(".chat_bar_list").append(m.createMoreBox("more_chat_bar_items"))}var h=$(".more_chat_bar_items .more_items");var k=$(".more_chat_bar_items .chat_box");for(var o=0;o<=l;o++){h.append(n.pop())}m.updateCustomScrollbar(k)},createChatBarContainer:function(g){var h=ogame.chat;if(!g){return}var k=h.data[g];h.data.playerId=g;var f=$('<li class="chat_bar_list_item open" data-playerid="'+g+'"></li>');f.append('<span class="playerstatus '+k.playerstatus+'"></span>');f.append('<span class="cb_playername">'+k.playerName+"</span>");f.append('<span class="icon icon_close fright"></span>');f.prepend(h.createChatBox(g));return f},closeChatBox:function(c){var d=$(".chat_bar_list_item");$.each(d,function(b,a){if($(a).data("playerid")==c){$(a).addClass("outOfChatbar");$(a).removeClass("open")}})},getVisibleChats:function(){if(typeof visibleChats=="undefined"){visibleChats=[]}return visibleChats},getVisibleChatPlayerIds:function(){var l=ogame.chat;var m=l.getVisibleChats();var k={};var h=0;for(var g=0;g<m.length;g++){if($.inArray(m[g]["partnerId"],k)==-1){k[h]=m[g]["partnerId"];h++}}return k},setVisibilityState:function(){var m=ogame.chat;var n=m.getVisibleChatPlayerIds();var k=$("#chatBar .chat_bar_list .chat_bar_list_item");for(var q=0;q<k.length;q++){var o=k.get(q);var l=$(o).data("playerid");if(!m.isInJson(l,n)){m.closeChatBox(l)}else{o.style.display="inline";if($(o).hasClass("open")){var p=$(o).find("div.chat_box")[0];p.style.display="inline";m.updateCustomScrollbar($(o).find(".chat_box_ctn"),1)}}}},isInJson:function(g,d){var f=null;if($.isEmptyObject(d)){f=false}if(f!==false){$.each(d,function(a,b){if(b==g){f=true}});if(f!==true){false}}return f},toggleVisibility:function(){$(".chat_bar_list_item .icon_close").on("click",function(g){var f=$(this).parent().data("playerid");var d=$(this).closest(".chat_box");if(!d.length){d=$(this).parent()[0];d.style.display="none"}$.ajax({type:"POST",url:"/game/index.php?page=ajaxChatToggleVisibility",data:{from:playerId,to:f,showState:0},success:function(a){},error:function(c,a,b){}})});$(".cb_playerlist_box .playerlist_item").on("click",function(){var b=$(this).data("playerid");$.ajax({type:"POST",url:"/game/index.php?page=ajaxChatToggleVisibility",data:{from:playerId,to:b,showState:1},success:function(a){},error:function(a,f,g){}})})},initMaximize:function(){$(".chat_box .chat_box_title .icon_maximize").on("click",function(){var c=$(this).parent();var d=$(c).parent().data("playerid");$.cookie("maximizeId",d);$(".chat_bar_list_item.open .chat_box_title .icon_close").trigger("click");window.location=bigChatLink})},getInMaxChat:function(){var b=location.href;if(typeof bigChatLink=="undefined"){bigChatLink=""}if(bigChatLink==b){if($.cookie("maximizeId")!==null){$("#chatMsgList .msg[data-playerId="+$.cookie("maximizeId")+"]").trigger("click")}}$.cookie("maximizeId",null)},createChatBox:function(m){var o=ogame.chat;if(!m){return}var q=o.data[m];var s=$('<div class="chat_box_title"></div>');s.append('<span class="icon icon_close fright"></span>');s.append('<span class="icon icon_maximize fright"></span>');var n=$('<div class="chat_box_ctn"><ul class="chat clearfix"></ul></div>');var l={};for(var r=0;r<q.chatItemsByDateAsc.length;r++){l=q.chatItems[q.chatItemsByDateAsc[r]];n.find(".chat").append(o.createChatItem(l))}var p=$('<div class="chat_box" data-playerid="'+m+'"></div>');p.append(s);p.append(n);p.append('<textarea name="text" class="chat_box_textarea"></textarea>');return p},createChatItem:function(n){if(!n){console.warn("no chatItem given");return}var h=$('<div class="msg_head"></div>');h.append('<span class="msg_date fright">'+n.date+"</span>");h.append('<span class="msg_title blue_txt '+n.newClass+'">'+n.playerName+"</span>");var k=$('<li class="chat_msg '+n.altClass+'" data-chat-id="'+n.chatID+'"></li>');k.append(h);if(typeof n.refData!=="undefined"){var l=$('<div class="referenceMsg"></div>');var o='<div class="refAuthor">'+n.refData.author+"</div>";var m='<div class="refText new">'+n.refData.text+"</div>";l.append(o);l.append(m);k.append(l)}k.append('<span class="msg_content">'+n.chatContent+"</span>");k.append('<div class="speechbubble_arrow"></div>');return k},createMoreBox:function(d){var c=$('<li class="chat_bar_list_item '+d+'">'+chatLoca.MORE_USERS+'<span class="icon icon_close fright"></span></li>');c.prepend($('<div class="chat_box"><ul class="more_items clearfix"></ul></div>'));return c},filterPlayerlist:function(){var m=[];var k;var l=$("#playerlistFilters").find('input[type="checkbox"]');l.each(function(){m.push($(this).attr("id"))});$(".playerlist_item").show();k=false;l.each(function(){if($(this).prop("checked")){k=true}});if(!k){return}var g;var h;$(".playerlist_item").filter(function(){g=false;h=$(this);$.each(m,function(b,a){if(h.data(a)==="off"&&$("#"+a).prop("checked")){g=true}});(g===true)?h.hide():h.show()})},initChatBar:function(d){var c=ogame.chat;ogame.chat.playerId=d;$("html").off(".chatBar");$(window).resize(function(){c.updateChatBar()});$(".chat_bar_list").on("click.chatBar","#chatBarPlayerList",function(a){if($(a.target).attr("id")!=="chatBarPlayerList"&&!$(a.target).hasClass("onlineCount")){return}$(".cb_playerlist_box").toggle();c.updateCustomScrollbar($(".scrollContainer"),true);$.ajax({url:chatUrl,type:"POST",dataType:"json",data:{action:"toggleChatBar"},success:function(b){},error:function(k,b,h){}})}).on("click.chatBar",".chat_bar_list_item",function(a){a.stopPropagation();if(!isNaN($(this).data("playerid"))){ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chattab,$(this).data("playerid"));ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chatbar,$(this).data("playerid"));c.saveMessageCounter(0,$(this).data("playerid"));ogame.messagemarker.setPartnerId($(this).data("playerid"));ogame.messagemarker.updateNewMarker();ogame.chat.updateTotalNewChatCounter()}$.ajax({url:chatUrl,type:"POST",dataType:"json",data:{playerId:$(this).data("playerid"),action:"chatBarListRead"},success:function(b){},error:function(k,b,h){}});if($(this).closest(".more_items").length){c.swapChatBarItem($(this))}else{c.toggleChatBox($(a.target),$(this))}c.updateVisibleState()}).on("click.chatBar",".chat_bar_list_item > .icon_close",function(a){a.stopPropagation();var b=$(this).closest(".chat_bar_list_item");ogame.chat.closeChatBox(b.attr("data-playerid"));b.remove("open");c.updateChatBar()}).on("keyup.chatBar",".chat_box_textarea",function(a){if((a.ctrlKey||a.keyCode==10)&&a.keyCode==13){a.preventDefault();var b=$(this).val();$(this).val(b+"\n")}else{if($.trim($(this).val().length>0)){a.preventDefault();c.submitChatBarMsg($(a.currentTarget),a.which,a.shiftKey,a.delegateTarget.scrollHeight)}}}).on("click.chatBar",".chat_box_textarea",function(a){ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chattab,$(this).parent().parent().parent().data("playerid"));ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chatbar,$(this).parent().parent().parent().data("playerid"));c.saveMessageCounter(0,$(this).data("playerid"))})},initPlayerlist:function(){var c=ogame.chat;var d=ogame.tools;$(".js_accordion").accordion({collapsible:true,heightStyle:"content"});$(".playerlist_item:odd").addClass("odd");d.addHover(".playerlist_item, .msg");$(".js_playerlist").on("click.playerList",".pl_filter_set",function(){c.filterPlayerlist()});c.filterPlayerlist()},showChat:function(k){var f=false;var h=ogame.chat;$(".chat_bar_list_item").each(function(){var a=$(this);if(a.data("playerid")===k.playerId){f=true;if(a.hasClass("outOfChatbar")){a.removeClass("outOfChatbar")}if(!a.hasClass("open")){a.click();a[0].style.display="inline"}else{a.fadeTo("400",0.3).fadeTo("400",1)}a.find("textarea").focus()}});if(!f){var g=h.createChatBarContainer(k.playerId);h.updateChatBar(g)}},showChatHistory:function(f){var d=$(".js_chatHistory");var g=f.data;if(d.length){d.remove()}$("#chatList").remove();$(g).insertAfter("#planet");$("li.playerlist_item").removeClass("active");$("li.playerlist_item[data-playerid='"+f.playerId+"']").addClass("active");initBBCodeEditor(locaKeys,itemNames,false,".new_msg_textarea",2000,true)},submitChatBarMsg:function(q,m,k,n){var p=ogame.chat;var o=parseInt($(".chat_box_textarea").css("max-height"));var l=parseInt($(".chat_box_textarea").css("padding-top"))+parseInt($(".chat_box_textarea").css("padding-bottom"));if(m===13&&k){if(n<=(o+l)){q.css("height",n-l)}return}if(m===13){p.sendMessage(q.parent(".chat_box").data("playerid"),q.val());q.val("")}},swapChatBarItem:function(d){var g=ogame.chat;var f=$(".more_chat_bar_items").prev();f.removeClass("open").find(".icon_close").hide().end().find(".chat_box").hide();f.remove();d.addClass("open").find(".icon_close").show().end().find(".chat_box").show().end().insertBefore(".more_chat_bar_items");g.addToMoreBox([f]);g.updateChatBar();g.updateCustomScrollbar(d.find(".chat_box_ctn"))},toggleChatBox:function(g,m){var k=ogame.chat;if(g.parents(".chat_box").length&&!g.hasClass("icon_close")){return}var l=m.children(".chat_box");if(l.is(":visible")){l.hide();m.removeClass("open")}else{if(!m.hasClass("more_chat_bar_items")){m.addClass("open");k.updateChatBar()}l.show();var h=l.find(".chat_box_ctn");if(m.hasClass("more_chat_bar_items")){h=l}k.updateCustomScrollbar(h);l.find("textarea").focus()}ogame.messagecounter.resetCounterByType(ogame.messagecounter.type_chat)},handleTooMuchWindows:function(p,m,v,u,q,s){var r=ogame.chat;var o=true;var n=[];$($(".chat_bar_list > .chat_bar_list_item").get().reverse()).each(function(){var a=$(this);if(o){if(a.hasClass("more_chat_bar_items")||a.attr("id")==="chatBarPlayerList"){return}if(a.hasClass("open")){p--}else{m--}a.removeClass("open").find(".icon_close").hide().end().find(".chat_box").hide();n.push(a);a.remove();widthTotal=u*m+v*p+q;o=(widthTotal>=s)?true:false}});r.addToMoreBox(n)},getItemFromMorelist2Chatbar:function(){var c=$(".more_items .chat_bar_list_item").first().remove();var d=ogame.chat;c.addClass("open").find(".icon_close").show().end().find(".chat_box").show().end().insertBefore(".more_chat_bar_items");if($(".more_items .chat_bar_list_item").length<=0){$(".more_chat_bar_items").remove()}d.updateCustomScrollbar($(".more_chat_bar_items>.chat_box"));d.updateCustomScrollbar(c.find(".chat_box_ctn"))},updateChatBar:function(o){var s=ogame.chat;var p=$(".chat_bar_list > .chat_bar_list_item.open").length;var w=$(".more_chat_bar_items").length;var n=$(".chat_bar_list").children().length-p-w;var v=190;var x=270;var r=190;var u=$("body").innerWidth();if(o){p++}var q=v*n+x*p+r*w;if(q>=u){s.handleTooMuchWindows(p,n,x,v,r,u)}else{if((q+x)<=u&&$(".more_chat_bar_items").length>0){s.getItemFromMorelist2Chatbar()}}if(o){o.insertAfter("#chatBarPlayerList");s.updateCustomScrollbar(o.find(".chat_box_ctn"))}},updateCustomScrollbar:function(c,d){if(!c||c.length==0){return}if(c.hasClass("mCustomScrollbar")){c.mCustomScrollbar("update")}else{c.mCustomScrollbar({theme:"ogame"})}if(d!==true){c.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0})}c.each(function(){if($(this).height()+"px"==$(this).css("max-height")){$(this).addClass("scrollbarPresent")}})},updateVisibleState:function(){var b=[];$(".chat_bar_list>.chat_bar_list_item").each(function(){var a=$(this);if(a.attr("id")==="chatBarPlayerList"&&a.children(".cb_playerlist_box").is(":visible")){b.push(0)}else{if(a.data("playerid")&&a.children(".chat_box").is(":visible")){b.push(a.data("playerid"))}}});$.cookie("visibleChats",JSON.stringify(b),{expires:7})},showPlayerList:function(d){var c=ogame.chat;if($.inArray(d,c.playerListSelector)===-1){c.playerListSelector.push(d)}if(c.isLoadingPlayerList===false&&c.playerList===null){c.isLoadingPlayerList=true;$.ajax({url:chatUrl,type:"POST",dataType:"json",data:{action:"showPlayerList"},success:function(a){c.playerList=a.content;c.isLoadingPlayerList=false;c._showPlayerList()},error:function(g,a,b){c.isLoadingPlayerList=false}})}else{c._showPlayerList()}},_showPlayerList:function(){var b=ogame.chat;$.each(b.playerListSelector,function(a,d){$(d).html(b.playerList)})}};function countdown(m,h,g){if(h==null||h==""){h=2}var k=this;k.countValue=parseInt(g)||-1;k.timestamp=0;k.maxDigits=parseInt(h);k.delimiter=" ";k.approx="";k.showunits=true;k.zerofill=false;var l=new Date();k.startTime=l.getTime();k.startLeftoverTime=parseInt(m);this.getCurrentTimestring=function(){return k.formatTime(k.getLeftoverTime())};this.getLeftoverTime=function(){var a=new Date();return Math.round((k.startLeftoverTime+((a.getTime()-k.startTime)*k.countValue)/1000))};this.formatTime=function(a){return formatTimeWrapper(a,k.maxDigits,k.showunits,k.delimiter,k.zerofill,k.approx)}}function formatTimeWrapper(p,v,r,w,u,o){var k=[];k.week=604800;k.day=86400;k.hour=3600;k.minute=60;k.second=1;var x="";for(var s in k){var q=Math.floor(p/k[s]);if(v>0&&(q>0||u&&x!="")){p=p-q*k[s];if(x!=""){x+=w;if(q<10&&q>0&&u){q="0"+q}if(q==0){q="00"}}x+=q+(r?LocalizationStrings.timeunits["short"][s]:"");v--}}if(p>0){x=o+x}return x}function bauCountdown(l,m,g,h){if(typeof(l)=="object"){var k=this;k.totalTime=g;k.startHeight=l.offsetHeight;k.htmlObj=$(l);k.timeHtmlObj=k.htmlObj.siblings(".timeLink").find(".time");this.updateCountdown=function(){k.countdown.getCurrentTimestring();timestamp=k.countdown.getLeftoverTime();timestring=k.countdown.getCurrentTimestring();k.timeHtmlObj.text(timestring);var a=Math.max(0,timestamp)/k.totalTime;if(a>0){var b=Math.round(k.startHeight*a);k.htmlObj.css({height:b+"px",marginTop:(k.startHeight-b)+"px"})}else{k.timeHtmlObj.text(LocalizationStrings.status.ready);k.htmlObj.css({height:k.startHeight+"px",marginTop:0});if(timestamp<=-1&&timestamp>-10&&!isOverlayOpen()){reload_page(h)}}};if(k.timeHtmlObj.length){k.countdown=new countdown(m);timerHandler.appendCallback(k.updateCountdown);k.updateCountdown()}else{window.status="kein timeHtmlObj"}}}function schiffbauCountdown(p,l,n,r,s,m){if(typeof(p)=="object"){var o=this;o.totalTime=s;o.oneShipTime=s;o.shipCount=l;o.currentShips=n;o.startHeight=p.offsetHeight;o.htmlObj=$(p);var q=o.htmlObj.siblings(".timeLink");o.timeHtmlObj=q.find(".time");o.countHtmlObj=$("#shipcount");o.shipsHtmlObj=$("#bestand");this.updateCountdown=function(){o.countdown.getCurrentTimestring();timestamp=o.countdown.getLeftoverTime();timestring=o.countdown.getCurrentTimestring();o.timeHtmlObj.text(timestring);var a=Math.max(0,timestamp)/o.totalTime;if(a>0){var b=Math.round(o.startHeight*a);o.htmlObj.css({height:b+"px",marginTop:(o.startHeight-b)+"px"})}else{if(o.shipCount>0){o.shipCount--;o.currentShips++}if(o.shipCount>=0){o.countHtmlObj.text(o.shipCount);$("#shipcount").text(o.shipCount)}o.shipsHtmlObj.text(gfNumberGetHumanReadable(o.currentShips));if(o.shipCount>0){o.countdown=new countdown(s);o.timeHtmlObj.text("-")}else{if(timestamp<=-1&&timestamp>-10){if(m!=null&&timestamp>-10&&!isOverlayOpen()){reload_page(m)}timerHandler.removeCallback(o.timer)}o.timeHtmlObj.text(LocalizationStrings.status.ready)}}};if(o.timeHtmlObj&&o.countHtmlObj&&o.shipsHtmlObj){totalTime=Math.floor(l*s);o.countdown=new countdown(r);o.timer=timerHandler.appendCallback(o.updateCountdown);o.updateCountdown()}else{window.status="kein: timeHtmlObj oder countHtmlObj oder shipsHtmlObj"}}}function baulisteCountdown(l,g,h,m){if(typeof(l)=="object"){var k=this;k.timeHtmlObj=l;k.updateCountdown=function(){var a=k.countdown.getLeftoverTime();if(a>0){$(k.timeHtmlObj).html(k.countdown.getCurrentTimestring())}else{$(k.timeHtmlObj).html(LocalizationStrings.status.ready);if(typeof(m)=="function"){m()}if(a<=-1&&a>-10){if(h!=null&&a>-10&&!isOverlayOpen()){reload_page(h)}timerHandler.removeCallback(k.timer)}}};if(k.timeHtmlObj){k.countdown=new countdown(g,3);k.timer=timerHandler.appendCallback(k.updateCountdown);k.updateCountdown()}}}function eventboxCountdown(m,o,k,n,h){if(typeof(m)=="object"){var l=this;l.timeHtmlObj=m;this.updateCountdown=function(){l.countdown.getCurrentTimestring();var a=l.countdown.getLeftoverTime();var b=l.countdown.getCurrentTimestring();if(a>0){$(l.timeHtmlObj).html(b)}else{timerHandler.removeCallback(l.timer);$(l.timeHtmlObj).html(LocalizationStrings.status.ready);if(!timerHandler.checkEventsAlreadyQueued){timerHandler.checkEventsAlreadyQueued=true;setTimeout(function(){$.post(n,{ids:h},function(f){var d=$.parseJSON(f);for(var c in d.rows){$(k).find("#eventRow-"+d.rows[c]).remove();$(".union"+d.rows[c]).remove()}$(".eventFleet").removeClass("odd");$(".partnerInfo").removeClass("part-even");$(".eventFleet:odd").addClass("odd");$(".partnerInfo:even").addClass("part-even");timerHandler.checkEventsAlreadyQueued=false})},2500)}}};if(l.timeHtmlObj){l.countdown=new countdown(o,3);l.timer=timerHandler.appendCallback(l.updateCountdown);l.updateCountdown()}}}function simpleCountdown(l,h,m,g){if(typeof(l)=="object"){var k=this;k.timeHtmlObj=$(l)[0];this.updateCountdown=function(){var a=k.countdownObject.getLeftoverTime();var b=k.countdownObject.getCurrentTimestring();if(a>0){$("#"+k.timeHtmlObj.id).text(b);if(typeof g=="string"&&$.isFunction(window[g])){window[g]()}else{if($.isFunction(g)){g()}}}else{timerHandler.removeCallback(k.timer);$("#"+k.timeHtmlObj.id).text(LocalizationStrings.status.ready);if(typeof m=="string"&&$.isFunction(window[m])){window[m]()}else{if($.isFunction(m)){m()}}}};if(typeof(k.timer)!="undefined"){timerHandler.removeCallback(k.timer)}if(k.timeHtmlObj){k.countdownObject=new countdown(h,3);k.timer=timerHandler.appendCallback(k.updateCountdown);k.updateCountdown()}}}function countdownWithTickFunction(n,q,k,o,p,l){if(typeof(n)=="object"){var m=this;m.timeHtmlObj=n;if(typeof($(n).attr("data-countdown"))!="undefined"){timerHandler.removeCallback($(n).attr("data-countdown"))}this.updateCountdown=function(){timestamp=m.countdown.getLeftoverTime();timestring=m.countdown.getCurrentTimestring();if(timestamp>0){m.timeHtmlObj.innerHTML=timestring;if(typeof p=="string"&&$.isFunction(window[p])){window[p](timestamp,k)}else{if($.isFunction(p)){p(timestamp,k)}}}else{timerHandler.removeCallback(m.timer);m.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(typeof o=="string"&&$.isFunction(window[o])){window[o]()}else{if($.isFunction(o)){o()}}}};if(m.timeHtmlObj){m.countdown=new countdown(q,l);m.timer=timerHandler.appendCallback(m.updateCountdown);m.updateCountdown();$(n).attr("data-countdown",m.timer)}return m}}function reloadCountdown(k,f,g){if(typeof(k)=="object"){var h=this;h.timeHtmlObj=k;this.updateCountdown=function(){h.countdown.getCurrentTimestring();timestamp=h.countdown.getLeftoverTime();timestring=h.countdown.getCurrentTimestring();if(timestamp>0){h.timeHtmlObj.innerHTML=timestring}else{h.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(timestamp<=-2&&timestamp>-10&&!isOverlayOpen()){reload_page(g)}}};if(h.timeHtmlObj){h.countdown=new countdown(f,3);timerHandler.appendCallback(h.updateCountdown);h.updateCountdown()}}}function movementImageCountdown(n,q,o,l,k,p){if(typeof(n)=="object"){var m=this;m.timeHtmlObj=n;this.updateCountdown=function(){m.countdown.getCurrentTimestring();var a=m.countdown.getLeftoverTime();var b=m.countdown.getCurrentTimestring();if(a>0){percent=100-a/(o/100);if(!l){pixel=Math.abs((p/100)*percent)}else{pixel=(p*2)-Math.abs(((p*2)/100)*percent)}pixel=Math.round(pixel);if(k){m.timeHtmlObj.style.marginRight=pixel+"px"}else{m.timeHtmlObj.style.marginLeft=pixel+"px"}}};if(m.timeHtmlObj){m.countdown=new countdown(q,3);timerHandler.appendCallback(m.updateCountdown);m.updateCountdown()}}}function shipCountdown(s,p,m,r,v,n,o,q){if((typeof(s)=="object")&&(typeof(p)=="object")&&(typeof(m)=="object")){var u=this;u.totalTimeHtmlObj=s;u.unitTimeHtmlObj=p;u.sumCountHtmlObj=m;this.updateCountdown=function(){u.unitCountdown.getCurrentTimestring();unitTimestamp=u.unitCountdown.getLeftoverTime();unitTimestring=u.unitCountdown.getCurrentTimestring();u.totalCountdown.getCurrentTimestring();totalTimestamp=u.totalCountdown.getLeftoverTime();totalTimestring=u.totalCountdown.getCurrentTimestring();if(unitTimestamp>0){u.unitTimeHtmlObj.innerHTML=unitTimestring}else{o--;u.unitTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(o>0){u.unitCountdown=new countdown(r);u.sumCountHtmlObj.innerHTML=o}else{u.sumCountHtmlObj.innerHTML=0}}if(o>0){u.totalTimeHtmlObj.innerHTML=totalTimestring}else{u.totalTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(!isOverlayOpen()){reload_page(q)}}};if((u.totalTimeHtmlObj)&&(u.unitTimeHtmlObj)&&(u.sumCountHtmlObj)){u.totalCountdown=new countdown(n);u.unitCountdown=new countdown(v);timerHandler.appendCallback(u.updateCountdown);u.updateCountdown()}}}function reload_page(b){if(timerHandler&&timerHandler.pageReloadAlreadyTriggered==false){timerHandler.pageReloadAlreadyTriggered=true;openParentLocation(b)}}function initItemActivation(c){inventoryObj.initalizeSlider(inventoryObj.items_inventory,"js_activeItemSlider",395,172," ",true," ",true,true);if(typeof(c)=="undefined"||c.length==0||c==1){var d=$(".item_img_box .detail_button").filter(":first");if(d.length===0){$("#noItems").show();$("#itemDetailBox").hide();return}else{$.bbq.pushState({item:d.attr("ref")})}}else{$.bbq.pushState({item:c});$(window).trigger("hashchange")}$("#activeBuffDetails .js_is_active").each(function(){$durationEl=$(this).parent().siblings(".js_duration");$pusherEl=$(this).parent().siblings(".pusher");startCooldown($durationEl,$pusherEl,75)});$(document).undelegate("#activeBuffDetails .detail_button","click.updateItemDetails").delegate("#activeBuffDetails .detail_button","click.updateItemDetails",function(){if($(this).hasClass("active")){return}$("#activeBuffDetails .detail_button").removeClass("active");$(this).addClass("active");$.bbq.pushState({item:$(this).attr("ref")})}).undelegate("#activeBuffDetails .build-it","click.activateItem").delegate("#activeBuffDetails .build-it","click.activateItem",function(){activateItem($(this).attr("ref"))}).undelegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem").delegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem",function(){if(vacation){return}var a=$(this).attr("ref");if($("#js_activeItemSlider>li a[ref='"+a+"']").length==0){return}errorBoxDecision(LocalizationStrings.error,translation.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=$("#darkmatter_box a").attr("href")})}).undelegate("#activeBuffDetails .close_detail","click.changeHash").delegate("#activeBuffDetails .close_detail","click.changeHash",function(){$.bbq.pushState({item:""})})}function initBuffBar(){$(".sliderWrapper .active_items").anythingSlider({resizeContents:false,buildNavigation:false,buildStartStop:false,infiniteSlides:false,stopAtEnd:true});$(".sliderWrapper .active_items").removeClass("hidden");$(window).unbind("hashchange.openBuffBar").bind("hashchange.openBuffBar",function(l){var m=$.deparam.fragment(l.fragment);if(typeof(m.item)!="undefined"){var g=$("#buffBar .activate_item");$("#buffBar a").removeClass("active");var k=m.item;if(k!=""){if($("#activeBuffDetails:visible").length){if(typeof(inventoryObj.items_inventory[k])=="undefined"){var h=$("#activeBuffDetails .detail_button").filter(":first");$.bbq.pushState({item:h.attr("ref")});return}$("#buffBar a[ref='"+m.item+"']").addClass("active");g.addClass("active");$("#noItems").hide();$("#itemDetailBox").show();updateItemDetails(k)}else{$("#buffBar a[ref='"+m.item+"']").addClass("active");g.addClass("active");gfSlider.slideIn(getElementByIdWithCache("detail"),k)}}else{if($("#activeBuffDetails .detail_button").filter(":first").length===0){$("#noItems").show();$("#itemDetailBox").hide()}$("#activeBuffDetails .close_details").click();g.removeClass("active")}}});$(document).undelegate("#buffBar a","click.openDetails").delegate("#buffBar a","click.openDetails",function(){if($(this).hasClass("active")){$.bbq.pushState({item:""})}else{$.bbq.pushState({item:$(this).attr("ref")})}});$("#buffBar").unbind("click.openDetails").bind("click.openDetails",function(b){if(!$(b.target).is("#buffBar .activate_item")&&!$(b.target).is(".arrow a")){$("#buffBar .activate_item").click()}});$("#buffBar .active_items div:not(.activate_item)").each(function(){$durationEl=$(this).find(".js_duration");$pusherEl=$(this).find(".pusher");startCooldown($durationEl,$pusherEl,32)});$(window).trigger("hashchange")}function getItem(b){if(typeof(inventoryObj.items_inventory[b])!="undefined"){return inventoryObj.items_inventory[b]}return null}function updateItemDetails(f){var k=getItem(f);$("#activeBuffDetails .detail_button").removeClass("active");$('#activeBuffDetails .detail_button[ref="'+f+'"]').addClass("active");$("#activeBuffDetails .js_itemName").html(k.name);$("#activeBuffDetails .js_itemEffect").html(k.effect);$("#activeBuffDetails .js_itemAmount").html(k.amount);if(k.firstStatus){$("#activeBuffDetails .js_itemDurationStatus").html(translation.durationType[k.firstStatus])}else{$("#activeBuffDetails .js_itemDurationStatus").html(translation.durationType.effecting)}if(k.duration){if(k.durationExtension){$("#activeBuffDetails .js_itemDuration").html(formatTimeWrapper(k.duration,2,true," ",false,"")+k.durationExtension)}else{$("#activeBuffDetails .js_itemDuration").html(formatTimeWrapper(k.duration,2,true," ",false,""))}}else{if(k.duration===null){if(k.moonOnlyItem){$("#activeBuffDetails .js_itemDuration").html(translation.permanentMoon)}else{$("#activeBuffDetails .js_itemDuration").html(translation.permanent)}}else{$("#activeBuffDetails .js_itemDuration").html(translation.now)}}if(k.timeLeft){$("#activeBuffDetails .js_itemTimeLeftTxt").show();$("#activeBuffDetails .js_itemTimeLeft").html(formatTimeWrapper(k.timeLeft,2,true," ",false,""))}else{$("#activeBuffDetails .js_itemTimeLeftTxt").hide()}var h=$("#activationButton");h.attr("ref",f);h.removeClass("buyAndActivate activateItem build-it_disabled build-it dm bp").addClass(k.currency);if(k.amount>0){h.addClass("activateItem").html("<span>"+((k.timeLeft>0&&k.extendable)?translation.extend:translation.activate)+"</span>").addClass(k.canBeActivated?"build-it":"build-it_disabled")}else{var g=(k.timeLeft>0&&k.extendable)?translation.buyAndExtend:translation.buyAndActivate;g=g.replace(/%price%/,tsdpkt(k.costs));g=g.replace(/%currency%/,translation.currencies[k.currency]);h.addClass("buyAndActivate").html("<span>"+g+"</span>").addClass(k.canBeBoughtAndActivated&&k.hasEnoughCurrency?"build-it":"build-it_disabled")}}function activateItem(f){var g={ajax:1,token:activateToken,referrerPage:$.deparam.querystring().page};var k=getItem(f);if(k.amount>0){g.item=f}else{g.buyAndActivate=f}function h(){$.ajax({cache:false,url:inventoryObj.inventoryUrl,data:g,type:"POST",dataType:"json",success:function(F,Q,D){activateToken=F.newToken;if(F.error){fadeBox(F.message,true);return}if(F.message.reload){location.href=getRedirectLink();return}fadeBox(F.message.message,false);if(F.message.buff!=false){var J=getItem(F.message.buff);var H=true;var R=$(".active_items");var b=R.data("AnythingSlider");var I;R.find("li a").removeClass("active");R.find("li a.activate_item").addClass("active");R.find("div[data-id="+F.message.buffId+"]").each(function(){$(this).hide().show("pulsate").find("a").addClass("active");H=false;I=$(this)});if(H==true){var O=$('<div data-uuid="'+J.ref+'" data-id="'+F.message.buffId+'"><div class="js_duration" style="display: none;"></div><a href="javascript:void(0);" ref="'+J.ref+'" class="detail_button slideIn active_item active r_'+F.message.item.rarity+' border3px tooltipHTML" title="'+F.message.item.toolTip+'"><div class="pusher" style="height: 0%; "></div><img src="/cdn/img/item-images/'+J.image+'-small.png" alt=""/></a></div>');var E=14;var c=b.currentPage;var a=b.options.animationTime;if(typeof(F.message.upgraded)!="undefined"){for(var S in F.message.upgraded){var G=F.message.upgraded[S];R.find("div[data-uuid="+G+"]").remove()}var L=$(document.createDocumentFragment());var P=R.find("li > div");P.each(function(m,l){if(m%E==0){}$(this).appendTo(L.children().last())});b.updateSlider()}var K=R.children().last().children().length;if(K<E){O.hide().appendTo(R.children().last()).show("pulsate");if(c==b.pages){b.options.animationTime=0}b.gotoPage(b.pages);if(c==b.pages){b.options.animationTime=a}}else{O=O.hide().wrap("<li/>");O.parent().appendTo(R).children().last();b.updateSlider();if(c==b.pages){b.options.animationTime=0}b.gotoPage(b.pages);if(c==b.pages){b.options.animationTime=a}O.show("pulsate")}I=O}else{console.log(J.ref);var M=$('<div data-uuid="'+J.ref+'" data-id="'+F.message.buffId+'"><div class="js_duration" style="display: none;"></div><a href="javascript:void(0);" ref="'+J.ref+'" class="detail_button slideIn active_item active r_'+F.message.item.rarity+' border3px tooltipHTML" title="'+F.message.item.toolTip+'"><div class="pusher" style="height: 0%; "></div><img src="/cdn/img/item-images/'+J.image+'-small.png" alt=""/></a></div>');var G=J.ref;R.find("div[data-uuid="+G+"]").remove();M.hide().appendTo(R.children().last()).show("pulsate");I=M}}var d=I.find(".pusher");var N=I.find(".js_duration");N.attr("data-total-duration",F.message.totalDuration).text(F.message.item.timeLeft);startCooldown(N,d,32);getAjaxResourcebox();$.ajax({type:"POST",url:detailUrl,data:{type:f},beforeSend:function(){$("#detailWrapper .detail_screen").html('<p class="ajaxLoad">'+LocalizationStrings.loading+"</p>")},success:function(l){$("#detailWrapper .detail_screen").html(l)}})},error:function(a){fadeBox("Error!",true)}})}if(k.isAnUpgrade){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,h);return}h()}function initEmpireEquipment(){$(".overview_equipment .item_img_box .hidden").each(function(){startCooldown($(this),$(this).parent().parent().find(".pusher"),32)})}function startCooldown(f,g,h){if($.trim(f.text()).match(/^\d+$/)){var k=new countdownWithTickFunction(f[0],parseInt($.trim(f.text())),parseInt(f.attr("data-total-duration")),function(){location.href=getRedirectLink()},function(b,a){var d=1-(b/a);var c=Math.floor(h*d);g.css("height",c+"px")})}}function errorBoxAsArray(b){if(b.type=="notify"){notifyBoxAsArray(b)}else{if(b.type=="decision"){decisionBoxAsArray(b)}else{if(b.type=="fadeBox"){fadeBox(b.text,b.failed)}}}}function notifyBoxAsArray(b){errorBoxNotify(b.title,b.text,b.buttonOk,String(b.okFunction),b.removeOpen,b.modal)}function fadeBox(d,f,g){if(f){$("#fadeBoxStyle").attr("class","failed")}else{$("#fadeBoxStyle").attr("class","success")}$("#fadeBoxContent").html(d);$("#fadeBox").stop(false,true).show().fadeOut(10000,g)}function decisionBoxAsArray(b){errorBoxDecision(b.title,b.text,b.buttonOk,b.buttonNOk,String(b.okFunction),String(b.nokFunction),b.removeOpen)}function errorBoxDecision(r,u,A,o,w,y,x){var s=getIEVersion()<=9&&(x||false);var q=$("#errorBoxDecision");q.find("#errorBoxDecisionHead").html(r);q.find("#errorBoxDecisionContent").html(u);var p=function(a){a.stopPropagation();if(typeof(q.data("uiDialog"))!="undefined"){q.dialog("destroy")}if(typeof(w)=="function"){w()}if(w=="submit_form"){$("#planetMaintenanceDelete").submit()}};var v=function(a){a.stopPropagation();if(typeof(q.data("uiDialog"))!="undefined"){q.dialog("destroy")}if(y=="checkPassword"){location.reload()}if(typeof(y)=="function"){y()}};q.find(".yes, .no").unbind("click");q.unbind("keydown.yesHandler");setTimeout(function(){var b=q.find(".yes");var a=q.find(".no");b.unbind("click").bind("click",p).focus().find("#errorBoxDecisionYes").html(A);a.unbind("click").bind("click",v).find("#errorBoxDecisionNo").html(o);if(s){b.attr("href","#");a.attr("href","#")}else{b.attr("href","javascript:void(0);");a.attr("href","javascript:void(0);")}q.bind("keydown.yesHandler",function(c){if(c.which==KeyEvent.DOM_VK_RETURN){q.find(".yes").trigger("click")}})},100);Tipped.hideAll();q.dialog({resizable:false,modal:true,title:r,close:v,width:400,dialogClass:"errorBox"})}function errorBoxNotify(o,q,n,r,s){var p=getIEVersion()<=9&&(s||false);var m=$("#errorBoxNotify");m.find("#errorBoxNotifyHead").html(o);m.find("#errorBoxNotifyContent").html(q);var v=function(a){a.stopPropagation();m.dialog("destroy");if(typeof(r)=="function"){r()}else{if(typeof(window[r])=="function"){window[r]()}}};var u=m.find(".ok");u.unbind("click").bind("click",v).find("#errorBoxNotifyOk").html(n);if(p){u.attr("href","#")}else{u.attr("href","javascript:void(0);")}Tipped.hideAll();m.dialog({resizable:false,modal:true,title:o,close:v,width:400,dialogClass:"errorBox"})}function eventBDayInitGalaxy(){if(isMobile){$(".js_bday_details").hide();$(".bdaySlotBox .name").click(function(b){$(".row").children().each(function(){if($(this).html().trim()){$(this).removeClass("active")}});$(".bdaySlotBox .name").removeClass("active");$(".js_detailRow").hide();$(this).toggleClass("active");if($(b.target).attr("class").indexOf("planet")!==-1){$(".js_detailRowPlanet17").toggle()}else{if($(b.target).attr("class").indexOf("debris")!==-1){$(".js_detailRowDebris17").toggle()}}})}}function eventBDayInit(){var b=$(".event_box");$("#eventBDayWrapper").click(function(a){if($(a.target).attr("id")==="BDayContent"||$(a.target).attr("id")==="BDayEventClose"||$(a.target).closest("#BDayHeader").length>0){b.hide();$(".bday_box").removeClass("active")}a.stopPropagation()});$(".bday_box").click(function(d){$(".bday_box").removeClass("active");var a=$(d.target).closest(".bday_box").attr("id").replace("box","");b.removeClass().addClass("event_box "+eventBoxData[a].eventTypeClass);if(eventBoxData[a]!==undefined){b.attr("id","eventBox"+a).show();$("#box"+a).addClass("active");if(eventBoxData[a].eventTypeClass!=="future"){$("#eventBox"+a+" #BDayEventDate").html(eventBoxData[a].date+": ")}else{$("#eventBox"+a+" #BDayEventDate").html("")}$("#eventBox"+a+" #BDayEventTitle").html(eventBoxData[a].title);$("#eventBox"+a+" #BDayofficerImg").attr("src",eventBoxData[a].eventOfficerImgSrc);if(eventBoxData[a].eventTypeClass!=="future"||eventBoxData[a].txtChronic!==undefined){$("#eventBox"+a+" #BDayEventTxtChronic").html(eventBoxData[a].txtChronic);$("#eventBox"+a+" #BDayChronic").show()}else{$("#eventBox"+a+" #BDayChronic").hide()}if(eventBoxData[a].eventImgSrc===undefined&&eventBoxData[a].eventTypeClass==="future"){$("#eventBox"+a+" #BDayEventImg").attr("src","//gf3.geo.gfsrv.net/cdn82/d995359d038c9a0c21aed16b3cc162.png")}else{$("#eventBox"+a+" #BDayEventImg").attr("src",eventBoxData[a].eventImgSrc)}if(eventBoxData[a].eventTxtDesc===undefined){$("#eventBox"+a+" #BDayEventTxtDesc").html("")}else{$("#eventBox"+a+" #BDayEventTxtDesc").html(eventBoxData[a].eventTxtDesc)}$("#eventBox"+a+" #BDayEventPastTxt").hide();if(eventBoxData[a].eventTypeClass==="past"){$("#eventBox"+a+" #BDayEventPastTxt").html(eventPastTxt).show()}$("#eventBox"+a+" #BDayEventBtnCTA").hide();if((eventBoxData[a].eventTypeClass!==("past"||"future"))&&eventBoxData[a].btnCTA!==undefined){$("#eventBox"+a+" #BDayEventBtnCTA").html(eventBoxData[a].btnCTA).attr("href",eventBoxData[a].btnCTALink).show()}}})}function initBDayEventHints(){$(document).undelegate(".event_build_faster, .event_active_hint","click").delegate(".event_build_faster, .event_active_hint","click",function(b){b.stopPropagation();if($(this).parent().attr("id")==="expeditionbutton"){doExpedition()}else{$(this).siblings(".detail_button").click()}})}function initEventTable(){$(".eventFleet:odd").addClass("odd");$(".partnerInfo:even").addClass("part-even");$(".partnerInfo").hide();$(document).undelegate(".toggleDetails","click").delegate(".toggleDetails","click",function(){var b=$(".partnerInfo."+$(this).attr("rel"));if($(b).is(":hidden")){$(b).show();$(this).parents("tr").addClass("detailsOpened").removeClass("detailsClosed")}else{$(b).hide();$(this).parents("tr").addClass("detailsClosed").removeClass("detailsOpened")}})}function initExodus(){if($("#exodus-indicator").length&&exodus.ready==false){exodus.ready=true;exodus.createIndicator();var d=function(a){if($("#exodus-timer").hasClass("end-soon")){return}if(a<86400){$("#exodus-timer").addClass("end-soon")}};var c=parseInt($("#exodus-timer").attr("data-timeleft"));d(c);new simpleCountdown(getElementByIdWithCache("exodus-timer"),c,function(){$("#exodus-timer").remove()},function(a){d(a)})}}var exodus={ready:false,noServers:true,secondaryShown:false,createIndicator:function(){exodus.indicator=$("#exodus-indicator");if(exodus.indicator.length>0){exodus.indicator.bind("click",exodus.showDialog)}},appendServerRow:function(k,m,n,p){var q=(exodus.data["migration-host"]==m.host);var l=$('<li class="'+(exodus.odd++%2?"odd":"even")+'" id="server-'+m.id+'"/>').bind("click",function(){if($(this).hasClass("disabled")){return}else{if($(this).hasClass("row-selected")){exodus.confirmButton.removeClass("confirm");$(this).removeClass("row-selected");exodus.markedServer=null}else{exodus.markedServer=m;if(exodus.markedServer!=exodus.selectedServer){exodus.confirmButton.addClass("confirm")}else{if(exodus.confirmButton.hasClass("confirm")){exodus.confirmButton.removeClass("confirm")}}k.find("li").removeClass("row-selected");$(this).addClass("row-selected")}}}).hide().append($('<span class="exodus-universe-treeview-column-checkbox"/>').append($("<span/>"))).append($('<span class="exodus-universe-treeview-column-name"/>').text(m.name)).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(m.since)).append($('<span class="exodus-universe-treeview-column-free-spaces"/>')).append($('<span class="exodus-universe-treeview-column-features"/>').text(m.features));k.append(l);var o=$('<li id="wait-server-'+m.id+'"/>').append($('<img alt="'+exodus.data.translations.loading+'" src="'+exodus.data["load-image"]+'"/>'));k.append(o);if(q){exodus.markedServer=m;exodus.selectedServer=m;l.addClass("server-selected");l.addClass("row-selected")}$.jsonp({url:"https://"+m.host+"/service/exodus.php?action=getServerInfo&data="+m.data+"&callback=?",error:function(){exodus.handleError(m.id,exodus.data.translations["error-no-server"]);$("#server-"+m.id).show();$("#wait-server-"+m.id).remove();if(exodus.noServers&&n){exodus.showSecondaryServers(k)}},success:function(a){if(!a.currentPlayerCount){exodus.handleError(m.id,exodus.data.translations["error-no-server"]);$("#server-"+m.id).show();$("#wait-server-"+m.id).remove();return}$("#server-"+m.id+" .exodus-universe-treeview-column-free-spaces").text(a.freeSlots);if(a.alreadyMigrating){exodus.handleSuccess(m.id,exodus.data.translations["success-server-selected"]);if(!p){exodus.noServers=false}}else{if(a.alreadyRegistered){exodus.handleError(m.id,exodus.data.translations["error-account"])}else{if(a.usernameInUse){exodus.handleError(m.id,exodus.data.translations["error-name-in-use"])}else{if(a.freeSlots<=0){exodus.handleError(m.id,exodus.data.translations["error-no-free-slots"])}else{if(!p){exodus.noServers=false}}}}}if(exodus.noServers&&n){exodus.showSecondaryServers(k)}$("#server-"+m.id).show();$("#wait-server-"+m.id).remove()}})},handleError:function(d,c){$("#server-"+d).find("span.exodus-success").remove();$("#server-"+d).find("span.exodus-error").remove();$("#server-"+d).append('<span class="exodus-error"><strong>'+exodus.data.translations["error-impossible"]+"</strong><br/>"+c+"</span>");$("#server-"+d).addClass("disabled")},handleSuccess:function(d,c){$("#server-"+d).find("span.exodus-success").remove();$("#server-"+d).find("span.exodus-error").remove();$("#server-"+d).append('<span class="exodus-success"><strong>'+c+"</strong></span>")},showSecondaryServers:function(d){for(var c=0;c<exodus.data["secondary-servers"].length;c++){exodus.appendServerRow(d,exodus.data["secondary-servers"][c],false,true)}exodus.secondaryShown=true},showDialog:function(){if(exodus.isOpen!=null){if(exodus.isOpen==false){exodus.overlay.show();exodus.dialog.show();$("html, body").animate({scrollTop:0},100)}return}exodus.data={"load-image":exodus.indicator.attr("data-load-image"),"exodus-start":exodus.indicator.attr("data-exodus-start"),"exodus-end":exodus.indicator.attr("data-exodus-end"),"next-migration":exodus.indicator.attr("data-next-migration"),translations:$.parseJSON(exodus.indicator.attr("data-translations")),"migration-host":exodus.indicator.attr("data-migration-host"),"primary-servers":$.parseJSON(exodus.indicator.attr("data-primary-servers")),"secondary-servers":$.parseJSON(exodus.indicator.attr("data-secondary-servers")),"user-data":exodus.indicator.attr("data-user-data"),"user-validation":exodus.indicator.attr("data-user-validation"),"see-dialog":exodus.indicator.attr("data-user-see-dialog"),"ally-id":exodus.indicator.attr("data-user-ally-id"),"buddy-amount":exodus.indicator.attr("data-user-buddy-amount")};if(exodus.data["user-validation"]==0){errorBoxNotify(LocalizationStrings.error,exodus.data.translations["error-user-not-validated"],LocalizationStrings.ok);return}exodus.isOpen=true;exodus.selectedServer=null;exodus.markedServer=null;exodus.dialog=$('<div id="exodus-dialog"/>');exodus.overlay=$('<div id="exodus-overlay"/>');var k=$('<div id="exodus-header"/>');var g=$('<div id="exodus-close" class="ui-icon ui-icon-closethick"/>');var l=$('<div id="exodus-content"/>');var m=$('<div id="exodus-top-content"/>');var h=$('<ul id="exodus-tab-bar"/>');exodus.overlay.bind("click",exodus.closeDialog);g.bind("click",exodus.closeDialog);k.append($('<div id="exodus-header-content"/>').text(exodus.data.translations["exodus-dialog-title"]));m.text(exodus.data.translations["exodus-period"]+" "+exodus.data["exodus-start"]+" â€“ "+exodus.data["exodus-end"]);if(exodus.data["next-migration"]!=""){m.append($('<span id="exodus-next-migration"/>').text(exodus.data["next-migration"]));m.append($("<span/>").text(": "+exodus.data.translations["next-migration-processing"]))}allyView=$('<li id="ally-show"/>').text(exodus.data.translations["tab-ally-mebers"]);allyView.bind("click",function(){exodus.showAllyMemberTab()});buddyView=$('<li id="buddy-show"/>').text(exodus.data.translations["tab-buddies"]);buddyView.bind("click",function(){exodus.showBuddyTab()});serverView=$('<li id="uni-select"/>').text(exodus.data.translations["tab-uni-selection"]);serverView.bind("click",function(){exodus.showServerSelection()});rulesView=$('<li id="rules-show"/>').text(exodus.data.translations["tab-rules"]);rulesView.bind("click",function(){exodus.showRulesTab()});h.append(serverView);if(exodus.data["ally-id"]>0){h.append(allyView)}if(exodus.data["buddy-amount"]>0){h.append(buddyView)}h.append(rulesView);l.append(m).append(h);exodus.dialog.append(k).append(l).append(g);$("body").append(exodus.overlay).append(exodus.dialog);if(exodus.data["see-dialog"]=="0"){exodus.showRulesTab();exodus.data["see-dialog"]="1";exodus.indicator.attr("data-user-see-dialog",1);$.jsonp({url:"/service/exodus.php?action=seeDialog&data="+exodus.data["user-data"]+"&callback=?",error:function(a){errorBoxNotify(LocalizationStrings.error,"TEST: "+exodus.data["user-data"],LocalizationStrings.ok)},success:""})}else{exodus.showServerSelection()}$("html, body").animate({scrollTop:0},100)},closeDialog:function(){exodus.dialog.hide();exodus.overlay.hide();exodus.isOpen=false},createButton:function(b){return $('<div class="exodus-button"/>').append($('<div class="exodus-button-left"/>')).append($('<div class="exodus-button-label"/>').text(b)).append($('<div class="exodus-button-right"/>'))},showServerSelection:function(){this.resetView("#uni-select");if(exodus.tabContent!=null){exodus.tabContent.show()}else{exodus.tabContent=$('<div id="exodus-tab-content"/>');exodus.universeTreeviewHeader=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-checkbox"/>').text("\u2714").css("visibility","hidden")).append($('<span class="exodus-universe-treeview-column-name"/>').text(exodus.data.translations["uni-selection-name"])).append($('<span class="exodus-universe-treeview-column-startdate"/>').text(exodus.data.translations["uni-selection-start"])).append($('<span class="exodus-universe-treeview-column-free-spaces"/>').text(exodus.data.translations["uni-selection-free-spaces"])).append($('<span class="exodus-universe-treeview-column-features"/>').text(exodus.data.translations["uni-selection-specifics"]));var f=$('<ul id="exodus-universe-treeview"/>');exodus.confirmButton=exodus.createButton(exodus.data.translations["uni-selection-confirm"]);exodus.revertButton=exodus.createButton(exodus.data.translations["uni-selection-revert"]);exodus.confirmButton.bind("click",function(){if(!$(this).hasClass("confirm")||exodus.markedServer==null){return}var a=exodus.markedServer;$.jsonp({url:"https://"+a.host+"/service/exodus.php?action=requestMigration&data="+a.data+"&callback=?",error:function(){exodus.handleError(a.id,exodus.data.translations["error-no-server"])},success:function(b){if(b.errorMessage){exodus.handleError(a.id,exodus.data.translations["error-no-server"])}else{if(exodus.selectedServer!=null){f.find("li").removeClass("row-selected");f.find("li").removeClass("server-selected");$("#server-"+exodus.selectedServer.id).find("span.exodus-success").remove();$("#server-"+exodus.selectedServer.id).find("span.exodus-error").remove()}exodus.indicator.attr("data-migration-host",a.host);exodus.data["migration-host"]=a.host;$("#exodus-indicator-waiting").attr("id","exodus-indicator-acknowledged");exodus.handleSuccess(a.id,exodus.data.translations["success-server-selected"]);exodus.revertButton.addClass("cancel");$("#server-"+a.id).addClass("server-selected");exodus.selectedServer=a;var c=$("#server-"+a.id).find("span.exodus-universe-treeview-column-free-players");c.text(parseInt(c.text())-1);exodus.confirmButton.removeClass("confirm")}}})});exodus.revertButton.bind("click",function(){if(!$(this).hasClass("cancel")||exodus.selectedServer==null){return}var a=exodus.selectedServer;$.jsonp({url:"https://"+a.host+"/service/exodus.php?action=cancelMigration&data="+a.data+"&callback=?",error:function(){exodus.closeDialog()},success:function(b){if(b.errorMessage){exodus.closeDialog()}else{exodus.indicator.attr("data-migration-host","");$("#exodus-indicator-acknowledged").attr("id","exodus-indicator-waiting");f.find("li").removeClass("row-selected");f.find("li").removeClass("server-selected");$("#server-"+a.id).find("span.exodus-success").remove();$("#server-"+a.id).find("span.exodus-error").remove();exodus.confirmButton.removeClass("confirm");exodus.revertButton.removeClass("cancel");var c=$("#server-"+a.id).find("span.exodus-universe-treeview-column-free-players");c.text(parseInt(c.text())+1);exodus.markedServer=null;exodus.selectedServer=null}}})});if(exodus.data["migration-host"]!=""){exodus.revertButton.addClass("cancel")}exodus.tabContent.append(exodus.universeTreeviewHeader).append(f).append(exodus.confirmButton).append(exodus.revertButton);exodus.odd=0;for(var d=0;d<exodus.data["primary-servers"].length;d++){var g=(exodus.data["primary-servers"].length==d+1);exodus.appendServerRow(f,exodus.data["primary-servers"][d],g,false)}if(!exodus.secondaryShown){for(var d=0;d<exodus.data["secondary-servers"].length;d++){if(exodus.data["migration-host"]==exodus.data["secondary-servers"][d]["host"]){exodus.appendServerRow(f,exodus.data["secondary-servers"][d],false,true)}}exodus.secondaryShown=true}$("#exodus-content").append(exodus.tabContent)}},showAllyMemberTab:function(){this.resetView("#ally-show");if(exodus.allyMemberContent!=null){exodus.allyMemberContent.show()}else{exodus.allyMemberContent=$('<div id="exodus-ally-content"/>');$.jsonp({url:"/service/exodus.php?action=getAllyMemberSelection&data="+exodus.data["user-data"]+"&callback=?",error:function(){},success:function(h){if(h.errorMessage){exodus.closeDialog()}else{var k=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-member-name"/>').text(exodus.data.translations["ally-members-name"])).append($('<span class="exodus-universe-treeview-column-server-name"/>').text(exodus.data.translations["ally-members-server"]));var m=$('<div id="exodus-universe-treeview"/>');for(var g=0;g<h.length;g++){var l=$('<li id="server-'+g+'" class="'+(g%2?"odd":"even")+'"/>').append($('<span class="exodus-universe-treeview-column-member-name"/>').text(h[g].db_character));if(h[g].server_name!=null){l.append($('<span class="exodus-universe-treeview-column-server-name"/>').text(h[g].server_name))}else{l.append($('<span class="exodus-universe-treeview-column-server-name"/>').text(exodus.data.translations["ally-member-no-selction"]))}m.append(l)}exodus.allyMemberContent.append(k);exodus.allyMemberContent.append(m);$("#exodus-content").append(exodus.allyMemberContent)}}})}},showBuddyTab:function(){this.resetView("#buddy-show");if(exodus.buddyContent!=null){exodus.buddyContent.show()}else{exodus.buddyContent=$('<div id="exodus-buddy-content"/>');$.jsonp({url:"/service/exodus.php?action=getBuddySelection&data="+exodus.data["user-data"]+"&callback=?",error:function(){},success:function(d){if(d.errorMessage){exodus.closeDialog()}else{header=$('<div id="exodus-universe-treeview-header"/>').append($('<span class="exodus-universe-treeview-column-member-name"/>').text(exodus.data.translations["ally-members-name"])).append($('<span class="exodus-universe-treeview-column-server-name"/>').text(exodus.data.translations["ally-members-server"]));var c=$('<div id="exodus-universe-treeview"/>');for(i=0;i<d.length;i++){row=$('<li id="server-'+i+'" class="'+(i%2?"odd":"even")+'"/>').append($('<span class="exodus-universe-treeview-column-member-name"/>').text(d[i].db_character));if(d[i].server_name!=null){row.append($('<span class="exodus-universe-treeview-column-server-name"/>').text(d[i].server_name))}else{row.append($('<span class="exodus-universe-treeview-column-server-name"/>').text(exodus.data.translations["ally-member-no-selction"]))}c.append(row)}exodus.buddyContent.append(header);exodus.buddyContent.append(c);$("#exodus-content").append(exodus.buddyContent)}}})}},showRulesTab:function(){this.resetView("#rules-show");rules=new Array("uni-fusion","pre-exodus","exodus-phase","post-exodus","exodus-uni","target-uni");if(exodus.rulesContent!=null){exodus.rulesContent.show()}else{exodus.rulesContent=$('<div id="exodus-rules-content"/>');rule=$('<div class="exodus_rule"/>');for(var b=0;b<rules.length;b++){rule.append($('<h2 class="exodus-rule-title" />').text(exodus.data.translations["title-"+rules[b]]));rule.append($('<p class="exodus-rule-description" />').text(exodus.data.translations["description-"+rules[b]]));exodus.rulesContent.append(rule)}$("#exodus-content").append(exodus.rulesContent)}},resetView:function(b){if($(b).hasClass("selected")){return}if($("#uni-select").hasClass("selected")){exodus.tabContent.hide()}else{if($("#buddy-show").hasClass("selected")){exodus.buddyContent.hide()}else{if($("#ally-show").hasClass("selected")){exodus.allyMemberContent.hide()}else{if($("#rules-show").hasClass("selected")){exodus.rulesContent.hide()}}}}$("#uni-select").removeClass("selected");$("#ally-show").removeClass("selected");$("#buddy-show").removeClass("selected");$("#rules-show").removeClass("selected");$(b).addClass("selected")}};function initFleet1(){checkShips("shipsChosen");initToggleHeader("fleet1");$(".combatunits").unbind("change").bind("change",function(){setTemplate(shipTemplates[$(this).val()],maxShips);checkShips("shipsChosen")});focusOnTabChange("#continue",true)}function setTemplate(d,f){for(var g in d){if(!$("#ship_"+g).attr("disabled")){$("#ship_"+g).val(d[g])}if(typeof f[g]=="undefined"){f[g]=0}checkIntInput("#ship_"+g,0,f[g])}}function resetForm(){$(".fleetValues").val("")}function checkShips(E){if(document.forms[E]!=undefined){var u=0;var s=document.forms[E].length;for(var x=0;x<s;x++){var D=document.forms[E].elements[x].id;if(typeof D!="undefined"){expl=D.split("_");if(expl[0]=="ship"){value=document.forms[E].elements[x].value;if(!$("#"+D).attr("disabled")&&value!=""){u=u+value}}}}var q="";if(u==0||!sendingEnabled){validated=false;$("#continue").attr("class","off");q=loca.fleetNoSelection;if(!sendingEnabled){q=loca.fleetNoFreeSlots}}else{validated=true;$("#continue").attr("class","on")}var A=createAPIFleet(E);if(!$("#FLEETAPI").val()){var y=$(".show_fleet_apikey").attr("title");var B=y.indexOf("value='")+7;var v=y.indexOf("' readonly");var r=y.slice(0,B);var C=y.slice(v,y.length);var w=r+A+C;$(".show_fleet_apikey").attr("title",w)}else{$("#FLEETAPI").val(A)}$("#allornone .info").html(q)}}function createAPIFleet(k){var l="";if(document.forms[k]!=undefined){var h=document.forms[k].length;for(var m=0;m<h;m++){var g=document.forms[k].elements[m].id;expl=g.split("_");if(expl[0]=="ship"){value=document.forms[k].elements[m].value;if(value>0||value!=""){type=expl[1];l=l+type+";"+value+"|"}}}}l=l.substring(0,l.length-1);return techData+l}function initStandardFleet(){$(".list tr:even").addClass("alt");$(".standardFleetSubmit").unbind("click").bind("click",function(){$(this).parents("form").submit()});$(".standardFleetReset").unbind("click").bind("click",function(){$(this).parents("form")[0].reset()});$(".changeFleet").unbind("click").bind("click",function(){$(".combatunits").val($(this).attr("rel")).trigger("change");$(this).parents(".ui-dialog").find(".ui-dialog-titlebar-close").click()})}function setShipsFleet(f,k,g){$("#template_id").val(g);$("#template_name").val(k);for(var h in f){$("#ship"+h).val(f[h])}}function toggleMaxShips(k,h,g){var f=$(k).find("#ship_"+h);if(parseInt(f.val())!==g){f.val(g)}else{f.val("")}$("#continue").focus()}function initFleet2(){updateVariables();timerHandler.appendCallback(updateTimesFleet2);if(!isMobile){$("#galaxy").focus()}initToggleHeader("fleet2");initBackButton();focusOnTabChange("#continue",true);detachEventHandlers();attachEventHandlers();if($(".combatunits>option:selected").length){$(".combatunits>option:selected").change()}}function attachEventHandlers(){var b=$("#speed");$(document).on("mouseover focus","#speedLinks>a",function(a){b.val($(this).attr("data-value"));updateVariables()}).on("mouseleave blur","#speedLinks>a",function(a){resetSpeedToSelected()}).on("mouseup touchstart","#speedLinks>a",function(a){$("#speedLinks>a.selected").removeClass("selected");$(this).addClass("selected").focus();b.val($(this).attr("data-value"));updateVariables()}).on("keyup","#speedLinks>a",function(a){if(a.keyCode==KeyEvent.DOM_VK_LEFT){$(this).prev().focus()}else{if(a.keyCode==KeyEvent.DOM_VK_RIGHT){$(this).next().focus()}else{if(a.keyCode==KeyEvent.DOM_VK_RETURN){a.stopPropagation();a.preventDefault();if($(this).hasClass("selected")){trySubmit()}else{$(this).trigger("mouseup")}}}}}).on("keypress","#speedLinks>a",function(a){if(a.keyCode==KeyEvent.DOM_VK_RETURN){a.stopPropagation();a.preventDefault();if($(this).hasClass("selected")){trySubmit()}else{$(this).click()}}}).on("keypress","#contentWrapper #inhalt",submitOnEnter)}function detachEventHandlers(){$(document).off("mouseover focus mouseleave blur mouseup touchstart keyup keypress","#speedLinks>a").off("keypress","#contentWrapper #inhalt")}function resetSpeedToSelected(){if(currentPage=="fleet2"){$("#speed").val($("#speedLinks>a.selected").attr("data-value"));updateVariables()}}function initBackButton(){$("#back").unbind("click").bind("click",function(){resetSpeedToSelected();$(this).parents("form").attr("action",returnLink).submit()})}function prepareVariables(){checkCoords();speed=$("#speed").val()}function setTType(b){b=b==null?$("#type").val():b;if(b==1){$("#pbutton").attr("class","planet_selected")}else{$("#pbutton").attr("class","planet")}if(b==2){$("#dbutton").attr("class","debris_selected")}else{$("#dbutton").attr("class","debris")}if(b==3){$("#mbutton").attr("class","moon_selected")}else{$("#mbutton").attr("class","moon")}if(b==1){$("#targetPlanetName").html(locaAllPlanet)}else{if(b==2){$("#targetPlanetName").html(locaAllDebris)}else{if(b==3){$("#targetPlanetName").html(locaAllMoon)}}}$("#type").val(b)}function shortLinkChange(d){var f;if(d!=null){f=$("#aksbox").val()}else{f=$("#slbox").val()}if(f!="-"){var g=f.split("#");$("#galaxy").val(g[0]);$("#system").val(g[1]);$("#position").val(g[2]);setTType(g[3]);$("#targetPlanetName").html(g[4]);targetGalaxy=g[0];targetSystem=g[1];targetPosition=g[2]}focusContinueButton()}function focusContinueButton(){setTimeout(function(){$("#continue").focus()},100)}function handleUnion(){if($("#aksbox").val()=="-"){document.details.union.value=0;document.details.mission.value=mission}else{parts=$("#aksbox").val().split("#");document.details.union.value=parts[5];document.details.mission.value=missionUnionattack}}function hideStatusBar(){if($(".fleetStatus")&&(targetGalaxy!=defaultTargetGalaxy||targetSystem!=defaultTargetSystem||targetPosition!=defaultTargetPosition)){$(".fleetStatus").hide();$("input[name='mission']").value=""}}function checkCoords(){checkIntInput("#galaxy",1,maxGalaxy);checkIntInput("#system",1,maxSystem);checkIntInput("#position",1,maxPosition);targetGalaxy=$("#galaxy").val();targetSystem=$("#system").val();targetPosition=$("#position").val();if(targetPosition==16){setTType(1);modifyPlanetName();checkOk()}}function checkTarget(){var d=checkUrl;var c={};c.galaxy=$("#galaxy").val();c.system=$("#system").val();c.planet=$("#position").val();c.type=$("#type").val();if($("form[name='details'] input[name='am"+colonizationID+"']").length>0&&$("form[name='details'] input[name='am"+colonizationID+"']").val()>0){c.cs=1}if($("form[name='details'] input[name='am"+recyclerID+"']").length>0&&$("form[name='details'] input[name='am"+recyclerID+"']").val()>0){c.recycler=1}$.post(d,c,displayError)}function updateTimesFleet2(){var d=getFormatedDate(serverTime.getTime()+1000*duration,"[d].[m].[y] [G]:[i]:[s]");var c=getFormatedDate(serverTime.getTime()+1000*2*duration,"[d].[m].[y] [G]:[i]:[s]");if(document.getElementById){$("#arrivalTime").html(d);$("#returnTime").html(c)}}function initFleet3(){timerHandler.appendCallback(updateTimesFleet3);if(!isMobile){$("#metal").focus()}initToggleHeader("fleet3");initBackButton();updatePrioButtons();if($("#missions .on .selected").length){$("#missions .on .selected")[0].onclick()}$("#contentWrapper #inhalt").unbind("keydown.continue").bind("keydown.continue",function(b){if(b.keyCode==KeyEvent.DOM_VK_RETURN){trySubmit()}})}function updatePrioButtons(){$("#prioM1").attr("src","//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif");$("#prioM2").attr("src","//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif");$("#prioM3").attr("src","//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif");switch(prioMetal){case 1:$("#prioM1").attr("src","//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif");break;case 2:$("#prioM2").attr("src","//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif");break;case 3:$("#prioM3").attr("src","//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif");break}$("#prioC1").attr("src","//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif");$("#prioC2").attr("src","//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif");$("#prioC3").attr("src","//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif");switch(prioCrystal){case 1:$("#prioC1").attr("src","//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif");break;case 2:$("#prioC2").attr("src","//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif");break;case 3:$("#prioC3").attr("src","//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif");break}$("#prioD1").attr("src","//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif");$("#prioD2").attr("src","//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif");$("#prioD3").attr("src","//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif");switch(prioDeuterium){case 1:$("#prioD1").attr("src","//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif");break;case 2:$("#prioD2").attr("src","//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif");break;case 3:$("#prioD3").attr("src","//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif");break}}function selectPrio(d,c){switch(d){case"metal":if(prioMetal==c){break}if(prioCrystal==c){prioCrystal=prioMetal}if(prioDeuterium==c){prioDeuterium=prioMetal}prioMetal=c;break;case"crystal":if(prioCrystal==c){break}if(prioMetal==c){prioMetal=prioCrystal}if(prioDeuterium==c){prioDeuterium=prioCrystal}prioCrystal=c;break;case"deuterium":if(prioDeuterium==c){break}if(prioMetal==c){prioMetal=prioDeuterium}if(prioCrystal==c){prioCrystal=prioDeuterium}prioDeuterium=c;break}$('form input[name="prioMetal"]').val(prioMetal);$('form input[name="prioCrystal"]').val(prioCrystal);$('form input[name="prioDeuterium"]').val(prioDeuterium);updatePrioButtons()}function updateHoldingOrExpTime(){if($('form input[name="mission"]').val()==missionHold){$('form input[name="holdingOrExpTime"]').val($('form input[name="holdingtime"]').val());holdingTime=$('form [name="holdingtime"]').val()}else{if($('form input[name="mission"]').val()==missionExpedition){$('form input[name="holdingOrExpTime"]').val($('form input[name="expeditiontime"]').val());holdingTime=$('form [name="expeditiontime"]').val()}else{$('form input[name="holdingOrExpTime"]').val(0);holdingTime=0}}}function checkRessourceByType(k){var h=getValue($("#"+k).val());var g=0;var l=0;if(k=="metal"){g=metalOnPlanet;l=cargoSpace-crystal-deuterium}else{if(k=="crystal"){g=crystalOnPlanet;l=cargoSpace-metal-deuterium}else{if(k=="deuterium"){g=deuteriumOnPlanet;l=cargoSpace-metal-crystal}else{g=metalOnPlanet;l=cargoSpace-crystal-deuterium}}}if(h!=""){var m=parseInt(h);m=isNaN(m)?0:m;m=Math.abs(m);m=Math.min(m,g);if(m>l){m=l}updateRessVarByType(k,m);formatNumber($("#"+k),m)}else{updateRessVarByType(k,0)}}function updateRessVarByType(d,c){if(d=="metal"){metal=c}else{if(d=="crystal"){crystal=c}else{if(d=="deuterium"){deuterium=c}else{metal=c}}}}function resetByRessourceType(b){if(b=="metal"){metal=0}if(b=="crystal"){crystal=0}if(b=="deuterium"){deuterium=0}$("#"+b).val(0);updateVariables()}function maxMetal(){var b;b=cargoSpace-crystal-deuterium;b=Math.max(b,0);b=Math.min(b,metalOnPlanet);metal=Math.max(metal,b);formatNumber($("#metal"),metal)}function maxCrystal(){var b;b=cargoSpace-metal-deuterium;b=Math.max(b,0);b=Math.min(b,crystalOnPlanet);crystal=Math.max(crystal,b);formatNumber($("#crystal"),crystal)}function maxDeuterium(){var b;b=cargoSpace-metal-crystal;b=Math.max(b,0);b=Math.min(b,deuteriumOnPlanet-consumption);b=Math.max(b,0);deuterium=Math.max(deuterium,b);formatNumber($("#deuterium"),deuterium)}function maxAll(){metal=0;crystal=0;deuterium=0;maxDeuterium();maxCrystal();maxMetal()}function updateTimesFleet3(){durationAKS=durationAKS-1;checkTimes()}function checkTimes(){var g=duration;if($("#missionButton2").hasClass("selected")){g=Math.max(durationAKS,duration)}var f=serverTime.getTime()+1000*g;var d=f+1000*duration+holdingTime*3600*1000;if(durationAKS>=duration){$("#durationAKS").html(getFormatedTime(durationAKS))}$("#arrivalTime").text(getFormatedDate(f,"[d].[m].[y] [G]:[i]:[s]"));$("#returnTime").text(getFormatedDate(d,"[d].[m].[y] [G]:[i]:[s]"))}function setSelected(b){$("#missions>li>a.selected").removeClass("selected");$("#missionButton"+b).addClass("selected");isAggressiveMission=((b==1)||(b==2)||(b==6)||(b==9));$("#fightAfterRetreat,#aks,#holdtimeline,#expeditiontimeline,.prioButton").hide();switch(b){case 1:$("#fightAfterRetreat").show();$(".prioButton").show();break;case 2:$("#aks").show();$(".prioButton").show();break;case 5:$("#holdtimeline").show();break;case 8:$("#expeditiontimeline").hide();break;case 15:$("#expeditiontimeline").show();break}checkTimes()}function updateMission(h,f,g,k){$(".missionName").text(h);$(".mission_description").text(f);$("#missionNameWrapper").removeClass("off");$(".briefing_overlay").hide();if(g=="off"){$("#missionNameWrapper").addClass("off");$(".briefing_overlay").show()}$('form input[name="mission"]').val(k);updateHoldingOrExpTime();updateVariables()}var validated=false;var sendingEnabled=true;var shipIDs=[];var speeds=[];var completeConsumptions=[];var storageCapacity=null;var probeStorageCapacity=null;var tankSpace=null;var probeCompleteConsumption=null;var maxSpeed=0;var speedFactor=1;var maxGalaxy=null;var maxSystem=null;var maxPosition=null;var DONUT_GALAXY=null;var DONUT_SYSTEM=null;var currentGalaxy=1;var currentSystem=1;var currentPosition=1;var currentPlanetType=1;var targetGalaxy=1;var targetSystem=1;var targetPosition=1;var defaultTargetGalaxy=1;var defaultTargetSystem=1;var defaultTargetPosition=1;var speed=0;var holdingTime=0;var metal=0;var crystal=0;var deuterium=0;var currentDeuterium=0;var returnLink="";var checkUrl="";var colonizationID=0;var missionNone=null;var missionUnionattack=null;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;var cargoLeft=0;var locaAllPlanet="";var locaAllMoon="";var locaAllDebris="";var storageCapacity=0;var probeStorageCapacity=0;var probeCompleteConsumption=0;var metal=0;var crystal=0;var deuterium=0;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;var tankSpace=0;var metalOnPlanet=0;var crystalOnPlanet=0;var deuteriumOnPlanet=0;var returnLink="";var missionHold=null;var missionExpedition=null;var durationAKS=0;var prioMetal;var prioCrystal;var prioDeuterium;var isAggressiveMission=false;function getDistance(){var f;var g;var k;var h;f=Math.abs(currentGalaxy-targetGalaxy);g=Math.abs(currentSystem-targetSystem);k=Math.abs(currentPosition-targetPosition);if(f!=0){h=Math.abs(f-maxGalaxy);if(DONUT_GALAXY==1&&(h<f)){return h*20000}else{return f*20000}}else{if(g!=0){h=Math.abs(g-maxSystem);if(DONUT_SYSTEM==1&&(h<g)){return h*5*19+2700}else{return g*5*19+2700}}else{if(k!=0){return k*5+1000}else{return 5}}}}function getDuration(){return Math.round(((35000/speed*Math.sqrt(distance*10/maxSpeed)+10)/speedFactor))}function getConsumption(k){var l=0;var g=0;var h=0;var m=Math.max(1,duration*speedFactor-10);for(i=0,maxI=shipIDs.length;i<maxI;i++){if(k==0||k==null||shipIDs[i]==k){h++;shipSpeedValue=35000/m*Math.sqrt(distance*10/speeds[i]);g+=completeConsumptions[i]*holdingTime;l+=completeConsumptions[i]*distance/35000*((shipSpeedValue/10)+1)*((shipSpeedValue/10)+1)}}if(h>0){l=Math.round(l)+1;if(holdingTime>0){l+=Math.max(Math.floor(g/10),1)}l=Math.ceil(Math.round(l*fleetDeutSaveFactor));return l}else{return 0}}function getFreeStorage(){return storageCapacity}function updateVariables(){if(currentPage=="fleet2"){prepareVariables()}distance=getDistance();duration=getDuration();consumption=getConsumption();cargoSpace=getFreeStorage();cargoLeft=cargoSpace-metal-crystal-deuterium;refreshFormData()}function refreshFormData(){$("#duration").html(formatTime(duration)+" h");$("#distanceValue").html(tsdpkt(distance));styleClass=cargoSpace<0?"overmark":"undermark";$("#storage").html('<span class="'+styleClass+'">'+tsdpkt(cargoSpace)+"</span>");styleClass=((consumption>tankSpace)||(consumption>$("#resources_deuterium").text().replace(/\./g,"")))?"overmark":"undermark";$("#consumption").html('<span class="'+styleClass+'">'+tsdpkt(consumption)+" ("+Math.ceil(100*consumption/tankSpace)+"%)</span>");styleClass=cargoLeft<0?"overmark":"undermark";$("#remainingresources").html('<span class="'+styleClass+'">'+tsdpkt(cargoLeft)+"</style>");$(".bar_container").data("currentAmount",cargoSpace-cargoLeft);$(".bar_container").data("capacity",cargoSpace);refreshBars("bar_container","filllevel_bar");setTType();if(currentPage=="fleet2"){modifyPlanetName()}checkOk()}function modifyPlanetName(){newName=getOwnName();if(newName!=""){$("#targetPlanetName").html(newName);$("#statusTarget").html(newName)}hideStatusBar()}function checkOk(){switch(currentPage){case"fleet2":if((currentGalaxy==$("#galaxy").val()&&currentSystem==$("#system").val()&&currentPosition==$("#position").val()&&currentPlanetType==$("#type").val())||$("#galaxy").val()==""||$("#system").val()==""||$("#position").val()==""||consumption>currentDeuterium||consumption>tankSpace||cargoSpace<0){validated=false;$("#continue").attr("class","off")}else{validated=true;$("#continue").attr("class","on")}break;case"fleet3":if(isMissionValid()&&cargoLeft>=0){validated=true;$("#start").attr("class","on")}else{validated=false;$("#start").attr("class","off")}break}}function submitOnKey(b){if(b==37){system=system>1?parseInt(system)-1:maxSystems;loadContent(galaxy,system,true)}else{if(b==39){system=system<maxSystems?parseInt(system)+1:1;loadContent(galaxy,system,true)}else{if(b==40){galaxy=galaxy>1?parseInt(galaxy)-1:maxGalaxies;loadContent(galaxy,system,true)}else{if(b==38){galaxy=galaxy<maxGalaxies?parseInt(galaxy)+1:1;loadContent(galaxy,system,true)}}}}}function keyevent(d){var c;if($(":focus").closest(".ui-dialog").length){return true}if($(":focus").closest(".chat_box_textarea").length){return true}if(window.event){c=window.event.keyCode}else{if(d){c=d.which}else{return true}}submitOnKey(c)}function launchMissiles(b){var b=$.parseJSON(b);if(b.status){$("#missileValue").html(b.rockets)}errorBoxAsArray(b.errorbox);$("#rocketattack").parent().dialog("close")}function errorBoxSubmitYes(){location.href=officersLink}function movePlanet(d,f){function g(){$.post(d,function(a){if((a=="")||(a==null)){fadeBox(galaxyLoca.reservationSuccess,false);setTimeout('reload_page("'+f+'")',3000)}else{fadeBox(a,true)}})}errorBoxDecision(galaxyLoca.questionTitle,galaxyLoca.question,LocalizationStrings.yes,LocalizationStrings.no,g)}function addToTable(o,r,n){var m=o;if(n!=null){m+=" ("+tsdpkt(n)+") "+LocalizationStrings.ok}if(isMobile){fadeBox(m,r!="success");return}var s=new Date();var u="fleetstatus"+s.getTime();var p='id="'+u+'"';var q='class="'+r+'"';var v="<div "+p+" "+q+">"+m+"</div>";if($("#fleetstatusrow").has("div").length){$("#fleetstatusrow").empty()}$(v).prependTo("#fleetstatusrow").fadeOut(3000,function(){$(this).remove()})}function setShips(d,f){var g=document.getElementById(d);g.innerHTML=f}function displayContentGalaxy(c){dataObject=JSON.parse(c);var d=getTooltipSelector("#inhalt");removeTooltip(d);$("#galaxyContent").html(dataObject.galaxy);tabletInitGalaxyDetails();eventBDayInitGalaxy();$("#galaxyLoading").hide();if(preserveSystemOnPlanetChange){$(".planetlink, .moonlink").querystring({galaxy:galaxy,system:system})}updateAjaxResourcebox(dataObject.resources)}function submitForm(){galaxy=$("#galaxy_input").val();system=$("#system_input").val();if(0===galaxy.length||!$.isNumeric(+galaxy)){galaxy=1}if(0===system.length||!$.isNumeric(+system)){system=1}loadContent(galaxy,system,true)}function loadContent(g,d,f){$("#galaxyLoading").show();if(0===g.length||!$.isNumeric(+g)){g=1}if(0===d.length||!$.isNumeric(+d)){d=1}$("#galaxy_input").val(g);$("#system_input").val(d);removeTooltip($("#galaxytable tbody *"));if(f){$.each(buildListCountdowns,function(){timerHandler.removeCallback(this.timer)})}$.post(contentLink,{galaxy:g,system:d},displayContentGalaxy)}function errorBoxDeuterium(){fadeBox(galaxyLoca.deuteriumNeeded,true)}function doScan(d,c){sendShips(constants.espionage,galaxy,system,d,c,spionageAmount)}function initPhalanx(){getAjaxResourcebox();$(".eventFleet:odd").addClass("odd");$(".partnerInfo:even").addClass("part-even");$(".toggleInfos").click(function(){id=$(this).attr("rel");if($(this).attr("class")=="toggleInfos infosOpen"){$(this).removeClass("infosOpen");$(this).addClass("infosClosed");$(this).children().attr("src","//gf2.geo.gfsrv.net/cdn10/de1e5f629d9e47d283488eee0c0ede.gif");$("."+id).attr("style","display: none;")}else{$(this).addClass("infosOpen");$(this).removeClass("infosClosed");$(this).children().attr("src","//gf3.geo.gfsrv.net/cdnb6/577565fadab7780b0997a76d0dca9b.gif");$("."+id).attr("style","display: block;")}});var b=$(".overlayDiv.phalanx").siblings(".ui-dialog-titlebar");if(b.find(".refreshPhalanxLink").length){$("#phalanxWrap .refreshPhalanxLink").remove()}else{b.find(".ui-dialog-title").append($("#phalanxWrap .refreshPhalanxLink"))}}function initMissleAttackLayer(){$("#rocketattack").parent().dialog("option","title",$("#rocketattack").attr("data-title"));$("#rocketattack input#anz").keyup(function(){checkIntInput($(this),1,$(this).data("max"))}).change(function(){checkIntInput($(this),1,$(this).data("max"))}).focus();$("#rocketattack #number").bind("click",function(){var a=$("#rocketattack input#anz");if(parseInt(a.val())!=a.data("max")){a.val(a.data("max"))}else{a.val("1")}});$("#rocketattack #priority a").bind("click",function(){var d=$(this);var a=$("#primaryTarget");$("#rocketattack #priority a").not(d).removeClass("active");if(d.hasClass("active")){d.removeClass("active");a.val("");$("#noPriorityInfo").show()}else{d.addClass("active");a.val(d.attr("ref"));$("#noPriorityInfo").hide()}});$("form#rocketForm").submit(function(){ajaxFormSubmit("rocketForm",$(this).attr("action"),launchMissiles);return false});function b(){var a=$("#rocketattack #arrivalTime #timer");a.html(getFormatedDate(serverTime.getTime()+1000*a.data("duration"),"[d].[m].[y] [G]:[i]:[s]"))}timerHandler.appendCallback(b);b()}function displayMiniFleetMessage(d){var g=d.message;if(typeof(d.coordinates)!="undefined"){g+=" ["+d.coordinates.galaxy+":"+d.coordinates.system+":"+d.coordinates.position+"]"}if(d.success){var f="#ownFleetStatus_"+d.coordinates.position+"_"+d.planetType;switch(d.type){case 1:$(f).removeClass("fleetNeutral");$(f).attr("title",galaxyLoca.fleetAttacking).addClass("fleetHostile").addClass("tooltip");break;case 2:$(f).attr("title",galaxyLoca.fleetUnderway).addClass("fleetNeutral").addClass("tooltip");break}addToTable(g,"success",d.shipsSent);$("#slotUsed").html(tsdpkt(d.slots));setShips("probeValue",tsdpkt(d.probes));setShips("recyclerValue",tsdpkt(d.recyclers));setShips("missileValue",tsdpkt(d.missiles))}else{addToTable(g,"error")}shipsendingDone=1}function filterToggle(d){var f=d.target;var g;switch(f.id){case"filter_empty":g=".empty_filter";break;case"filter_inactive":g=".inactive_filter";break;case"filter_vacation":g=".vacation_filter";break;case"filter_strong":g=".strong_filter";break;case"filter_newbie":g=".newbie_filter";break}f=$(f);if(f.hasClass("filter_active")){f.removeClass("filter_active");$(g).each(function(b,a){$(this).removeClass("filtered_"+$(d.target)[0].id)});sendFilterToggle($(d.target)[0].id,0);d.stopPropagation()}else{f.addClass("filter_active");$(g).each(function(b,a){$(this).addClass("filtered_"+$(d.target)[0].id)});sendFilterToggle($(d.target)[0].id,1);d.stopPropagation()}}function sendFilterToggle(c,d){$.ajax({type:"POST",url:"?page=togglefilter",dataType:"json",data:{id:c,state:d},success:function(a){},error:function(){}})}var DOM_GET_ELEMENT_BY_ID_CACHE=[];function getElementByIdWithCache(b){if(!DOM_GET_ELEMENT_BY_ID_CACHE[b]){DOM_GET_ELEMENT_BY_ID_CACHE[b]=document.getElementById(b)}return DOM_GET_ELEMENT_BY_ID_CACHE[b]}function number_format(w,y,p,x){p=p||LocalizationStrings.decimalPoint;x=x||LocalizationStrings.thousandSeperator;var r="";var q=w.toString();var s=q.indexOf("e");if(s>-1){r=q.substring(s);w=parseFloat(q.substring(0,s))}if(y!=null){var o=Math.pow(10,y);w=Math.round(w*o)/o}var A=w<0?"-":"";var u=(w>0?Math.floor(w):Math.abs(Math.ceil(w))).toString();var v=w.toString().substring(u.length+A.length);p=p!=null?p:".";v=y!=null&&y>0||v.length>1?(p+v.substring(1)):"";if(y!=null&&y>0){for(i=v.length-1,z=y;i<z;++i){v+="0"}}x=(x!=p||v.length==0)?x:null;if(x!=null&&x!=""){for(i=u.length-3;i>0;i-=3){u=u.substring(0,i)+x+u.substring(i)}}return A+u+v+r}function gfNumberGetHumanReadable(h,f,g){h=Math.floor(h);f=f||false;var k="";var g=g||3;if(f){if(h>=1000000000){k=LocalizationStrings.unitMilliard;h=h/1000000000}else{if(h>=1000000){k=LocalizationStrings.unitMega;h=h/1000000}}}floorWithPrecision=function(a,b){return Math.floor(a*Math.pow(10,b))/Math.pow(10,b)};h=floorWithPrecision(h,g);while(g>=0){if(floorWithPrecision(h,g-1)!=h){break}g=g-1}return number_format(h,g,LocalizationStrings.decimalPoint,LocalizationStrings.thousandSeperator)+k}function getNumberFormatShort(g,f){if(typeof(f)=="undefined"){f=0}g=Math.floor(g);var d="";if(g>=1000000000){d=LocalizationStrings.unitMilliard;g=g/1000000000}if(g>=1000000){d=LocalizationStrings.unitMega;g=g/1000000}if(g>=1000){d=LocalizationStrings.unitKilo;g=g/1000}return number_format(g,f,LocalizationStrings.decimalPoint,LocalizationStrings.thousandSeperator)+d}function createExpireTime(c){var d=new Date();c=c*1000;d.setTime(c);return d}function initHighscore(){$("a.navButton, a.subnavButton").click(function(){var k=$(this).attr("rel");var a=$(this).parent();var m="";if(a.attr("id")=="typeButtons"){$("#typeButtons > a.active").removeClass("active")}else{if(a.attr("id")=="categoryButtons"){$("#categoryButtons > a.active").removeClass("active");$("#typeButtons a.active").each(function(){k=$(this).attr("rel")})}}if(searchRelId!=null&&a.attr("id")=="typeButtons"||a.attr("id")=="subnav_fleet"){m="&searchRelId="+searchRelId}$(".subnavButton[rel!="+k+"]").removeClass("active");$("#stat_list_content").html(LocalizationStrings.loading);$(this).addClass("active");var b=$("#categoryButtons > a.active").attr("rel");var l=highscoreContentUrl+"&category="+b+"&type="+k+m;if((a.attr("id")=="typeButtons"||$(this).hasClass("subnavButton"))&&searchSite!=site){l=l+"&site="+site}removeTooltip(getTooltipSelector("#highscoreContent #ranks"));ajaxSumbit(l,"send","stat_list_content");if($(".navButton.active").attr("rel")==1){$("#highscoreContent .header h2").text(highscoreLoca.playerHighscore)}else{$("#highscoreContent .header h2").text(highscoreLoca.allianceHighscore)}});$(".stat_filter").click(function(){var a=$(this).attr("id");$(".subnav").hide();$("#subnav_"+a).fadeIn("slow")});var d=$("#ranks").offset().top;var c=$("#scrollToTop");$(window).unbind("scroll.highscoreTop").bind("scroll.highscoreTop",function(a){var b=$(this).scrollTop();if(b>d){c.css("visibility","visible")}else{c.css("visibility","hidden")}});$(document).undelegate(".scrollToTop","click").delegate(".scrollToTop","click",function(){$("html, body").animate({scrollTop:0},50)})}function initHighscoreContent(){if(userWantsFocus){if($("#position"+searchPosition).length>0){$("html, body").animate({scrollTop:Math.max(0,$("#position"+searchPosition).offset().top-200)},1000)}}$(".changeSite").change(function(){var a=$(this).val();$("#stat_list_content").html('<div class="ajaxLoad">'+LocalizationStrings.loading+"</div>");ajaxCall(highscoreContentUrl+"&category="+currentCategory+"&type="+currentType+"&site="+a,"stat_list_content")});var d=$("#scrollToTop");var f=$("#ranks thead .score");function g(){if(f.length){d.css("left",f.offset().left)}}g();$(window).unbind("resize.highscoreTop").bind("resize.highscoreTop",g)}function saveImperiumOrder(f,d){var g="impSortOrder";if(d){g="impSortOrderMoon"}$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:g,planets:$(f).sortable("toArray")}})}function clearImperiumOrder(){$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:"reset"},success:function(b){if(!b.error){location.reload()}}})}function createSummaryHtml(o){var r="";var m=null;var p=0;var s=0;var l="";r=r+'<div class="planetHead"><div class="planetname">'+o.translations.summary+'</div><div class="planetImg"><img src="//gf3.geo.gfsrv.net/cdn8a/7efb2e73ca11d2344bbed43668da10.jpg"/></div><div class="planetData"><ul><li class="coords textLeft"></li><li class="fields textRight"></li></ul></div><div class="clearfloat"/></div>';for(group in o.groups){r=r+'<div class="row" /><div class="values '+group+" group"+group+'">';for(s=0;l=o.groups[group][s];s++){if(o.translations.planets[l]==null){continue}var n={hourly:0,daily:0,weekly:0};if(l=="name"){p=o.translations.summary}else{p=0;if(group=="research"){if(!isNaN(o.planets[0][l])){p=o.planets[0][l]}}else{$.each(o.planets,function(){m=this;if(!isNaN(m[l])){p=p+parseInt(m[l]);if(group=="supply"&&!isNaN(m.production.hourly[l-1])){n.hourly+=m.production.hourly[l-1];n.daily+=m.production.daily[l-1];n.weekly+=m.production.weekly[l-1]}}})}}if(group=="supply"||group=="station"){p="&#x00F8; "+tsdpkt(round(p/o.planets.length,1))}else{if(group=="items"){p="&nbsp;"}else{p=tsdpkt(p)}}if(group=="supply"&&l!="name"&&n.hourly>0){var q="<table><tr><td>"+o.translations.production.hourly+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(n.hourly)+"</td></tr><tr><td>"+o.translations.production.daily+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(n.daily)+"</td></tr><tr><td>"+o.translations.production.weekly+":</td><td style=&quot;text-align: right;&quot;>"+tsdpkt(n.weekly)+"</td></tr></table>";q=q.replace(/</,"&lt;").replace(/>/,"&gt;");r=r+'<div class="tooltipRight '+l+'" title="'+q+'">'+p+"</div>"}else{r=r+'<div class="'+l+'">'+p+"</div>"}}r=r+"</div>"}r='<div id="planet0" class="planet summary">'+r+"</div>";return r}function createHeaderHtml(h){var k="";var f=0;var g="";k=k+'<div id="wrapTL"><div id="tab-left"><a id="planetsTab" href="javascript:void(0);" class="active" title=""><span>'+h.translations.planetsTab+'</span></a><a id="moonsTab" href="javascript:void(0);" title="" class=""><span>'+h.translations.moonsTab+"</span></a></div></div>";for(group in h.groups){k=k+'<div id="'+group+'" class="firstCat headers '+group+" headers"+group+'" group="'+group+'"><h3 class="open"><span>'+h.translations.groups[group]+'</span></h3><ul class="secondCat '+group+" group"+group+'">';for(f=0;g=h.groups[group][f];f++){if(h.translations.planets[g]==null){continue}k+='<li class="'+g+'">';if(h.translations.planets[g+"_full"]!=h.translations.planets[g]){k+='<span class="tooltipLeft" title="'+h.translations.planets[g+"_full"]+'">'+h.translations.planets[g]+"</span>"}else{k+="<span>"+h.translations.planets[g]+"</span>"}k+="</li>"}k=k+"</ul></div>"}k='<div id="empireTab"><div class="wrapTab"><div class="tab-part01"></div><h2>'+h.translations.header+'</h2><span class="reset"><img src="//gf2.geo.gfsrv.net/cdnab/f805c477d15ae3131b7c39c7d70e48.gif" width="16" height="16"><a href="javascript:void(0);" onClick="clearImperiumOrder(); return false;">'+h.translations.reset+'</a></span><div class="wrapCorner"></div><br class="clearfloat"/></div></div><div class="header">'+k+"</div>";return k}function createPlanetsHtml(n){var s="";var r="";var o="";var m="";var l="";var p=0;var q="";$.each(n.planets,function(){s=this;o="";m="";r=(s.name.length>13)?s.name.substr(0,11)+"...":s.name;o+='<div class="planetHead">';if(s.name!=r){o+='<div class="planetname tooltip" title="'+s.name+'">'+r+"</div>"}else{o+='<div class="planetname">'+r+"</div>"}if(isMobile){o+='<div class="planetImg"><img class="'+s.border+'" src="'+s.image+'"/></div><div class="planetData"><div class="planetDataTop odd"><ul><li class="coords textLeft"><a class="dark_highlight_tablet" href="'+s.coordinatesLink+'" >'+s.coordinates+'</a></li><li class="coords"><span class="dark_highlight_tablet energy tooltipRight" title="'+(s.type==3?s.diameterTooltip:s.energyTooltip)+'">'+(s.type==3?"\u2300: "+s.diameter:s.energyDescr+s.energy)+'</span></li></ul></div><div class="planetDataTop"><ul class="planet_data_2"><li class="fields textLeft">'+s.fieldUsed+"/"+s.fieldMax+'</li><li class="fields textLeft">'+s.temperature+'</li></ul></div></div><div class="clearfloat"/></div>'}else{o+='<div class="planetImg"><img class="'+s.border+'" src="'+s.image+'"/></div><div class="planetData"><div class="planetDataTop odd"><ul><li class="coords textLeft"><a href="'+s.coordinatesLink+'" >'+s.coordinates+'</a></li><li class="fields textRight">'+s.fieldUsed+"/"+s.fieldMax+'</li></ul></div><div class="planetDataTop"><ul><li class="coords textLeft">'+(s.type==3?s.diameterDescr:s.energyDescr)+'</li><li class="coords textRight">'+(s.type==3?s.diameter:s.energy)+'</li></ul></div><div class="planetDataBottom odd"><ul><li class="fields textCenter">'+s.temperature+'</li></ul></div></div><div class="clearfloat"/></div>'}for(var a in n.groups){o=o+'<div class="row" /><div class="values '+a+" group"+a+'">';for(p=0;q=n.groups[a][p];p++){q=String(q);if(s[q+"_html"]!=null){q=q+"_html"}m=q;if(q.substring(q.length-5)=="_html"){m=q.substring(0,q.length-5)}o=o+'<div class="'+m+'">'+s[q]+"</div>"}o=o+"</div>"}l=l+'<div id="planet'+this.id+'" class="planet">'+o+"</div>"});return l}function createImperiumHtml(o,s,q,n){var v=0;if(typeof q.planets!="undefined"){v=q.planets.length}var r=345+v*165;$("#mainWrapper").attr("style","width: "+r+"px");$(s).show();var p=createHeaderHtml(q)+'<div class="planetWrapper">'+createPlanetsHtml(q)+createSummaryHtml(q)+'</div><br class="clearfloat"/>';$(o).append(p);$(o+" .planetWrapper").sortable({start:function(){removeTooltip(getTooltipSelector())},update:function(){saveImperiumOrder(o+" .planetWrapper",n)}}).disableSelection();for(group in q.groups){$(o+" .headers"+group).click(function(){var a=o+" .group"+$(this).attr("group");var b="#"+$(this).attr("group")+" h3";$(a).toggle();$(b).removeClass("openhover").removeClass("closehover").removeClass("close").removeClass("open");if($(a).attr("style").toLowerCase().substr(9,4)=="none"){$(b).addClass("close");$.cookie("impToggleState"+$(this).attr("group"),"1",{expires:365})}else{$(b).addClass("open");$.cookie("impToggleState"+$(this).attr("group"),"0",{expires:365})}});var u=$.cookie("impToggleState"+group);if(u!=null&&u=="1"){$("#"+group+" > h3").removeClass("open");$("#"+group+" > h3").addClass("close");$(o+" .group"+group).toggle()}}$(s).hide();var m=$.inArray(0,empireOrder);if(m>-1){$(".planetWrapper .planet:eq("+m+"):not(:last-child)").before($("#planet0"))}initTooltips()}function displayMessage(b){location.reload(true)}function doUpgrade(n,r,q,m,o){if(forcedToVacation){errorBoxNotify(LocalizationStrings.error,LocalizationStrings.forcedVacationWarning,LocalizationStrings.ok);return}var p={};p.modus=q;p.techid=n;p.listid=m;p.planet=r;var s=LocalizationStrings.lastSlotWarningPlanet;var l=upgradeUrl;if(q==2){l+="&token="+cancelBuildingToken}if(planetType==1){s=LocalizationStrings.lastSlotWarningMoon}if(o){errorBoxDecision(LocalizationStrings.attention,s,LocalizationStrings.yes,LocalizationStrings.no,function(){$.post(l,p,displayMessage)})}else{$.post(l,p,displayMessage)}}function initEmpire(){initConnectionErrorFunction();$(".secondCat").each(function(){$(this).find("li:last").addClass("catbox-end")});$(".values").each(function(){if(!$(this).hasClass("groupitems")){$(this).find("div:even").addClass("even");$(this).find("div:odd").addClass("odd");$(this).find("div:last").addClass("box-end")}if($(this).children().hasClass("equipment")){$(this).children(".equipment").addClass("box-end")}});$("#settings li:last").addClass("set-end");$(".header h3").hover(function(){$(this).addClass($(this).attr("class")+"hover")},function(){$(this).removeClass("openhover").removeClass("closehover")});$(".header h3").click(function(){$(this).removeClass("openhover").removeClass("closehover");var b=$(this).attr("class");if(b=="open"){$(this).addClass("close")}else{$(this).addClass("open")}$(this).removeClass(b)});$(".planet").hover(function(){$(this).addClass("move")},function(){$(this).removeClass("move")});$(".values div img").hover(function(){$(this).addClass("imghover")},function(){$(this).removeClass("imghover")});$("#planetsTab").click(function(){window.location.href=empireUrl+"&planetType=0"});if(moonCount>0){$("#moonsTab").click(function(){window.location.href=empireUrl+"&planetType=1"})}else{$("#moonsTab").addClass("nomoons")}if(planetType==1){$("#planetsTab").removeClass("active");$("#moonsTab").addClass("active")}initBuffBarEmpire()}function initBuffBarEmpire(){var b=$(".empireItems");b.anythingSlider({resizeContents:false,buildNavigation:false,buildStartStop:false,infiniteSlides:false,stopAtEnd:true});b.removeClass("hidden")}function toggleEvents(b){if($("#eventboxContent").is(":hidden")){$("#eventboxContent").slideDown("fast");$("#js_eventDetailsClosed").hide();$("#js_eventDetailsOpen").show();if(typeof toggleEvents.loaded=="undefined"||!toggleEvents.loaded){$("#eventboxContent").html('<img height="16" width="16" src="//gf3.geo.gfsrv.net/cdne3/3f9884806436537bdec305aa26fc60.gif" />');$.get(eventlistLink,function(a){$("#eventboxContent").html(a);toggleEvents.loaded=true})}}else{if(b){return}$("#eventboxContent").slideUp("fast");$("#js_eventDetailsClosed").show();$("#js_eventDetailsOpen").hide()}$("#contentWrapper select").ogameDropDown("hide")}function showGoogleAnalytics(){var g=(("https:"==document.location.protocol)?"https://ssl.":"http://www.");document.write(decodeURI("%3Cscript src='"+g+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));try{var f=_gat._getTracker("UA-11968132-1");f._setDomainName(".ogame.gameforge.com");f._trackPageview()}catch(d){}}function changeSetting(m,l,k,g,h){$.ajax({type:"POST",url:changeSettingsLink,dataType:"json",data:{token:changeSettingsToken,key:m,value:l},success:function(a){changeSettingsToken=a.newToken;if(a.message.length>0){fadeBox(a.message,a.error)}if(!a.error&&typeof(k)=="function"){k()}else{if(a.error&&typeof(g)=="function"){g()}}},error:function(a){if(typeof(h)=="undefined"||h){fadeBox(LocalizationStrings.error,true)}if(a.error&&typeof(g)=="function"){g()}}})}function getOverlayText(b){if(b.hasClass("building")&&b.children().hasClass("build-faster-img")){return locaPremium.buildingHalfOverlay}else{if(b.hasClass("building")&&b.children().hasClass("build-finish-img")){return locaPremium.buildingFullOverlay}else{if(b.hasClass("ships")&&b.children().hasClass("build-faster-img")){return locaPremium.shipsHalfOverlay}else{if(b.hasClass("ships")&&b.children().hasClass("build-finish-img")){return locaPremium.shipsFullOverlay}else{if(b.hasClass("research")&&b.children().hasClass("build-faster-img")){return locaPremium.researchHalfOverlay}else{if(b.hasClass("research")&&b.children().hasClass("build-finish-img")){return locaPremium.researchFullOverlay}}}}}}}function getFastBuildPrice(b){if(b.hasClass("building")){return priceBuilding}else{if(b.hasClass("research")){return priceResearch}else{if(b.hasClass("ships")){return priceShips}}}}function getRedirectLink(g){var d={_rnd:Math.random()};if(g!=undefined){for(var f in g){d[f]=g[f]}}return $.param.fragment($.param.querystring(window.location.href,d),{})}function sendShips(k,l,m,h,o,n){if(shipsendingDone==1){shipsendingDone=0;params={mission:k,galaxy:l,system:m,position:h,type:o,shipCount:n,token:miniFleetToken};$.ajax(miniFleetLink,{data:params,dataType:"json",type:"POST",success:function(a){if(typeof(a.newToken)!="undefined"){miniFleetToken=a.newToken}displayMiniFleetMessage(a.response)}})}}function sendShipsWithPopup(k,l,m,h,o,n){params={mission:k,galaxy:l,system:m,position:h,type:o,shipCount:n,token:miniFleetToken};$.ajax(miniFleetLink,{data:params,dataType:"json",type:"POST",success:function(a){if(typeof(a.newToken)!="undefined"){miniFleetToken=a.newToken}fadeBox(a.response.message+" "+a.response.coordinates.galaxy+":"+a.response.coordinates.system+":"+a.response.coordinates.position,!a.response.success)}})}function outlawWarning(r,v,u,q,o,m,n){if(typeof(n)!="function"){if(r==constants.espionage){n=s}else{if(r==constants.missleattack){n=p}}}if(showOutlawWarning){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.outlawWarning,LocalizationStrings.yes,LocalizationStrings.no,n)}else{n()}function s(){sendShips(r,v,u,q,o,m)}function p(){openOverlay(missleAttackLink+"&galaxy="+v+"&system="+u+"&position="+q+"&planetType="+o,{modal:true})}}function initThousandSeparator(){$(".checkThousandSeparator").unbind("keyup.checkThousandSeparator").bind("keyup.checkThousandSeparator",function(f){if(f.which==8||f.which==46){var g=$(this).getSelection();var h=$(this).val();if(h.substr(g.start-1,1)==LocalizationStrings.thousandSeperator){var k;if(f.which==8){k=h.substr(0,g.start-2)+h.substr(g.start-1)}else{k=h.substr(0,g.start)+h.substr(g.start+1)}formatNumber($(this),k)}}})}function initIndex(){initConnectionErrorFunction();timerHandler.appendCallback(function(){localTime=new Date();serverTime=new Date(localTime.valueOf()+timeDiff);$(".OGameClock").html(getFormatedDate(serverTime.getTime(),"[d].[m].[Y] <span>[H]:[i]:[s]</span>"))});$("select").ogameDropDown();$("#planet .slot").hover(function(){$(this).addClass("slot-hover")},function(){$(this).removeClass("slot-hover")});$("#eventboxFilled").hover(function(){$(this).addClass("eventboxHover")},function(){$(this).removeClass("qeventboxHover")});$(document).undelegate(".eventToggle","click").delegate(".eventToggle","click",function(){toggleEvents();return false}).undelegate("a.build-faster","click").delegate("a.build-faster","click",function(){var d=$(this);if(darkMatter<getFastBuildPrice(d)){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return}var a=$.deparam.querystring().page;errorBoxDecision(loca.notice,getOverlayText(d),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:d.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:a},type:"POST",dataType:"json",error:function(){fadeBox(LocalizationStrings.error,true);d.addClass("disabled")},success:function(c){activateToken=c.newToken;if(c.error){fadeBox(c.message,true);d.addClass("disabled")}else{location.href=getRedirectLink()}}});return false})}).undelegate(".slideIn","click").delegate(".slideIn","click",function(){$(".slideIn").removeClass("active");var a=$(this).attr("ref");$("a[ref='"+a+"']").addClass("active");Tipped.hideAll();$("html, body").animate({scrollTop:0},500);gfSlider.slideIn(getElementByIdWithCache("detail"),a)});if($("#eventboxContent").is(":visible")){toggleEvents.loaded=true;$("#js_eventDetailsClosed").hide();$("#js_eventDetailsOpen").show()}$("#banner_skyscraper a.close_details").click(function(){changeSetting("hideBanner",$(this).attr("ref"),function(){$("#banner_skyscraper").remove()})});var b=$("#wreckFieldCountDown");if(b){}initHideElements();initOverlays();initThousandSeparator();initExodus();initTooltips();initAjaxResourcebox();initPlanetSorting();initRetinaImages();initBDayEventHints()}function initPlanetSorting(){$("#planetList.sortable").sortable({start:function(){Tipped.hideAll()},stop:function(){Tipped.hideAll();changeSetting("customPlanetOrder",$(this).sortable("toArray"))}});if($(".lockPlanets").hasClass("closed")){$("#planetList.sortable").sortable("disable")}$(".lockPlanets").unbind("click").bind("click",function(){var b=$(this);changeSetting("planetOrderLocked",b.hasClass("open")?1:0,function(){var a;if(b.hasClass("open")){b.removeClass("open").addClass("closed");$("#planetList.sortable").sortable("disable");a=LocalizationStrings.planetOrder.unlock}else{b.removeClass("closed").addClass("open");$("#planetList.sortable").sortable("enable");a=LocalizationStrings.planetOrder.lock}changeTooltip(b,a)})})}function initHideElements(){$(document).undelegate("html","touchstart.hideElem click.hideElem").delegate("html","touchstart.hideElem click.hideElem",function(m){m.stopPropagation();if($(this).data("noclick")){return}if(isMobile){var k=m.target.tagName.toUpperCase();if(!(k==="TEXTAREA"||k==="INPUT"||k==="SELECT")){document.activeElement.blur()}if(!$(m.target).parents(".markItUpHeader ul").length){$(".markItUpHeader ul ul").hide()}}if(!$(m.target).parents(".t_Tooltip").length){Tipped.hideAll()}if(!isMobile){if($(m.target).parents(".ui-dialog").length||$(m.target).parents(".t_Tooltip").length){return}var l=$(".overlayDiv");if(typeof(l.data("uiDialog"))!="undefined"){var o=l.find(".markItUpDropMenu[id]");for(var h=0;h<o.length;++h){var n=$("body>ul[rel="+o[h].id+"]");n.hide()}l.dialog("close")}}})}function initJumpgate(){$("select").ogameDropDown();$(".list tr:even").addClass("alt");$(document).undelegate("#jumpgateForm .ship_input_row .textinput","keyup change input").delegate("#jumpgateForm .ship_input_row .textinput","keyup change input",function(){checkIntInput(this,0,$(this).attr("rel"))}).undelegate("#jumpgateForm .ship_input_row .textinput","focus").delegate("#jumpgateForm .ship_input_row .textinput","focus",function(){$(this).val("")});$("#jumpgate .answerHeadline, .js_openStandardMoonMenu").click(function(){if(!player.hasCommander){errorBoxNotify(LocalizationStrings.error,translation.changeSettingOnlyWithCommander,LocalizationStrings.ok,null,false)}else{$("#jumpgate").find(".answerHeadline").toggleClass("open");$(".thirdCol").toggleClass("hidden")}});$(".js_executeJumpButton").click(function(){var d=$("#jumpgateForm").find('select[name="zm"]').val();if(d!=0){var c=true;$(".ship_selection_table input").each(function(){if($(this).val()>0){c=false}});if(!c){ajaxFormSubmit("jumpgateForm",$(this).attr("data-url"),jumpgateDone)}else{fadeBox(translation.noShipsWereSelected,true)}}else{fadeBox(translation.validTargetNeeded,true)}})}function jumpgateDone(b){var b=$.parseJSON(b);if(b.status){planet=b.targetMoon;$(".overlayDiv").dialog("destroy")}errorBoxAsArray(b.errorbox);if(typeof(b.newToken)!="undefined"){setNewTokenData(b.newToken)}}function jumpgateDefaultTargetSelectionCallback(g){var g=$.parseJSON(g);if(g.status){var f=$("#jumpgateForm").find('select[name="zm"]');f.find("option").removeAttr("selected");var d=f.find('option[value="'+g.targetMoon+'"]');if(d.length){d.attr("selected","selected")}else{if(f.find('option[value="0"]').length==0){f.append($(document.createElement("option")).attr("value",0).attr("selected","selected").text("--"))}else{f.find('option[value="0"]').attr("selected","selected")}}f.trigger("change");f.ogameDropDown("refresh")}errorBoxAsArray(g.errorbox);if(typeof(g.newToken)!="undefined"){setNewTokenData(g.newToken)}}function setNewTokenData(b){$('#jumpgateForm input[name="token"]').val(b);$('#jumpgateDefaultTargetSelectionForm input[name="token"]').val(b)}if(typeof KeyEvent=="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}(function(b){b.fn.extend({ogameDropDown:function(m){if(b("body.showOldDropdowns").length){return this}function a(d){var c=d.outerHeight();var g=b('.dropdown.currentlySelected[rel="'+d.attr("id")+'"]');if(g.length){var h=Math.min(b(window).innerWidth()+b(window).scrollLeft()-d.width()-3,g.offset().left);var q;var f=Math.ceil(g.offset().top);if(f+g.height()+c+b("#siteFooter").outerHeight()>=b(window).innerHeight()+b(window).scrollTop()){q=f-c+1}else{q=f+g.height()+1}d.css("left",h).css("top",q).css("min-width",g.width())}}var l={destroy:function(){b(this).filter("select.dropdownInitialized").each(function(){var c=b(this);b('.dropdown[rel="'+c.data("dropdownId")+'"]').remove();b("ul#"+c.data("dropdownId")).remove();c.removeClass("dropdownInitialized").data("dropdownId","").show()})},hide:function(){b(this).filter("select.dropdownInitialized").each(function(){var c=b('.currentlySelected[rel="'+b(this).data("dropdownId")+'"]');c.find("a").removeClass("hover");b(".dropdownList#"+c.attr("rel")).hide()})},reposition:function(){b(this).filter("select.dropdownInitialized").each(function(){a(b("#"+b(this).data("dropdownId")))})},refresh:function(){var d=b(this).find("option[selected]");var f=getIEVersion()<999?"#":"javascript:void(0);";var c=b('a[class="'+d.attr("class")+'"][rel="'+b(this).data("dropdownId")+'"]').text(d.text())}};if(typeof(m)=="string"){if(typeof(l[m])=="function"){l[m].call(this)}return this}b(this).filter("select:not(.dropdownInitialized)").each(function(){var h=b(this);var d="dropdown"+Math.floor(Math.random()*1000);var u=h.find("option[selected]");if(u.length==0){u=h.find("option:first-child")}var c=getIEVersion()<999?"#":"javascript:void(0);";var g=b('<a class="'+u.attr("class")+'" data-value="'+u.val()+'" rel="'+d+'" href="'+c+'">'+u.text()+"</a>");var s=b('<span class="dropdown currentlySelected '+h.attr("class")+'" rel="'+d+'"></span>').append(g).width(h.css("width").length?h.css("width"):h.width()).data("selectElement",h);if(h.is("[readonly]")||h.is(":disabled")){s.addClass("disabled")}h.after(s).hide().addClass("dropdownInitialized").data("dropdownId",d);var v=b('<ul class="dropdown dropdownList" id="'+d+'"></ul>').delegate("a","click",function(p){p.stopPropagation();g.html(b(this).html()).attr("class",b(this).attr("class")).attr("data-value",b(this).attr("data-value"));v.hide().find("a").removeClass("focus");b(this).addClass("focus");var q=b(this).attr("data-value");h.val(b(this).attr("data-value")).trigger("change").find('option[value="'+q+'"], option:contains("'+q+'")').trigger("click")});function f(){if(h.is(h.is("[readonly]")||":disabled")){return}if(!v.hasClass("initialized")){v.addClass("initialized");h.find("option").each(function(){var p=b(this).html();if(typeof(b(this).attr("data-html"))!="undefined"){p=b(this).attr("data-html")}if(typeof(b(this).attr("data-html-prepend"))!="undefined"){p=b(this).attr("data-html-prepend")+p}if(typeof(b(this).attr("data-html-append"))!="undefined"){p+=b(this).attr("data-html-append")}$li=b('<li><a class="'+b(this).attr("class")+'" data-value="'+b(this).val()+'">'+p+"</a></li>");v.append($li);if(b(this).is(":selected")){$li.find("a").addClass("focus")}})}}g.bind("focus",function(p){b(".dropdownList").not(v).hide();b(".dropdown.currentlySelected").removeClass("focus");b(this).addClass("hover");s.addClass("focus");f()}).bind("mousewheel",function(p){f();b(this).unbind("mousewheel")}).bind("click",function(p){p.preventDefault();if(h.is(h.is("[readonly]")||":disabled")){return}b(".dropdownList").not(v).hide();b(".dropdown.currentlySelected").removeClass("focus");s.addClass("focus");if(v.is(":hidden")){b(this).addClass("hover");f();a(v);b(window).unbind("resize.dropdown"+d).bind("resize.dropdown"+d,function(){a(v)});v.show();if(v.hasScrollbar()){v.find("a").css("padding-right",22)}}else{b(this).removeClass("hover");b(window).unbind("resize.dropdown"+d);v.hide()}});b("body").append(v)});var n="";var k;function o(g,h){n=g;clearTimeout(k);k=setTimeout(function(){n=""},1500);var c=b(".dropdownList:visible");var r=false;if(c.length==0){var d=b(".dropdown.currentlySelected.focus");if(d.length){c=b("#"+d.attr("rel"));r=true}else{return}}var s=n.toLowerCase();var f=c.find("a").filter(function(){if(b(this).attr("data-value").toLowerCase().indexOf(s)==0){return true}return b(this).text().trim().toLowerCase().indexOf(s)==0});if(f.length){h.preventDefault();c.find("a").removeClass("focus");b(f.get(0)).addClass("focus").focus();if(r){f.click()}}else{clearTimeout(k);n=""}}b(document).undelegate("html","touchstart.dropdown click.dropdown").delegate("html","touchstart.dropdown click.dropdown",function(c){if(b(c.target).closest(".dropdown").length==0){b(".dropdownList").hide();b(".currentlySelected a").removeClass("hover");b(".currentlySelected").removeClass("focus")}}).undelegate(".dropdown","mousewheel.dropdown").delegate(".dropdown","mousewheel.dropdown",function(d,B){d.preventDefault();var x=b(d.target).closest(".dropdown");var f;if(x.hasClass("currentlySelected")){f=b("#"+x.attr("rel"))}else{f=x}var c=b('[rel="'+f.attr("id")+'"] a');var y=f.find("a:focus");if(y.length==0){y=f.find("a.focus")}if(y.length==0){y=f.find('a[data-value="'+c.attr("data-value")+'"]')}var h=y.parent();var A=null;var g=Math.abs(B);if(B>0){for(var C=0;C<g;C++){if(h.is(":first-child")){A=h.find("a");break}else{A=h.prev().find("a")}h=A.parent()}}else{for(var C=0;C<g;C++){if(h.is(":last-child")){A=h.find("a");break}else{A=h.next().find("a")}h=A.parent()}}if(A!=null){h=A.parent();f.find("a").removeClass("focus");A.addClass("focus").focus();if(f.is(":hidden")){A.click()}else{var w=h.position().top;if(w<0){f.scrollTop(f.scrollTop()+w)}else{if(w+h.outerHeight()>f.innerHeight()){f.scrollTop(f.scrollTop()+w+h.outerHeight()-f.innerHeight())}}}}}).undelegate("*","focus.dropdown").delegate("*","focus.dropdown",function(c){if(b(c.target).closest(".dropdown").length==0){b(".currentlySelected a").removeClass("hover");b(".currentlySelected").removeClass("focus")}}).unbind("keydown.dropdown").bind("keydown.dropdown ",function(f){if(b(":focus").length>0&&b(":focus").parents(".dropdown").length==0){return}var d=false;var h=b(".dropdownList:visible");if(h.length==0){var g=b(".dropdown.currentlySelected.focus");if(g.length){h=b("#"+g.attr("rel"));d=true}else{return}}var c=b('[rel="'+h.attr("id")+'"] a');var w=h.find("a:focus");if(w.length==0){w=h.find("a.focus")}if(w.length==0){w=h.find('a[data-value="'+c.attr("data-value")+'"]')}var u=w.parent();var x=null;if(f.keyCode==KeyEvent.DOM_VK_UP||f.keyCode==KeyEvent.DOM_VK_DOWN||typeof(delta)!="undefined"){if(f.keyCode==KeyEvent.DOM_VK_UP){if(u.is(":first-child")){x=u.find("a")}else{x=u.prev().find("a")}u=x.parent()}else{if(u.is(":last-child")){x=u.find("a")}else{x=u.next().find("a")}u=x.parent()}f.preventDefault()}else{if(f.keyCode==KeyEvent.DOM_VK_BACK_SPACE){o(n.substring(0,n.length-1),f)}else{if(f.keyCode==KeyEvent.DOM_VK_RETURN){f.preventDefault();if(d){c.parents("form").submit();return}else{d=true;x=w}}else{if(f.keyCode==KeyEvent.DOM_VK_ESCAPE){x=h.find('[data-value="'+c.attr("data-value")+'"]');d=true}}}}if(x!=null){u=x.parent();h.find("a").removeClass("focus");x.addClass("focus").focus();if(d){x.click()}else{var v=u.position().top;if(v<0){h.scrollTop(h.scrollTop()+v)}else{if(v+u.outerHeight()>h.innerHeight()){h.scrollTop(h.scrollTop()+v+u.outerHeight()-h.innerHeight())}}}}}).unbind("keypress.dropdown").bind("keypress.dropdown",function(c){if(b(":focus").length>0&&b(":focus").parents(".dropdown").length==0||c.charCode==0){return}o(n+String.fromCharCode(c.charCode),c)});return b(this)},selectText:function(){var a,l,h=this[0],m={func:"function",obj:"object"},k=function(d,c){return typeof c===d};if(k(m.obj,h.ownerDocument)&&k(m.obj,h.ownerDocument.defaultView)&&k(m.func,h.ownerDocument.defaultView.getSelection)){l=h.ownerDocument.defaultView.getSelection();if(k(m.func,l.setBaseAndExtent)){l.setBaseAndExtent(h,0,h,b(h).contents().size())}else{if(k(m.func,h.ownerDocument.createRange)){a=h.ownerDocument.createRange();if(k(m.func,a.selectNodeContents)&&k(m.func,l.removeAllRanges)&&k(m.func,l.addRange)){a.selectNodeContents(h);l.removeAllRanges();l.addRange(a)}}}}else{if(k(m.obj,document.body)&&k(m.obj,document.body.createTextRange)){a=document.body.createTextRange();if(k(m.obj,a.moveToElementText)&&k(m.obj,a.select)){a.moveToElementText(h);a.select()}}}return this},hasScrollbar:function(){return this.get(0).scrollHeight>this.innerHeight()}})})(jQuery);ogame.messagecounter={countData:{chat:0,messages:0,buddy:0},newChats:Array(),type_chat:10,type_message:11,type_buddy:12,currentLinkSelector:null,currentType:0,currentPlayer:null,sumNewChatMessages:0,initialize:function(d,f){var g=ogame.messagecounter;if(typeof f=="undefined"&&d!==g.type_chat){g.currentPlayer=0}if(typeof f=="undefined"&&d==g.type_chat){return false}if(typeof f!=="undefined"){g.currentPlayer=f}g.currentType=d;switch(d){case g.type_chat:g.currentLinkSelector=$("a.comm_menu.chat");break;case g.type_message:g.currentLinkSelector=$("a.comm_menu.messages");break;case g.type_buddy:g.currentLinkSelector=$("a.comm_menu.buddies");break;default:return false}g.update()},initChatCounter:function(d){var c=ogame.messagecounter;c.currentLinkSelector=$("a.comm_menu.chat");c.currentType=c.type_chat;c.setCount(d);c.update()},update:function(){var b=ogame.messagecounter;changeTooltip(b.currentLinkSelector,chatLoca.X_NEW_CHATS.replace("#+#",b.getCount()))},resetCounterByType:function(d){var g=ogame.messagecounter;var f=g.getIconSelectorByType(d);changeTooltip(f,chatLoca.X_NEW_CHATS.replace("#+#",0))},getCountSelectorByType:function(f){var g=ogame.messagecounter;var d="";switch(f){case g.type_chat:d=$("a.comm_menu.chat .new_msg_count");break;case g.type_message:d=$("a.comm_menu.messages .new_msg_count");break;case g.type_buddy:d=$("a.comm_menu.buddies .new_msg_count")}return d},getIconSelectorByType:function(d){var g=ogame.messagecounter;var f="";switch(d){case g.type_chat:f=$("a.comm_menu.chat");break;case g.type_message:f=$("a.comm_menu.messages");break;case g.type_buddy:f=$("a.comm_menu.buddies")}return f},getCounterHtml:function(c){var d='<span class="new_msg_count">'+c+"</span>";return d},getCount:function(){var b=ogame.messagecounter;switch(b.currentType){case b.type_chat:return b.countData.chat;case b.type_message:return b.countData.messages;case b.type_buddy:return b.countData.buddy}},setCount:function(d){var c=ogame.messagecounter;switch(c.currentType){case c.type_chat:c.countData.chat=d;break;case c.type_message:c.countData.messages=d;break;case c.type_buddy:c.countData.buddy=d;break}},updateCountData:function(){var g=ogame.messagecounter;if(g.isOpen()){g.setCount(0)}else{if(g.shouldAddCounter()){var d=1}else{var f=g.getCountSelectorByType(g.currentType);var d=f.html();d=parseInt(d)+1}g.setCount(d)}},shouldAddCounter:function(){var h=ogame.messagecounter;var f=h.getCountSelectorByType(h.currentType);var g=f.html();var k=false;if(typeof g=="undefined"){k=true}return k},setNewCounter:function(d,c){d.html(c)},isOpen:function(){var c=ogame.messagecounter;var d=false;switch(c.currentType){case c.type_chat:d=ogame.chat.isOpen(c.currentPlayer);break;case c.type_message:d=(location.href.indexOf("page=messages")>-1);break;case c.type_buddy:d=(location.href.indexOf("page=buddies")>-1);break}return d}};ogame.messagemarker={type_chatbar:10,type_chattab:11,action_remove:20,action_add:21,currentCount:"",currentSelector:"",currentPlayernameObject:"",currentListPlayernameObject:"",currentPartnerId:"",currentListItemSelector:"",totalNewMessages:0,playerlist:new Array(),newsInitialized:false,effect:"none",initialize:function(){$(".new_msg_count[data-playerid]").each(function(){var c=ogame.messagemarker;var d=$(this).data("playerid");if(d&&$.inArray(d,c.playerlist)===-1){c.playerlist.push(d);c.setPartnerId(d);c.updateNewMarker()}});ogame.messagemarker.effect="highlight"},initMarker:function(f){var d=ogame.messagemarker;var g=0;$.each(f,function(b,a){d.setPartnerId(a);var c=$('.new_msg_count[data-playerid="'+a+'"]').data("new-messages");if(c!=null&&c>0){d.setSelectorByType(d.type_chatbar);d.mark(d.currentSelector,d.currentPlayernameObject,c);d.mark(d.currentListItemSelector,d.currentListPlayernameObject,c);d.setSelectorByType(d.type_chattab);d.mark(d.currentSelector,d.currentPlayernameObject,c)}g=g+1});return g},setCounter:function(c,d){this.setPartnerId(c);$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages",d);this.updateNewMarker()},toggle:function(k,f,h,g){this.setPartnerId(h);this.currentCount=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages"));if(k===this.action_add){this.updateNewMarker()}if(k===this.action_remove){this.removeNewMarker()}},mark:function(f,d,g){$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css("font-weight","bold");$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css("font-weight","bold")},addNewMarker:function(){var b=false;if(!$(this.currentSelector).find(".newMsgMarker").length){this.mark(this.currentSelector,this.currentPlayernameObject,this.currentCount);b=true}if(!$(this.currentListItemSelector).find(".newMsgMarker").length){this.mark(this.currentListItemSelector,this.currentListPlayernameObject,this.currentCount);b=true}if(!b){this.updateNewMarker()}},removeNewMarker:function(){$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css("font-weight","normal");$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css("font-weight","normal")},updateNewMarker:function(){var d=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages"));var f=$(".new_msg_count.totalChatMessages").text();var g=ogame.chat.updateTotalNewChatCounter();if(d===0){if(isNaN(this.currentPartnerId)){$(".new_msg_count.totalMessages.news").text(d).addClass("noMessage")}else{$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(d).addClass("noMessage");if(g===0){$(".new_msg_count.totalChatMessages").text(g).addClass("noMessage")}else{if(f!=g){$(".new_msg_count.totalChatMessages").text(g).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}}}else{if(isNaN(this.currentPartnerId)){if(isNaN(d)){$(".new_msg_count.totalMessages.news").text(0).addClass("noMessage")}else{$(".new_msg_count.totalMessages.news").text(d).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}else{$('.msg[data-playerid="'+this.currentPartnerId+'"]').addClass("msg_new");$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(d).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500);if(f!=g){$(".new_msg_count.totalChatMessages").text(g).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}}},setSelectorByType:function(b){selector="";if(b==this.type_chatbar){selector='ul.chat_bar_list li.chat_bar_list_item[data-playerid="'+this.currentPartnerId+'"]'}if(b==this.type_chattab){selector='ul#chatMsgList li.msg[data-playerid="'+this.currentPartnerId+'"]'}this.currentListItemSelector='.js_playerlist ul.playerlist li.playerlist_item[data-playerid="'+this.currentPartnerId+'"]';this.currentSelector=selector;this.currentPlayernameObject=$(selector).find(".cb_playername");this.currentListPlayernameObject=$(this.currentListItemSelector).find(".playername")},setPartnerId:function(b){this.currentPartnerId=b}};ogame.messages={data:{initActions:{"tabs-nfFleets":"initTabFleets","tabs-nfCommunication":"initTabCommunication","subtabs-nfCommunicationMessages":"initSubTabMessages"}},addMessage:function(m,g,h){if(h!==false){h=true}if(m.attr("aria-selected")!=="true"){console.warn("addMessage: not correct Tab, aria-selected = ",m.attr("aria-selected"),m);return}if(!g){console.warn("addMessage: msgData is ",g);return}var k=$("#"+m.attr("aria-controls")).find(".tab_inner");var l=false;if(h){l=true}ogame.messages.createMessageItem(g,k,l)},createMessageItem:function(p,m,n){var q={};for(var l in p){var o=p[l];q[l]=o.msgID}var k=JSON.stringify(q);$.ajax({url:"?page=messages",type:"POST",dataType:"html",data:{messageId:k,tabid:this.getCurrentMessageTab(),action:121,ajax:1},success:function(a){if(n){m.prepend(a)}else{var b=m.find(".favoriteCount");if(b.length>0){$(a).insertBefore(b)}else{m.append(a)}}},error:function(c,a,b){}})},createBroadcastMsgItem:function(g){if(!g){console.warn("createMessageItem: msgData is missing!");return undefined}var h=$('<div class="msg_head"></div>');h.append('<span class="msg_title blue_txt">'+g.title+"</span>");h.append('<span class="msg_date fright">'+g.date+"</span><br>");h.append('<span class="msg_sender_label">'+loca.LOCA_WRITE_MSG_FROM+": </span>");h.append('<span class="msg_sender">'+g.senderName+"</span>");var k=$('<div class="msg_actions clearfix"></div>');k.append('<a class="fright txt_link overlay" href="'+g.detailURL+'" data-overlay-title="'+loca.broadcasts+'">'+loca.details+"</a>");k.append('<a class="fright txt_link comments_link overlay" href="'+g.commentsURL+'" data-overlay-title="'+loca.broadcasts+'">'+g.commentsCount+' <span class="comments"></span></a></a>');var f=$('<li class="msg '+g.newClass+'" data-msg-id="'+g.msgID+'"></li>');f.append('<div class="msg_status"></div>');f.append(h);f.append('<span class="msg_content">'+g.msgContent+"</span>");f.append(k);return f},createRecipient:function(n,h,o){var k,l;$(".input_replacement").each(function(){l=new RegExp($(this).data("recipient-cat"));if(l.test(h)){k=$(this)}});if(k===undefined){return}var m=k.children(".recipient_txt").filter(function(){return($(this).data("recipient-id")===n)});if(m.length===0){if(!k.hasClass("focus")){k.addClass("focus")}k.append('<div class="recipient_txt" data-recipient-id="'+n+'" data-recipient-cat="'+h+'">'+o+'<a role="button" class="remove_recipient"></a></div>')}},doInitAction:function(b){if(typeof ogame.messages[ogame.messages.data.initActions[b]]==="function"){return ogame.messages[ogame.messages.data.initActions[b]]()}else{return console.warn("These is no function defined for action: ",b)}},initCombatReportDetails:function(){if($("select").length>0){$("select").ogameDropDown()}},initDetailMessages:function(c){$(".detail_list_el:nth-of-type(4n + 3), .detail_list_el:nth-of-type(4n + 4)").addClass("odd");var d=$(window).height()-200;$(".detail_msg_ctn").css("height",d);$(".detail_msg_ctn").mCustomScrollbar({theme:"ogame"});if(c){$("#scrollToComments").on("click",function(){$(".detail_msg_ctn").mCustomScrollbar("scrollTo","bottom")});initBBCodeEditor(locaKeys,itemNames,false,".comment_textarea",2000)}$("#messages ul.pagination").on("click","li.p_li a",function(){var a=$(this).data("tabid");var b=$(this).data("messageid");$.post("?page=messages",{tabid:a,messageId:b,ajax:1},function(k){var h=$(k).find("#messages .ui-dialog");$(".overlayDiv").html(k)})})},initMessages:function(){$(".js_tabs .tabs_btn_img").each(function(){if($(this).attr("rel")){$(this).attr("href",$(this).attr("rel"))}});ogame.messages.initTabs($(".js_tabs"));var b=ogame.messages.getCurrentMessageTab();$("#contentWrapper #buttonz div.js_tabs.tabs_wrap.ui-tabs").on("click","ul li.list_item",function(){var a=ogame.messages.getCurrentMessageTab()});$("body").on("click",".msg_actions .icon_not_favorited",function(d){var a=$(this).parents("li.msg").data("msg-id")||$(this).parents("div.detail_msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:b,messageId:a,action:101,ajax:1},success:function(g){if(g[a]["result"]==true){$(d.target).removeClass("icon_not_favorited").addClass("icon_favorited");changeTooltip($(d.target),loca.DELETE_FAV);var c=$(".favoriteTabFreeSlotCount");c.html(parseInt(c.html())-1)}else{if(g[a]["reason"]!=="undefined"){fadeBox(g[a]["reason"],1)}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}}},error:function(){}})}).on("click",".msg_actions .icon_favorited",function(d){var a=$(this).parents("li.msg").data("msg-id")||$(this).parents("div.detail_msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:b,messageId:a,action:102,ajax:1},success:function(g){if(g[a]["result"]==true){$(d.target).removeClass("icon_favorited").addClass("icon_not_favorited");changeTooltip($(d.target),loca.ADD_FAV);var c=$(".favoriteTabFreeSlotCount");c.html(parseInt(c.html())+1)}else{if(g[a]["reason"]!=="undefined"){fadeBox(g[a]["reason"],1)}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}}},error:function(){}})}).on("click",".js_actionKill",function(d){var a=$(this).parents("li.msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{messageId:a,action:103,ajax:1},success:function(c){if(c[a]==true){$(d.target).parents("li.msg").remove()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionKillAll",function(a){$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:103,ajax:1},success:function(d){if(d.result==true){location.reload()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionKillDetail",function(d){var a=$(".overlayDiv .detail_msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{messageId:a,action:103,ajax:1},success:function(c){if(c[a]==true){location.reload()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionRevive",function(d){var a=$(this).parents("li.msg").data("msg-id");if(a===undefined){a=$(this).parents("div.detail_msg").data("msg-id")}$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:b,messageId:a,action:104,ajax:1},success:function(c){if(c[a]==true){$(d.target).parents("li.msg").remove();$(d.target).parents("div.ui-dialog").remove();$("li.msg[data-msg-id="+a+"]").remove()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionReviveAll",function(a){$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:104,ajax:1},success:function(d){if(d.result==true){location.reload()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionDelete",function(d){var a=$(this).parents("li.msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:b,messageId:a,action:105,ajax:1},success:function(c){if(c[a]==true){$(d.target).parents("li.msg").remove()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".js_actionDeleteAll",function(d){var a=$(this).parents("li.msg").data("msg-id");$.ajax({type:"POST",url:"?page=messages",dataType:"json",data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:105,ajax:1},success:function(c){if(c.result==true){location.reload()}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1)}},error:function(){}})}).on("click",".paginator",function(k){var g=$(this).data("tab");var h=$(this).data("page");var a=$(this).closest('div[class^="ui-tabs-panel"]');$.ajax({type:"POST",url:"?page=messages",dataType:"html",data:{messageId:-1,tabid:g,action:107,pagination:h,ajax:1},success:function(c){a.html(c)},error:function(){}})})},selectCurrentMessageTab:function(){var b=$(".subtabs .ui-state-active:visible");if(!b.length){b=$(".js_tabs .ui-state-active:visible")}return b},getCurrentMessageTab:function(){var b=$(".subtabs .ui-state-active:visible").attr("data-tabid");if(!b){b=$(".js_tabs .ui-state-active:visible").attr("data-tabid")}return b},getCurrentEarliestMessage:function(){return $(".ui-tabs-panel .tab_inner .msg:visible").last().attr("data-msg-id")},initCommentForm:function(){ogame.messages.initWriteNewMsgBox($("#newCommentForm"));$("#newCommentForm").on("click",".js_send_comment",function(d){d.preventDefault();var g=$(this).closest("form");var f=g.find("input[name=messageId]").val();$.ajax({type:"POST",url:g.attr("action"),dataType:"json",data:{messageId:f,ajax:1,action:108,text:g.find("textarea[name=text]").val()},success:function(a){fadeBox(a.message,a.error);g.find("textarea[name=text]").val("");g.parent().after('<li class="msg"><div class="msg_status"></div><div class="msg_head">'+a.commentheader+'</div><div class="msg_content">'+a.commentcontent+"</div></li>");$("#scrollToComments").text(a.commentcount)},error:function(a){}})})},initShareReportOverlay:function(){ogame.messages.initWriteNewMsgBox($("#newSharedReportForm"));$("#newSharedReportForm").on("click",".js_send_msg_share",function(g){g.preventDefault();var m=$(this).closest("form");var h=m.find("input[name=messageId]").val();var k=m.find("li.select2-selection__choice");var l=[];k.each(function(){l.push($(this).attr("title"))});$.ajax({type:"POST",url:m.attr("action"),dataType:"json",data:{messageId:h,empfaenger:l,ajax:1,action:106,text:m.find("textarea[name=text]").val()},success:function(a){fadeBox(a.message,a.error);m.closest('div[class^="overlayDiv"').remove()},error:function(a){}})})},initSubTabMessages:function(){$(".js_accordion").accordion({collapsible:true,heightStyle:"content",active:false});ogame.messages.initWriteNewMsgBox($("#newMsgForm"));$("html").off(".subtabmessages");$("#newMsgForm").on("click.subtabmessages",".js_send_msg",function(f){f.preventDefault();var g=$(this).parents("form");var d={};$(".input_replacement").children().each(function(){if(typeof d[$(this).data("recipient-cat")]=="undefined"){d[$(this).data("recipient-cat")]=[]}d[$(this).data("recipient-cat")].push($(this).data("recipient-id"))});$.ajax({type:"POST",url:g.attr("action"),dataType:"json",data:{empfaenger:d,text:g.find(".new_msg_textarea").val()},success:function(a){fadeBox(a.message,a.error);if(!a.error){ogame.messages.sendSubtabMsg($(".new_msg_textarea").val(),d)}},error:function(){}})})},initTabCommunication:function(){console.info("-------------initTabCommunication");ogame.messages.initTabs($(".js_subtabs_communication"))},initTabFleets:function(){console.info("-------------initTabFleets");ogame.messages.initTabs($(".js_subtabs_fleets"),ogame.messages.initTrash)},initTabs:function(c,d){c.tabs({beforeLoad:function(){$(".ajax_load_shadow").show()},load:function(a,b){console.info("load",b.tab.attr("id"));ogame.messages.doInitAction(b.tab.attr("id"));$(".ajax_load_shadow").hide();if(typeof d==="function"){d(b.tab)}},create:function(a,b){ogame.messages.doInitAction(b.tab.attr("id"))}})},initTrash:function(b){if(!b){return}$(".js_active_tab").html(b.data("subtabname"));if(b.attr("id")==="subtabs-nfFleetTrash"){$(".trash_box").addClass("trash_open");$(".in_trash").show();$(".not_in_trash").hide()}else{$(".trash_box").removeClass("trash_open");$(".in_trash").hide();$(".not_in_trash").show()}},initWriteNewMsgBox:function(b){initBBCodeEditor(locaKeys,itemNames,false,".new_msg_textarea",2000);$("html").off(".writeNewMsgBox");$("html").on("click.writeNewMsgBox",function(a){if($(".new_msg_label").hasClass("open")&&$(a.target).parents(".recipient_select_box").length<1){$(".input_replacement").removeClass("focus");$(".new_msg_label").removeClass("open");$(".new_msg_label").siblings(".recipient_select_box").hide()}});b.on("click.writeNewMsgBox",".input_replacement",function(a){a.stopPropagation();ogame.messages.toggleRecipientSelectBox($(a.target).data("recipient-cat"))}).on("click.writeNewMsgBox",".new_msg_label",function(a){a.stopPropagation();ogame.messages.toggleRecipientSelectBox($(a.currentTarget).data("recipient-cat"))}).on("click.writeNewMsgBox",".recipient_select_box .ally_rank",function(){ogame.messages.toggleRecipientSelection($(this))}).on("click.writeNewMsgBox",".remove_recipient",function(){ogame.messages.removeRecipient($(this).closest(".recipient_txt").data("recipient-id"))})},removeRecipient:function(b){$(".ally_rank").filter(function(){if($(this).data("recipient-id")===b){$(this).removeClass("selected")}});$(".recipient_txt").filter(function(){if($(this).data("recipient-id")===b){$(this).remove()}})},sendSubtabMsg:function(h,k){if(!h){console.warn("sendSubtabMsg: msg was empty");return}if(!k){console.warn("sendSubtabMsg: msg had no recipients");return}var g={};g.date=getFormatedDate(serverTime.getTime(),"[d].[m].[Y] <span>[H]:[i]:[s]</span>");g.newClass="msg_new";g.title=k;g.senderName="100011";g.msgID="111";g.msgContent=h;g.commentsURL="";g.detailURL="";g.commentsCount=0;var f=array(g);ogame.messages.addMessage($("#subtabs-nfCommunicationMessages"),f)},toggleRecipientSelectBox:function(b){$(".input_replacement").filter(function(){if($(this).data("recipient-cat")===b&&!$(this).hasClass("focus")){$(this).addClass("focus")}});$(".new_msg_label").filter(function(){var f=$(this);if(f.data("recipient-cat")===b){if(f.hasClass("open")){f.removeClass("open").siblings(".recipient_select_box").hide()}else{var a=f.siblings(".recipient_select_box"),g=a.find(".scroll_box");$(".new_msg_label").removeClass("open").siblings(".recipient_select_box").hide();f.addClass("open");a.show();(g.hasClass("mCustomScrollbar"))?g.mCustomScrollbar("update"):g.mCustomScrollbar()}}})},toggleRecipientSelection:function(d){var f=d.data("recipient-cat"),g=d.data("recipient-id");if(d.hasClass("always_selected")){return}if(d.hasClass("complete_ally")){ogame.messages.toggleSelectAllRecipients(f);return}if(!d.hasClass("selected")){ogame.messages.createRecipient(g,f,d.html());d.addClass("selected")}else{ogame.messages.removeRecipient(g)}},toggleSelectAllRecipients:function(k){var h=$(".complete_ally").hasClass("selected"),f=(h)?"255":"1",g=(h)?"loca.founder":"loca.completeAlliance";$(".input_replacement").children().remove();ogame.messages.createRecipient(f,k,g);$(".recipient_list").filter(function(){if($(this).data("recipient-cat")===k){$(this).find(".ally_rank").each(function(){if(!$(this).hasClass("always_selected")){(h)?$(this).removeClass("selected"):$(this).addClass("selected")}})}})}};function initShowMessage(){var b=$('.overlayDiv[data-page="showmessage"]');$(".answerHeadline",b).click(function(){$(this).toggleClass("open");if($(this).hasClass("open")){$(".answerForm",b).show();$(".textWrapper",b).addClass("textWrapperSmall");$(".textWrapper",b).removeClass("textWrapper")}else{$(".answerForm",b).hide();$(".textWrapperSmall",b).addClass("textWrapper");$(".textWrapperSmall",b).removeClass("textWrapperSmall")}});$(".note > div:first-child",b).addClass("newMessage");$(".info:odd",b).css("margin-left","40px");$("div.note p:first").after('<span class="seperator">');$(".answerHeadline",b).hover(function(){$(this).addClass("pushable")},function(){$(this).removeClass("pushable")});$(".melden",b).click(function(){manageErrorbox($(this).attr("rel"),1)})}function initNetworkAjax(){var f=$(".reiter");if(!$.isFunction(g)){var g=function(){f.removeClass("active");$(this).addClass("active");ajaxLoad($(this).attr("id"),1)}}f.off("click");f.click(g);$("#checkAll").off("click").click(function(){$(".checker").prop("checked",$(this).is(":checked"))});function d(a){$("#TR"+a).hide()}$(".overlay").click(function(){var a=$(this).attr("id");markAsRead(a)});$("#messageContent select").change(function(){if(typeof($("select option:selected").attr("id"))=="undefined"){$(".buttonOK").hide();mod=""}else{$(".buttonOK").show();mod=$("select option:selected").attr("id")}});$(".del").click(function(){mod=$(this).attr("id")});$(".underlined").click(function(){$(".buttonOK").hide()});reduceMsgCount(aktCat)}function MessageSlider(d){var g=this;g.htmlobject=d;var f=document.documentElement.clientHeight-160;this.open=function(){if(!this.inAction){g.startTime=new Date().getTime();g.inAction=true;g.slideInStep()}},this.slideInStep=function(){time=new Date().getTime();height=parseInt(g.currHeight*((time-g.startTime)/500));if(height<g.currHeight){g.htmlobject.style.height=height+"px";window.setTimeout(g.slideInStep,10)}else{g.htmlobject.style.height=g.currHeight+"px";g.inAction=false}},this.close=function(){if(!g.inAction){g.startTime=new Date().getTime();g.inAction=true;g.htmlobject.style.height="0px";g.inAction=false}},g.inAction=false;if(document.getElementById("messages")){g.currHeight=Math.min(document.getElementById("messages").offsetHeight,f)}else{g.currHeight=f}}ogame.messages.combatreport={data:[{combatReportId:$(".detailReport").attr("data-combatreportid")}],loca:[{weapon:"",shield:"",cover:""}],getCombatValueByCombatMember:function(){var k=ogame.messages.combatreport;var h=k.data.activeMember;var g={armorPercentage:0,weaponPercentage:0,shieldPercentage:0};var f=0;$.each(k.data.combatArray,function(b,a){if(k.check(true,h,{values:{is:{0:"all"}}})){g.armorPercentage+=a.armorPercentage;g.weaponPercentage+=a.weaponPercentage;g.shieldPercentage+=a.shieldPercentage;f++}else{if(a.ownerName==h){g.armorPercentage=a.armorPercentage;g.weaponPercentage=a.weaponPercentage;g.shieldPercentage=a.shieldPercentage;f=1}}});g.armorPercentage=Math.round(g.armorPercentage/f);g.weaponPercentage=Math.round(g.weaponPercentage/f);g.shieldPercentage=Math.round(g.shieldPercentage/f);return g},setCombatValue:function(){var c=ogame.messages.combatreport;var d=c.getCombatValueByCombatMember();$("."+c.data.combatside+"Weapon").text(c.loca.weapon+" "+d.weaponPercentage+"%");$("."+c.data.combatside+"Shield").text(c.loca.shield+" "+d.shieldPercentage+"%");$("."+c.data.combatside+"Cover").text(c.loca.cover+" "+d.armorPercentage+"%")},setCombatLoca:function(g,f,h){var k=ogame.messages.combatreport;k.loca.weapon=g;k.loca.shield=f;k.loca.cover=h},isActive:function(h,f){var k=ogame.messages.combatreport;for(var g in f){if(g=="length"){continue}if(k.check(true,f[g][h])){return"on"}}if(k.check(true,f[h])){return"on"}return"off"},setActiveFlag4Fleet:function(g,k){var f=ogame.messages.combatreport;var h=f.getAllShipClasses(g);$.each(h,function(c,s){var p=f.getShipIdByClass(s);var r=f.isActive(p,k);var q=f.getShipSelectors(p);f.changeShipState(r,q.ship);if(r=="off"){var a=q.shipCount;var b=q.loss;var d={ships:{},losses:{}};d.ships[a]=0;d.losses[b]="";f.setShipCount(d)}f.toggleShipShowState(q.ship)})},search4Class:function(f,h){for(var g in f){if($("."+f[g]+h)[0]){var k=f[g]+h;return k}}return false},getShipSelectors:function(l){var n=ogame.messages.combatreport;var s=["military","civil","defense"];var o=n.search4Class(s,l);var q="."+n.data.combatside+" ."+o;var p="."+n.data.combatside+" ."+o+" .ecke";var r="."+n.data.combatside+" ."+o+" .lost_ships";var m={ship:q,shipCount:p,loss:r};return m},getShipIdByClass:function(g){var f=g.length;var d=g.substr(f-3);return d},changeShipState:function(c,d){if($(d).hasClass("off")&&c!="off"){$(d).removeClass("off")}if($(d).hasClass("on")&&c!="on"){$(d).removeClass("on")}if(!$(d).hasClass(c)){$(d).addClass(c)}},toggleShipShowState:function(b){if($(b).hasClass("off")){$(b).parent().hide()}if($(b).hasClass("on")){$(b).parent().show()}},getShipsByMembers:function(g){var d=ogame.messages.combatreport;var f=[];if(!d.check(true,d.data.combatArray.shipDetails)){$.each(d.data.combatArray,function(b,a){if(typeof a=="object"&&typeof a.shipDetails!="undefined"){if(typeof f[a.ownerName]!="undefined"){$.extend(f[a.ownerName],a.shipDetails)}else{f[a.ownerName]=a.shipDetails}}else{if(typeof f[a.ownerName]=="undefined"){f[a.ownerName]={}}}})}else{if(typeof f[d.data.combatArray.ownerName]!="undefined"){$.extend(f[d.data.combatArray.ownerName],d.data.combatArray.shipDetails)}else{f[d.data.combatArray.ownerName]=d.data.combatArray.shipDetails}}if(g=="all"){return f}else{return f[g]}},getShipsByMembersAndCoords:function(k,m,g){var l=ogame.messages.combatreport;var h=[];if(!l.check(true,l.data.combatArray.shipDetails)){$.each(l.data.combatArray,function(b,a){if(m!==0){if(typeof a=="object"&&typeof a.shipDetails!="undefined"){if(a.ownerCoordinates===m&&a.ownerName==k&&a.ownerPlanetType==g){if(typeof h[a.ownerName]!="undefined"){$.extend(h[a.ownerName],a.shipDetails)}else{h[a.ownerName]=a.shipDetails}}}}else{if(typeof a=="object"&&typeof a.shipDetails!="undefined"){if(typeof h[a.ownerName]!="undefined"){$.extend(h[a.ownerName],a.shipDetails)}else{h[a.ownerName]=a.shipDetails}}}})}else{if(typeof h[l.data.combatArray.ownerName]!="undefined"){$.extend(h[l.data.combatArray.ownerName],l.data.combatArray.shipDetails)}else{h[l.data.combatArray.ownerName]=l.data.combatArray.shipDetails}}if(k=="all"){return h}else{return h[k]}},getShipCountArray:function(p,v){var r=ogame.messages.combatreport;var A=r.check(true,v,{types:{0:"isEmpty"}})?false:true;var q={};var s={};for(var o in p){var w=r.getShipSelectors(o);var x=w.shipCount;q[x]=parseInt(p[o]);if(!A){var u=w.loss;if(r.check(true,v[o])){s[u]=parseInt(v[o])}}}var y={ships:q,losses:s};return y},setShipCount4All:function(v){var x=ogame.messages.combatreport;var w=v.ships;var B=x.check(true,v.losses)?v.losses:{};var I={};for(var A in w){var G=w[A];var u=(x.check(true,B,{types:{0:"isEmpty"}})&&x.check(true,B[A]))?B[A]:{};I[A]=x.getShipCountArray(G,u)}var C={};var F={};for(var y in I){var H=I[y]["ships"];var D=I[y]["losses"];for(var E in H){if(x.check(true,C[E])){C[E]=C[E]+H[E]}else{C[E]=H[E]}}for(var E in D){if(x.check(true,F[E])){F[E]=F[E]+D[E]}else{F[E]=D[E]}}}var s={ships:C,losses:F};x.setShipCount(s)},setShipCountByActiveMember:function(u,x,C,v,r){v=v||0;r=r||1;var w=ogame.messages.combatreport;var F={};var G={};for(var E in x){var s=x[E]["ownerName"];var D=x[E]["ownerCoordinates"];var B=x[E]["ownerPlanetType"];if(s==C){for(var y in u.ships[E]){if(v!==0){if(v==D&&r==B){if(!(F.hasOwnProperty(y))){F[y]=u.ships[E][y]}else{F[y]=F[y]+u.ships[E][y]}}}else{if(!(F.hasOwnProperty(y))){F[y]=u.ships[E][y]}else{F[y]=F[y]+u.ships[E][y]}}}if(w.check(true,u.losses)){for(var y in u.losses[E]){if(v!==0){if(v==D&&r==B){if(!(G.hasOwnProperty(y))){G[y]=parseInt(u.losses[E][y])}else{G[y]=G[y]+parseInt(u.losses[E][y])}}}else{if(!(G.hasOwnProperty(y))){G[y]=parseInt(u.losses[E][y])}else{G[y]=G[y]+parseInt(u.losses[E][y])}}}}}}if(w.check(true,F,{types:{0:"isEmpty"}})){var A=w.getShipCountArray(F,G);w.setShipCount(A)}},setShipCount:function(l){var k=ogame.messages.combatreport.data.combatside;var g=l.ships;var m=l.losses;if(!$.isEmptyObject(g)){for(var h in g){$(h).text(g[h].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))}}else{$("."+k+" .ecke").text("0")}if(!$.isEmptyObject(m)){for(var h in m){$(h).text("-"+m[h].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))}}else{$("."+k+" .lost_ships").text("-")}},getAllShipClasses:function(f){var g=f.map(function(){var a=$(this).attr("class");return a}).get().join();var d=[];$.each(g.split(","),function(b,a){var c=a.split(" ");d.push(c[1])});return d},displayShipData:function(l,m,n,q,p,k){p=typeof p!=="undefined"?p:0;var o=ogame.messages.combatreport;if(o.check(true,l,{values:{isNot:{0:"all"}}})){o.setShipCountByActiveMember(n,q,l,p,k)}else{o.setShipCount4All(o.data.combatRounds[m][o.data.combatRounds[m].length-1])}},initCombatText:function(g){var d=ogame.messages.combatreport;var f=g.combatRounds.length-1;$(".combat_round_list .round_id").find("a").removeClass("active");$(".combat_round_list .round_id[data-round="+f+"]").find("a").addClass("active");d.loadDataBySelectedRound(g.attackerJSON,g.defenderJSON,f)},setCombatText:function(v,G,K){var x=ogame.messages.combatreport;var A=".statistic_attacker";var u=".statistic_defender";var C=".hits";var I=".strength";var E=".absorbed";var J=0;var B=0;var H=0;var F=0;var w=0;var D=0;if(x.check(true,v,{length:K})){for(var y in v){J=J+parseInt(v[y]["statistic"]["hits"]);B=B+parseInt(v[y]["statistic"]["absorbedDamage"]);H=H+parseInt(v[y]["statistic"]["fullStrength"]);F=F+parseInt(G[y]["statistic"]["hits"]);w=w+parseInt(G[y]["statistic"]["absorbedDamage"]);D=D+parseInt(G[y]["statistic"]["fullStrength"])}}else{J=parseInt(v[K]["statistic"]["hits"]);B=parseInt(v[K]["statistic"]["absorbedDamage"]);H=parseInt(v[K]["statistic"]["fullStrength"]);F=parseInt(G[K]["statistic"]["hits"]);w=parseInt(G[K]["statistic"]["absorbedDamage"]);D=parseInt(G[K]["statistic"]["fullStrength"])}$(A+C).text(J.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(A+E).text(B.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(A+I).text(H.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(u+C).text(F.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(u+E).text(w.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(u+I).text(D.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))},setCombatArray:function(g,h){var f=jQuery.extend(true,{},g);var k=ogame.messages.combatreport;k.data.combatside=h;k.data.memberSelection=false;if($("#"+k.data.combatside+"_select_combatreport").find(":selected").length>0){k.data.memberSelection=true}if(k.data.memberSelection){k.data.activeMember=""+$("#"+k.data.combatside+"_select_combatreport").find(":selected").val()}else{k.data.activeMember=""+$("#"+k.data.combatside+"_select_combatreport").data("memberName")}k.data.activeMember=k.data.activeMember.split("|",1)[0];k.data.combatArray=f.member;k.data.combatRounds=[];k.data.combatRounds[h]=f.combatRounds},setCombatside:function(c){var d=ogame.messages.combatreport;d.data.combatside=c},check:function(N,O,Q){var Q=(Q!=null&&typeof Q!="undefined"&&typeof Q=="object")?Q:false;var G=false;var E=0;var C=0;var J=0;var K=0;var D=false;if(Q!=false){var L=Q.values!=null&&typeof Q.values!="undefined"&&typeof Q.values=="object"?Q.values:{};var A=Q.types!=null&&typeof Q.types!="undefined"&&typeof Q.types=="object"?Q.types:{};var y=Q.length!=null&&typeof Q.length!="undefined"?Q.length:false;if(!jQuery.isEmptyObject(L)){for(H in L){var P=L[H];if(H=="is"&&!jQuery.isEmptyObject(P)){for(var B in P){if(O!=P[B]){E=E+1}}}if(H=="isNot"&&!jQuery.isEmptyObject(P)){for(var I in P){if(O==P[I]){E=E+1}}}}}if(!jQuery.isEmptyObject(A)){if(A.isEmpty){if(jQuery.isEmptyObject(O)){C=C+1}}for(var H in A){if(typeof O==A[H]){C=C+1}}}if(typeof O=="object"){for(var H in O){if(typeof O[H]!="undefined"){K=K+1}}}else{var M=O+"";K=M.length}if(y!==false&&typeof y=="number"&&typeof K=="number"){if(K!=y){J=J+1}D=true}}if(typeof O=="undefined"||O==null){C=C+1}var x=E+C;if(D!=false){x=x+J}if(x==0){G=true}var F={success:G,allErrors:x,valueErrors:E,typeErrors:C,type:typeof O,length:K,lengthChecked:D,lengthError:J};if(N){return G}else{return F}},loadData:function(f,g){var d=ogame.messages.combatreport;d.setCombatArray(f,g);d.loadDataBySelectedCombatMember(f,g);d.setCombatValue()},loadDataBySelectedRound:function(E,F,B){var A=ogame.messages.combatreport;var D=parseInt(B);var K=$(".attacker .participant_select option:selected").val();var G=$(".defender .participant_select option:selected").val();var J=$(".attacker .participant_select option:selected").data("coords");var L=$(".defender .participant_select option:selected").data("coords");var I=[];var H=[];if(typeof J!="undefined"){ids=K.split("|")[1].split(":");I.push(ids);K=K.split("|")[0]}else{if(K!="all"&&typeof K!="undefined"){J=0;$(".attacker .participant_select option").each(function(){if(K==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){I.push($(this).val().split("|")[1].split(":"))}})}else{I=[]}}if(typeof L!="undefined"){ids=G.split("|")[1].split(":");H.push(ids);G=G.split("|")[0]}else{if(G!="all"&&typeof G!="undefined"){L=0;$(".defender .participant_select option").each(function(){if(G==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){H.push($(this).val().split("|")[1].split(":"))}})}else{H=[]}}if(I.length>0){for(var x in E){if(x=="combatRounds"){for(var y in E[x][D]){if(y=="ships"){for(var M in E[x][D][y]){var C=$.inArray(M,I[0]);if(C==-1){delete E[x][D][y][M]}}}}}}}if(H.length>0){for(var x in F){if(x=="combatRounds"){for(var y in F[x][D]){if(y=="ships"){for(var M in F[x][D][y]){var C=$.inArray(M,H[0]);if(C==-1){delete F[x][D][y][M]}}}}}}}var w=E.combatRounds;var v=F.combatRounds;if(A.check(true,w,{length:B})){D=D-1}D=D+"";A.setCombatside("attacker");A.setShipCount4All(w[D]);A.setCombatside("defender");A.setShipCount4All(v[D]);if(A.data.memberSelection){}A.setCombatText(w,v,B)},resetDropDowns:function(){$("#attacker_select_combatreport").val("all").ogameDropDown("refresh");$("#defender_select_combatreport").val("all").ogameDropDown("refresh")},loadDataBySelectedCombatMember:function(v,r,o,m){var n=jQuery.extend(true,{},v);o=o||0;m=m||1;var q=ogame.messages.combatreport;q.setCombatArray(n,r);var p=$("."+q.data.combatside+" .buildingimg");var s=$("."+q.data.combatside+" .defenseimg");p=$.merge(p,s);var u=q.getShipsByMembersAndCoords(q.data.activeMember,o,m);q.setActiveFlag4Fleet(p,u);q.displayShipData(q.data.activeMember,q.data.combatside,n.combatRounds[n.combatRounds.length-1],n.member,o,m);q.setCombatValue()}};var currentMovementTabExtensionStates=[];function closeDetails(g,d){var f=$("#fleet"+g);f.children(".openDetails").children().children().attr("src","//gf2.geo.gfsrv.net/cdn10/de1e5f629d9e47d283488eee0c0ede.gif");f.children(".quantity").show();f.removeClass("detailsOpened");f.addClass("detailsClosed");currentMovementTabExtensionStates[g]=[0,d];updateCookieStatus(currentMovementTabExtensionStates)}function openDetails(g,d){var f=$("#fleet"+g);f.children(".openDetails").children().children().attr("src","//gf3.geo.gfsrv.net/cdnb6/577565fadab7780b0997a76d0dca9b.gif");f.children(".quantity").hide();f.removeClass("detailsClosed");f.addClass("detailsOpened");currentMovementTabExtensionStates[g]=[1,d];updateCookieStatus(currentMovementTabExtensionStates)}function updateCookieStatus(d){var f=JSON.stringify(d);var g=JSON.stringify({expires:Math.round(new Date().getTime()/1000)+7*86400});$.cookie("tabBoxFleets",f,g)}function openCloseDetails(c,d){if($("#fleet"+c).attr("class")=="fleetDetails detailsOpened"){closeDetails(c,d)}else{openDetails(c,d)}}function initMovement(){initToggleHeader("movement");if(b==undefined){var b=0}$("a.openCloseDetails").click(function(){openCloseDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))});$(".closeAll").click(function(){if(b==0){b=1;$(".closeAll").children().removeClass("all_open").addClass("all_closed")}else{b=0;$(".closeAll").children().removeClass("all_closed").addClass("all_open")}$("a.openCloseDetails").each(function(){if(b===1){closeDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))}else{if(b===0){openDetails($(this).attr("data-mission-id"),$(this).attr("data-end-time"))}}})});timerHandler.appendCallback(function(){})}function addUserToUnion(){$("#participantselect").append($("#buddyselect").find("li.ui-selected"))}function removeUserFromUnion(){$("#buddyselect").append($("#participantselect").find("li.ui-selected"))}function addUserToUnionByForm(){var d=$("#unionUserSearch").find('[name="addtogroup"]');var g=d.val();var f=$("#participantselect");if(f.find('li[ref="'+g+'"]').length==0){f.append($(document.createElement("li")).attr("ref",g).text(g))}d.val("")}function setUnionUsers(){var b="";$("#participantselect").find("li").each(function(){b+=$(this).attr("ref")+";"});b=b.substring(0,b.length-1);$("#unionUsers").val(b)}function unionUser(d){var c=$.parseJSON(d);if(c.status){addUserToUnionByForm()}else{errorBoxAsArray(c.errorbox)}}function initFederationLayer(){$("#switch").click(function(){var b=$("#searchFed");b.find("> .wrap").toggle();b.find("> #honorWarning").toggle()});$("#buddyselect, #participantselect").selectable({filter:"li:not(.undermark)"});$(document).undelegate("ul#buddyselect li","dblclick").delegate("ul#buddyselect li","dblclick",function(){addUserToUnion()}).undelegate("ul#participantselect li","dblclick").delegate("ul#participantselect li","dblclick",function(){removeUserFromUnion()})}function submit_unionform(){setUnionUsers();ajaxFormSubmit("unionform",$("form#unionform").attr("action"),unionEdit)}function recallShipCountdown(g,k){var h=this;var f=$(".reversal_time[ref='"+g+"']");if(isMobile&&f.length){this.updateCountdown=function(){var b=h.countdown.getLeftoverTime();var a=getFormatedDate(new Date(b*1000+timeDiff),"[d].[m].[Y] [H]:[i]:[s]");f.html(a)};h.countdown=new countdown(k,3,2);h.timer=timerHandler.appendCallback(h.updateCountdown);h.updateCountdown()}}function initNotesForm(){$("select").ogameDropDown();$("#createNote .text").trigger("keyup");if($("#popupContent").length){initNotes()}}function initNotes(){$("select").ogameDropDown();function c(a){var b=false;$(a).find(":input").each(function(){if(typeof($(this).data("value"))!="undefined"){if($(this).data("value")!=$(this).val()){b=true}}});return b}var d=$(".overlayDiv.notices");d.find(".openOverlay").unbind("click").bind("click",function(){var b=$(this).attr("data-overlay-class");var g={title:$(this).attr("data-title"),close:function(){var f=$("."+b);if(c(f.find("form"))){errorBoxDecision(LocalizationStrings.question,locaNotes.changesNotSaved+"<br/><br/>"+locaNotes.questionSaveChanges,LocalizationStrings.yes,LocalizationStrings.no,function(){f.find("form").trigger("submit");f.remove()},function(){f.remove()},true)}else{f.remove()}},"class":b};openOverlay($(this).attr("href"),g);if(b.indexOf("newNote-")===0){var a=parseInt(b.replace(/^newNote-/,""))+1;$(this).attr("data-overlay-class","newNote-"+a)}return false});$(document).undelegate("#noteList form","submit").delegate("#noteList form","submit",function(){$.post($("#noteList").attr("rel"),$(this).serialize(),function(a){d.html(a)})}).undelegate("#createNote form [type=submit]","click").delegate("#createNote form [type=submit]","click",function(a){a.preventDefault();$(this).parents("form").submit()}).undelegate("#createNote form","submit").delegate("#createNote form","submit",function(a){a.preventDefault();var b=$(this);$.ajax({url:$(this).attr("rel"),type:"post",data:b.serialize(),dataType:"json",error:function(){fadeBox(LocalizationStrings.error,true)},success:function(g){if(g.error!=null){fadeBox(g.error,true)}else{if($("#popupContent").length){$(window).unbind("beforeunload.checkChanges");location.href=b.attr("rel")+"&popup=1"}else{if(b.parents(".overlayDiv").is(":visible")){b.parents(".overlayDiv").dialog("option","close",function(){$(this).remove()}).dialog("close")}if(g.success!=null){fadeBox(g.success,false)}d.load(d.find("#noteList").attr("rel"))}}}});return false}).undelegate("#createNote .textBox","keyup touchstart change").delegate("#createNote .textBox","keyup touchstart change",function(){var a=$(this).val().length;var g=$(this).attr("data-max-length");if(a>g){var b=$(this).getSelection();$(this).val($(this).val().substr(0,g));a=g;$(this).setSelection(b)}$(this).parents("form").find(".cntChars").text(a)});$(window).unbind("beforeunload.checkChanges").bind("beforeunload.checkChanges",function(){var a=false;$("#createNote form").each(function(){if(c(this)){a=true}});if(a){return locaNotes.changesNotSaved}})}function scrollToTopOfDialog(b){$("html, body").stop().animate({scrollTop:Math.max(0,b.offset().top-300)},200)}function openOverlay(O,G){if(typeof(openOverlay.index)=="undefined"){openOverlay.index=0}else{openOverlay.index++}var U=openOverlay.index;var G=G||{};if((typeof(G.type)=="undefined"||G.type!="inline")&&!O.match(new RegExp("^("+ogameUrl+"|"+startpageUrl+")"))){window.open("redir.php?url="+encodeURIComponent(O),"_newtab");return}if(typeof(G.height)=="undefined"){G.height="auto"}if(typeof(G.width)=="undefined"){G.width="auto"}if(typeof(G.position)=="undefined"){if(isMobile&&!isMobileApp){G.position={my:"top",at:"top"}}else{G.position={my:"center",at:"center"}}}G.closeText="";if($(".overlayDiv").length&&!isMobile){var L=$(".overlayDiv:last");var N=L.offset();G.position={my:"left top",at:"left+"+(N.left+10)+" top+"+(N.top+10)}}function B(b){var a=b.parent(".ui-dialog");if(a.length){a.css("top",Math.max(0,parseInt(a.css("top").replace(/px$/,"")))).css("left",Math.max(0,parseInt(a.css("left").replace(/px$/,""))))}}var R=G.type;delete G.type;if(R!="inline"){var Q=$(document.createElement("img")).attr("src","//gf1.geo.gfsrv.net/cdnc6/4161a64a933a5345d00cb9fdaa25c7.gif").attr("alt",LocalizationStrings.loading);var M=$(document.createElement("div")).css("text-align","center").css("margin-top","20px").append(Q);var C=$(document.createElement("div")).addClass("overlayDiv").css("display","none").append(M).appendTo("body");var H=function(){C.find("select").ogameDropDown("destroy");C.remove();Tipped.hideAll()};switch(typeof(G.close)){case"function":break;case"string":var J=G.close.split(" ");G.close=function(){$.each(J,function(b,a){if(a=="__default"){H()}else{window[a]()}})};break;default:G.close=H;break}}if(typeof(O)=="string"){var S=$.deparam($.param.querystring(O));if(typeof(S.page)!="undefined"){C.attr("data-page",S.page)}if(!isMobile&&$.inArray(S.page,popupWindows)!=-1){var K=Math.max(0,Math.floor($(window).height()/2-G.popupHeight/2));var P=Math.max(0,Math.floor($(window).width()/2-G.popupWidth/2));var V=window.open(O+"&popup=1",S.page,"width="+G.popupWidth+",height="+G.popupHeight+",scrollbars=yes,resizable=yes,top="+K+",left="+P);C.remove();V.focus();return}}if(typeof(G["class"])!="undefined"){var T=G["class"].split(" ").join(".");if($(".overlayDiv."+T).length){$.get(O,{},function(a){$(".overlayDiv."+G["class"]).empty().append(a).dialog("moveToTop")});C.remove();C=$(".overlayDiv."+T);if(typeof(S.page)!="undefined"){C.attr("data-page",S.page)}if(typeof(G.title)!="undefined"){C.dialog("option","title",G.title)}scrollToTopOfDialog(C);return true}else{C.addClass(G["class"])}}if(R=="inline"){C=$(O)}if(isNaN(G.dragStart)&&isNaN(G.dragStop)){var D;G.dragStart=function(){$("html").data("noclick",true);C.dialog("option","width",C.width()).dialog("option","height",C.height());D={bg:C.css("background"),image:C.css("background-image"),x:C.css("background-position-x"),y:C.css("background-position-y"),position:C.css("background-position")};C.find("select").ogameDropDown("hide");C.children().hide();var c=C.find(".markItUpDropMenu[id]");for(var d=0;d<c.length;++d){var f=$("body>ul[rel="+c[d].id+"]");var b=(typeof f.attr("old_left")=="undefined"?-18:0);var a=(typeof f.attr("old_left")=="undefined"?-6:0);f.attr("old_top",C.offset()["top"]+b).attr("old_left",C.offset()["left"]+a).hide()}C.css("background","#000000")};G.dragStop=function(){setTimeout(function(){$("html").data("noclick",false)},100);if(typeof(C.bg)=="undefined"||C.bg.length==0){C.css("background-image",D.image);if(typeof(D.position)=="undefined"||D.position.length==0){C.css("background-position-x",D.x).css("background-position-y",D.y)}else{C.css("background-position",D.position)}}else{C.css("background",D.bg)}C.children().show();var b=C.find(".markItUpDropMenu[id]");for(var c=0;c<b.length;++c){var a=$("body>ul[rel="+b[c].id+"]");a.css({top:(parseInt(a.css("top"))-a.attr("old_top")+C.offset()["top"])+"px",left:(parseInt(a.css("left"))-a.attr("old_left")+C.offset()["left"])+"px"});if($(b[c]).attr("data-opened")==1){a.show()}}C.dialog("option","width",G.width).dialog("option","height",G.height);B(C)}}if(isNaN(G.resizable)){G.resizable=false}if(isMobile){G.draggable=false}if(G.modal){G.open=function(){$(".ui-widget-overlay").css("height","").css("width","")}}switch(R){case"iframe":var E=overlayWidth;var I=overlayHeight;if(typeof(G.iframeWidth)!="undefined"){E=G.iframeWidth;delete G.iframeWidth}if(typeof(G.iframeHeight)!="undefined"){I=G.iframeHeight;delete G.iframeHeight}C.html("<iframe allowTransparency='true'frameborder='0' hspace='0' src='"+O+"' id='TB_iframeContent' name='TB_iframeContent"+Math.round(Math.random()*1000)+"' style='width:"+(E+25)+"px;height:"+(I+1)+"px;' ></iframe>").dialog(G).dialog("moveToTop");B(C);break;case"inline":var F=$(O);var W=F.parent();F.addClass("overlayDiv").dialog(G).dialog("moveToTop");B(F);break;default:C.dialog(G).dialog("moveToTop");$.get(O,{}).done(function(a){C.empty().append(a).dialog("option","position",C.dialog("option","position"));setTimeout(function(){C.dialog("option","position",C.dialog("option","position"));B(C)},100);$(document).trigger("ajaxShowOverlay")}).fail(function(){})}Tipped.hideAll();$("select").ogameDropDown("hide");if(!isMobile){$(window).bind("resize.overlay"+U,function(){if(C.is(":data(dialog)")){C.dialog("option","position",C.dialog("option","position"));B(C)}else{$(window).unbind("resize.overlay"+U)}})}}function isOverlayOpen(){return $(".overlayDiv").length>0}function initOverlays(){$(document).undelegate("a.overlay","click").delegate("a.overlay","click",function(l){l.preventDefault();var g=$(this).attr("href");if($(this).data("overlay-same")){var k=$(this).parents(".ui-dialog");var m=k.find(".overlayDiv");if($(this).data("overlay-same")&&m.length>0){$.get(g,{},function(a){removeTooltip(m.find(getTooltipSelector()));m.empty().append(a).dialog("moveToTop");k.hide();k.show()});return false}}var h={zIndex:4000};if($(this).data("overlay-title")){h.title=$(this).data("overlay-title")}else{if(typeof($(this).attr("title"))!="undefined"&&$(this).attr("title").length){h.title=$(this).attr("title")}else{if($(this).data("tipped_restore_title")){h.title=$(this).data("tipped_restore_title").replace(/^.+\|/,"")}}}if($(this).data("overlay-class")){h["class"]=$(this).data("overlay-class")}if($(this).data("overlay-width")){h.width=$(this).data("overlay-width")}if($(this).data("overlay-height")){h.height=$(this).data("overlay-height")}if($(this).data("overlay-popup-width")){h.popupWidth=$(this).data("overlay-popup-width")}if($(this).data("overlay-popup-height")){h.popupHeight=$(this).data("overlay-popup-height")}if($(this).data("overlay-modal")){h.modal=$(this).data("overlay-modal");h.resizable=false;h.draggable=false}if($(this).data("overlay-iframe")){h.type="iframe";if($(this).data("iframe-width")){h.iframeWidth=$(this).data("iframe-width")}if($(this).data("iframe-height")){h.iframeHeight=$(this).data("iframe-height")}}else{if($(this).data("overlay-inline")){h.type="inline";g=$(this).data("overlay-inline")}}if($(this).data("overlay-close")){h.close=$(this).data("overlay-close")}openOverlay(g,h);return false})}function initOverview(){$(".cancelMove").click(function(){var c=$(this);var d=window.location;errorBoxDecision(planetMoveLoca.askTitle,planetMoveLoca.askCancel,planetMoveLoca.yes,planetMoveLoca.no,function(){$.ajax({method:"get",url:c.attr("rel"),dataType:"json",cache:false,success:function(a){if(a.error.length>0){fadeBox(a.error,true)}else{location.href=getRedirectLink()}},error:function(){fadeBox(planetMoveLoca.error,true)}})})});$(document).undelegate("#planetMaintenanceDelete","submit").delegate("#planetMaintenanceDelete","submit",function(b){b.preventDefault();ajaxFormSubmit("planetMaintenanceDelete",$(this).attr("action"),planetGivenup)}).undelegate("#abandonplanet #block","click").delegate("#abandonplanet #block","click",function(c){c.preventDefault();if(isMobileOnly||isFacebookUser){var d=$("#giveupHeadline").attr("rel")==3?loca.moonGiveupQuestion:loca.planetGiveupQuestion;d=d.replace("%planetName%",$("#giveupName").text()).replace("%planetCoordinates%",$("#giveupCoordinates").text());errorBoxDecision($("#giveupHeadline").text(),d,LocalizationStrings.yes,LocalizationStrings.no,function(){$("#planetMaintenanceDelete").submit()})}else{show_hide_menus("#validate");show_hide_menus("#giveUpNotification")}}).undelegate(".openPlanetRenameGiveupBox","click").delegate(".openPlanetRenameGiveupBox","click",function(b){b.stopPropagation();openPlanetRenameGiveupBox()})}function clearField(){currentValue=$("#planetName").val();if(defaultName==currentValue){clearInput("#planetName")}}function fillField(){currentValue=$("#planetName").val();if(currentValue==""){$("#planetName").val(defaultName)}}function openBuddyOverlay(d,c){openOverlay(d,{"class":"buddies",title:c})}function planetGivenup(b){var b=$.parseJSON(b);errorBoxAsArray(b.errorbox);if(typeof(b.newToken)=="string"){$("#planetMaintenanceDelete input[name='token']").val(b.newToken)}if(typeof(b.password_checked)!="undefined"&&b.password_checked){$("#planetMaintenanceDelete").attr("action",b.intend)}}function initPreferences(){$(".category").click(function(){document.prefs.reset()});$("div.wrap > div.group").hide();$("div.wrap > div.group:first,div.wrap:eq(1) > div.group:eq(0),div.wrap:eq(2) > div.group:eq(0),div.wrap:eq(3) > div.group:eq(0)").show();$("div.wrap > div.bar").click(function(){$(this).next("div.group:hidden").slideDown("fast",function(){Tipped.show($(":input:visible"))}).siblings("div.group:visible").slideUp("fast",function(){Tipped.hide($(":input:not(:visible)"))});$(".formError").validationEngine("closePrompt")});$(".content .bar").hover(function(){$(this).addClass("bar-hover")},function(){$(this).removeClass("bar-hover")});$("#newpass1").bind("keyup",function(){var v=$(this).val();var F=v.length;var x=v.match(/[^A-Za-z\d]/);var y=v.match(/\d/);var u=v.match(/[a-z]/)&&v.match(/[A-Z]/);var E=0;var r=4;var w={length:false,"mixed-case":false,"special-chars":false,numbers:false};if(F>=passwordMinLength&&F<=passwordMaxLength){w.length=true;E++}if(u){w["mixed-case"]=true;E++}if(y){w.numbers=true;E++}if(x){w["special-chars"]=true;E++}for(var G in w){var A=w[G];var B=$("#password-meter-status-"+G);B.find("img.status-checked").css("visibility",A?"visible":"hidden")}var D=Math.floor(E/r*2);var s=new Array("low","medium","high");for(var C in s){if(C!=D){$("#password-meter-rating-"+s[C]).removeClass("arrow")}else{$("#password-meter-rating-"+s[C]).addClass("arrow")}}});$(".contentzs").tabs({beforeActivate:function(d,c){$("input#selectedTab").val($(c.tab).parent().prevAll().length)},activate:function(){Tipped.hide($("input:not(:visible)"));Tipped.show($("input:visible"))},active:selectedTab});$("#sortSetting").unbind("change").bind("change",function(){var d="settings_order";if($(this).val()==customSorting){var f=$("#sortOrder");f.attr("disabled","disabled").attr("name","");$("#sortOrderHidden").attr("name",d).val(f.val());$("#sortOrder").next(".dropdown").addClass("disabled")}else{$("#sortOrder").next(".dropdown").removeClass("disabled");var g=$("#sortOrderHidden");g.attr("name","");$("#sortOrder").removeClass("disabled").attr("name",d).removeAttr("disabled").val(g.val())}}).trigger("change");if(moveInProgress){$("form#prefs").on("submit",function(c){var d=$(this);if(d.find("input#urlaubs_modus.notOnVacation:checked").length){errorBoxDecision(LocalizationStrings.attention,preferenceLoca.planetMoveQuestion,LocalizationStrings.yes,LocalizationStrings.no,function(){d.off("submit").submit()});c.preventDefault();return false}})}if(isMobileOnly){$("#prefs").bind("submit",function(){var b=$(this);if(!b.data("asking")&&$("#db_character",b).val().length){b.data("asking",true);errorBoxDecision(preferenceLoca.changeNameTitle,preferenceLoca.changeNameQuestion.replace("%newName%",$("#db_character",b).val()),LocalizationStrings.yes,LocalizationStrings.no,function(){b.submit();b.data("asking",false)},function(){b.data("asking",false)});return false}})}if(tabsDisabled){$(".contentzs").tabs("option","disabled",[1,2]);$("#tabGeneral, #tabRepresentation").attr("title",preferenceLoca.tabDisabled).attr("class","tooltip")}$("div.wrap:visible > div.bar:eq("+openGroup+")").click()}function display_info(b){if(document.getElementById("infoInput").innerHTML==""||document.getElementById("infoInput").innerHTML!=get_displayText(b)){document.getElementById("infoInput").innerHTML=get_displayText(b)}}function display_error(b){if(document.getElementById("errorInput").innerHTML==""||document.getElementById("errorInput").innerHTML!=get_errorText(b)){document.getElementById("errorInput").innerHTML=get_errorText(b);document.getElementById("error").style.display="block"}}function hide_error(b){document.getElementById("errorInput").innerHTML="";document.getElementById("error").style.display="none"}function checkUsername(){var b=document.forms["new"].elements.username.value;if(b.length<3||b.length>=20){display_error("username")}else{hide_error()}}function checkEmail(){var b=document.forms["new"].elements.email.value;validate=b.match(/[a-zA-Z0-9]+@+[a-zA-Z0-9]+[.]+[a-zA-Z0-9]{2,4}/);if(b.length<3||b.length>=64||!validate){display_error("email")}else{hide_error()}}var TECHID_REPAIR_DOCK=36;var burnUpCountDownForStationScreen={};var repairTimeDownForStationScreen={};function displayBurnUpEnquiry(){var b=$("input.burnUpButton");errorBoxDecision(b.data("loca_box_text"),b.data("loca_decision_text"),b.data("loca_yes"),b.data("loca_no"),function(){$.ajax({url:b.data("url"),success:function(a){var d=jQuery.parseJSON(a);if(d.success){fadeBox(d.reason,false,function(){});redirectSpaceDock()}else{fadeBox(d.reason,true,function(){})}}})},function(){})}function startWreckFieldRepairs(){var b=$("input.startRepairsButton");$.ajax({url:b.data("url"),success:function(a){var d=jQuery.parseJSON(a);if(d.success){fadeBox(d.reason,false,function(){});redirectSpaceDock()}else{fadeBox(d.reason,true,function(){})}}})}function reCommissionShips(){var b=$("input.reCommissionButton");$.ajax({url:b.data("url"),success:function(a){var d=jQuery.parseJSON(a);if(d.success){fadeBox(d.reason,false,function(){});redirectSpaceDock()}else{fadeBox(d.reason,true,function(){})}}})}function registerBurnUpCountDown(f){var g=$(f);var d=$(f).data("duration");if(d>0){if(!burnUpCountDownForStationScreen[f]){burnUpCountDownForStationScreen[f]=new simpleCountdown(g,d,function(){location.reload()})}}}function registerRepairTimeCountDown(f){var d=$(f);var g=$(f).data("duration");if(g>0){if(!repairTimeDownForStationScreen[f]){repairTimeDownForStationScreen[f]=new simpleCountdown(d,g,function(){location.reload()})}}}$(document).on("click","input.burnUpButton",displayBurnUpEnquiry);$(document).on("click","input.startRepairsButton",startWreckFieldRepairs);$(document).on("click","input.reCommissionButton",reCommissionShips);$(document).on("ajaxShowElement",function(d,c){if(c==TECHID_REPAIR_DOCK){registerBurnUpCountDown("#burnUpCountDownForStationScreen");registerRepairTimeCountDown("#repairTimeCountDownForStationScreen")}});$(document).on("ajaxShowOverlay",function(b){registerBurnUpCountDown("#burnUpCountDownForRepairOverlay");registerRepairTimeCountDown("#repairTimeCountDownForRepairOverlay")});function resourceTicker(f){var g=this;g.config=f;g.htmlObj=document.getElementById(g.config.valueElem);var d=new Date();g.startTime=d.getTime();g.updateResource=function(){var a=new Date().getTime();nrResource=g.config.available+g.config.production*(a-g.startTime)/1000;nrResource=Math.max(0,Math.floor(nrResource));if(nrResource<g.config.available||nrResource>=g.config.available&&nrResource<g.config.limit){g.htmlObj.innerHTML=gfNumberGetHumanReadable(nrResource,isMobile);if(nrResource>=g.config.limit[1]){g.htmlObj.className="overmark"}else{if(nrResource>=g.config.limit*0.9&&nrResource<g.config.limit){g.htmlObj.className="middlemark"}else{if(nrResource<=g.config.limit*0.9){g.htmlObj.className=""}}}if(g.config.production<0&&nrResource==0||g.config.production==0){timerHandler.removeCallback(g.intervalObj)}}else{if(g.config.production>0&&nrResource>=g.config.available&&nrResource>=g.config.limit){nrResource=gfNumberGetHumanReadable(g.config.limit,isMobile);g.htmlObj.innerHTML=nrResource;g.htmlObj.className="overmark";timerHandler.removeCallback(g.intervalObj)}}};if(g.config.production>0&&g.config.available>=g.config.limit){return}if(g.config.production<=0&&g.config.available==0){return}g.intervalObj=timerHandler.appendCallback(g.updateResource)}function initResourceTrader(){$(".big_tabs").tabs({activate:hideTipsOnTabChange});$(".resource_link").on("click",onSelectResource);$(".btn_calltrader").on("click",callTrader)}function onSelectResource(g){var f=$(g.currentTarget);if(!f.hasClass("active")){$(".resource_link").removeClass("active");f.addClass("active");$(".btn_calltrader").attr("disabled",false).data("offerId",f.data("resourceId"));var d=$(".getNewTraderDiv");if(d.hasClass("hidden")&&!f.hasClass("oldTraderActive")||!d.hasClass("hidden")&&f.hasClass("oldTraderActive")){d.parent().children().toggleClass("hidden")}}}function showTradeNowButton(){if($("#callTrader").hasClass("traderActive")){$("#callTrader").show()}else{$("#callTrader").hide()}}function calcCosts(c,d){return Math.ceil(d*factor[offer_id]/factor[c])}function calcInputFromCosts(c,d){return Math.max(Math.floor(d/factor[offer_id]*factor[c]),0)}function setValue(c,d){if(offer_id==c){$("#"+c+"_value_label").html(number_format(d,0,loca.decimalPoint,loca.thousandsSeparator))}else{formatNumber("#"+c+"_value",d)}}function checkValue(b){setValue(b,Math.min(getValue($("#"+b+"_value").val()),Math.round(storage[b])));free_id=6-b-offer_id;offer_costs=calcCosts(free_id,getValue($("#"+free_id+"_value").val()));costs=calcCosts(b,getValue($("#"+b+"_value").val()));freeOfferCosts=Math.round(offer_amount-(offer_costs));if(costs>freeOfferCosts){setValue(b,calcInputFromCosts(b,freeOfferCosts));costs=calcCosts(b,getValue($("#"+b+"_value").val()))}offer_costs=offer_costs+costs;setValue(offer_id,offer_costs);document.getElementById(b+"_storage").innerHTML=number_format((storage[b]-getValue($("#"+b+"_value").val())),0,loca.decimalPoint,loca.thousandsSeparator)}function setMaxValue(b){setValue(b,storage[b]);checkValue(b)}function callTrader(k){if($(k.currentTarget).attr("disabled")=="disabled"){return}var h=$(k.currentTarget).data("offerId"),f=$(k.currentTarget).data("askOverwrite");if(typeof(f)=="undefined"){f=true}if(darkMatter<traderCosts){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return}function g(){if(!$(".call_trader_box .getNewTraderDiv").hasClass("hidden")){$(".call_trader_box").children().toggleClass("hidden")}$(".resource_list .resource_link").removeClass("oldTraderActive").filter(function(a){return $(this).data("resourceId")==h}).addClass("oldTraderActive");$("#callTrader").show().addClass("traderActive");$.post(traderCallLink,{offer_id:h,token:traderResourcesToken},function(a){a=$.parseJSON(a);traderResourcesToken=a.newToken;if(a.status=="1"){traderObj.reloadResources();$("#callTrader").addClass("traderActive").show();openOverlay(traderOverlayLink,{"class":"traderlayer"});var d=$("#activeTrader");var b="metal";var c=loca.traderResourceTitleMetal;switch(h){case 2:b="crystal";c=loca.traderResourceTitleCrystal;break;case 3:b="deut";c=loca.traderResourceTitleDeuterium;break}d.find(".left_content #material").attr("class",b);d.find("p.stimulus").html(c);d.show();$("#boxHeader, #boxFooter").show()}else{errorBoxAsArray(a.errorbox)}})}if(f&&$("#callTrader").is(":visible")){errorBoxDecision(loca.traderResourceNewQuestionHeadline,loca.traderResourceNewQuestion,LocalizationStrings.yes,LocalizationStrings.no,g)}else{g()}}function tradeDone(b){b=$.parseJSON(b);traderResourcesToken=b.newToken;if(b.status=="1"){$(".overlayDiv.traderlayer").dialog("close");$(".call_trader_box").children().toggleClass("hidden");traderObj.reloadResources();$("#callTrader").removeClass("traderActive").hide();$(".resource_link").removeClass("oldTraderActive active");$(".btn_calltrader").attr("disabled",true);$("#activeTrader").hide()}errorBoxAsArray(b.errorbox)}function closeSearch(){if(typeof(currentPage!="undefined")){if(currentPage=="fleet1"||currentPage=="fleet2"){$("a#continue").focus()}else{if(currentPage=="fleet3"){$("a#start").focus()}}}}inventoryObj={currentPage:null,currentItems:null,currentItem:null,currentCategory:null,initalizeSlider:function(R,N,P,T,O,am,ad,aj,S){if(inventoryObj.currentItems==R&&typeof(am)=="undefined"||am==false){return}inventoryObj.currentItems=R;O=O||"slideIn";ad=ad||"tooltipHTML js_hideTipOnMobile";if(typeof(aj)=="undefined"){aj=true}if(typeof(S)=="undefined"){S=true}$("#"+N+"Box").remove(".anythingSlider");var ah=[];var ag=0;for(var M in R){var W=R[M];if(typeof(W.hide)!="undefined"&&W.hide){continue}if(inventoryObj.currentPage=="shop"||inventoryObj.currentPage=="inventory"){var U=ag%inventoryObj.itemsPerSlide;ah[ag+(2*(U%3))-2*Math.floor(U/3)]=W}else{ah[ag]=W}ag++}var Q=0,aa=0,L=$('<ul id="'+N+'" />');for(var al=ah.length;aa<al;aa++){if(typeof(ah[aa])=="undefined"){K.append('<div class="item_img"><div class="empty border5px"></div></div>');continue}var W=ah[aa];if(aa%inventoryObj.itemsPerSlide==0){var K=$('<li class="slide_'+Q+'" />').appendTo(L);Q++}var ak,V,Z;if(inventoryObj.currentPage=="shop"){ak=getNumberFormatShort(W.costs,null)+" "+loca.currency[W.currency];V="price"}else{ak=getNumberFormatShort(W.amount);V="amount"}var Y;if(aj){Y=W.imageLarge+"-75x.png"}else{Y=W.imageLarge+"-100x.png"}var X;if(W.canBeActivated||W.canBeBoughtAndActivated){X="enabled"}else{X="disabled"}if(W.isReduced){Z='<div class="sale_badge '+X+'"></div>'}else{Z=""}var ae=(W.timeLeft!=null)?" js_is_active ":"";var af="";var ab=W.title;if(N.indexOf("js_activeItemSlider")!=-1){ab="";af=(W.timeLeft!=null)?'<span class="js_duration undermark" data-total-duration="'+W.totalTime+'">'+W.timeLeft+"</span>":""}var ac="";if(W.timeLeft!=null&&N.indexOf("js_activeItemSlider")!=-1){ac='<div class="pusher"></div>'}var ai="";if($.inArray(birthdayCategory,W.category)!=-1){ai='<div class="event_active_hint"></div>'}K.append('<div class="item_img r_'+W.rarity+'" style="background-image: url(/cdn/img/item-images/'+Y+');"><div class="item_img_box">'+ai+'<div class="activation '+X+ae+'"></div><a href="javascript:void(0);" tabindex="1" title="'+ab+'" class="detail_button '+ad+" "+O+'" ref="'+W.ref+'">'+Z+'<span class="ecke"><span class="level '+V+'">'+ak+"</span></span></a></div>"+af+ac+"</div>")}$("#"+N+"Box").prepend(L);if(aa%inventoryObj.itemsPerSlide!=0){for(var J=aa%inventoryObj.itemsPerSlide;J<inventoryObj.itemsPerSlide;J++){$("#"+N+" li:last").append('<div class="item_img"><div class="empty border5px"></div></div>')}}return mySlider=$("#"+N).anythingSlider({startStopped:true,buildStartStop:false,expand:true,resizeContents:false,theme:"default",infiniteSlides:false,autoPlay:false,easing:"swing",resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,hashTags:true,buildNavigation:S,onInitialized:function(f,l){if(isMobile){var k=1000,g=50,d=0,b=0,h="ontouchend" in document,a=(h)?"touchstart":"mousedown",c=(h)?"touchmove":"mousemove",m=(h)?"touchend":"mouseup";l.$window.bind(a,function(n){b=(new Date()).getTime();d=n.originalEvent.touches?n.originalEvent.touches[0].pageX:n.pageX}).bind(m,function(n){b=0;d=0}).bind(c,function(o){var n=o.originalEvent.touches?o.originalEvent.touches[0].pageX:o.pageX,p=(d===0)?0:Math.abs(n-d),q=(new Date()).getTime();if(b!==0&&q-b<k&&p>g){if(n<d){l.goForward()}if(n>d){l.goBack()}b=0;d=0}})}}})},initShop:function(){var b=this;$(window).unbind(".shop");$(document).undelegate(".slideIn","click.shop").delegate(".slideIn","click.shop",function(){if(b.currentItem==$(this).attr("ref")){b.currentItem=null;$.bbq.pushState({item:""})}else{b.currentItem=$(this).attr("ref");$.bbq.pushState({item:$(this).attr("ref")})}});$("button.to_shop").bind("click.shop",function(){$.bbq.pushState({page:"shop"})});$("button.to_inventory").bind("click.shop",function(){$.bbq.pushState({page:"inventory"})});$("button.buyResourcesLink").bind("click",function(){reload_page($(this).data("link"))});$(".to_shop, .to_inventory").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$(".categoryFilter li a").bind("click.shop",function(){$.bbq.pushState({category:$(this).attr("rel")})});$(window).unbind("hashchange.shop").bind("hashchange.shop",function(a){b.onHashChange($.deparam.fragment(a.fragment))});b.onHashChange($.deparam.fragment());inventoryObj.refreshResources()},onHashChange:function(m){if(typeof(m.page)=="undefined"){var k={page:"shop",category:$(".categoryFilter a:first").attr("rel")};if(typeof(m.item)!="undefined"&&m.item!=""){var l=inventoryObj.items_shop[m.item];if(l.category.length>0){k.category=l.category[l.category.length-1]}}$.bbq.pushState(k);return}var g=this.currentPage!=m.page;if(g){if(m.page=="inventory"){this.openInventory();$(".planetlink, .moonlink").fragment({page:m.inventory})}else{this.openShop();$(".planetlink, .moonlink").fragment({page:m.shop})}this.updateCategoryAmount()}if(typeof(m.category)=="undefined"){$.bbq.pushState({category:$(".categoryFilter a:first").attr("rel")});return}else{if(m.category!=this.currentCategory||g){this.changeCategory(m.category)}}if(typeof(m.item)=="undefined"||m.item==""&&this.currentItem!=null){$("#itemDetails a.close_details").click();$(".planetlink, .moonlink").fragment({item:""})}else{if(this.currentItem!=m.item){var h=$(".slideIn[ref='"+m.item+"']");if(h.length){h.click()}else{gfSlider.slideIn(getElementByIdWithCache("detail"),m.item)}$(".planetlink, .moonlink").fragment({item:m.item})}}},initShopDetails:function(){var c=this;var d=$.deparam.querystring().page;$(document).undelegate("#itemDetails .close_details","click").delegate("#itemDetails .close_details","click",function(){$("a.slideIn[ref="+$(this).attr("ref")+"]:first").click()}).undelegate("#itemDetails a.item.build-it","click").delegate("#itemDetails a.item.build-it","click",function(){$.ajax({url:$(this).attr("rel"),data:{ajax:1,token:buyToken},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true)},success:function(a){buyToken=a.newToken;if(a.error){fadeBox(a.message,true)}else{fadeBox(a.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(a.item)}}});return false}).undelegate("#itemDetails a.item.build-it_disabled.dm","click").delegate("#itemDetails a.item.build-it_disabled.dm","click",function(){errorBoxDecision(LocalizationStrings.error,loca.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){if($("a.dm_button").length>0){$("a.dm_button").click()}else{window.location.href=$("#darkmatter_box a").attr("href")}})}).undelegate("#itemDetails a.activateItem.build-it","click").delegate("#itemDetails a.activateItem.build-it","click",function(){var a=$(this);function b(){$.ajax({url:a.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:d},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(g){activateToken=g.newToken;if(g.error){fadeBox(g.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{if(g.message.reload){location.href=getRedirectLink();return}g=g.message;fadeBox(g.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(g.item)}}})}if(a.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,b)}else{b()}return false}).undelegate("#itemDetails a.buyAndActivate.build-it","click").delegate("#itemDetails a.buyAndActivate.build-it","click",function(){var a=$(this);function b(){$.ajax({url:a.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:d},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(g){activateToken=g.newToken;if(g.error){fadeBox(g.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{if(g.message.reload){location.href=getRedirectLink();return}g=g.message;fadeBox(g.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(g.item)}}})}if(a.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,b)}else{b()}return false})},refreshResources:function(){getAjaxResourcebox(function(b){$(".to_dark_matter .level").text(b.darkmatter.resources["actualFormat"])})},refreshItemData:function(f){var d=f.ref;changeTooltip($(".detail_button[ref='"+d+"']"),f.title);$(".detail_button[ref='"+d+"'] span.amount, #itemDetails[data-uuid='"+d+"'] span.amount").html(tsdpkt(f.amount));if(typeof(inventoryObj.items_inventory)!="undefined"){if(inventoryObj.items_inventory.length==0){inventoryObj.items_inventory={}}else{if(f.amount<=0){delete inventoryObj.items_inventory[d]}else{inventoryObj.items_inventory[d]=f}}}if(typeof(inventoryObj.items_shop)!="undefined"){if(inventoryObj.items_shop.length==0){inventoryObj.items_shop={}}inventoryObj.items_shop[d]=f}changeTooltip($('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate'),f.activationTitle);if(f.hasEnoughCurrency){$('#itemDetails[data-uuid="'+d+'"] a.item').addClass("build-it").removeClass("build-it_disabled")}else{$('#itemDetails[data-uuid="'+d+'"] a.item').removeClass("build-it").addClass("build-it_disabled")}if(f.amount>0){$('#itemDetails[data-uuid="'+d+'"] a.activateItem').show();$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').hide();if(f.canBeActivated){$('#itemDetails[data-uuid="'+d+'"] a.activateItem').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem').addClass("build-it_disabled").removeClass("build-it")}}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem').hide();$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').show();if(f.canBeBoughtAndActivated&&f.hasEnoughCurrency){$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate').addClass("build-it_disabled").removeClass("build-it")}}if(isMobile){var g="";if($('#itemDetails[data-uuid="'+d+'"] a.activateItem:visible,#itemDetails[data-uuid="'+d+'"] a.buyAndActivate:visible').hasClass("build-it_disabled")){g+=f.activationTitle}if(f.buyTitle.length&&f.buyTitle!=f.activationTitle){g+=f.buyTitle}$('#itemDetails[data-uuid="'+d+'"] .info_txt').text(g)}if(f.timeLeft>0&&f.extendable){$('#itemDetails[data-uuid="'+d+'"] a.activateItem span').html(loca.extend);$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate span').html(loca.buyAndExtend)}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem span').html(loca.activate);$('#itemDetails[data-uuid="'+d+'"] a.buyAndActivate span').html(loca.buyAndActivate)}if(f.isAnUpgrade){$('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate').addClass("isUpgrade")}else{$('#itemDetails[data-uuid="'+d+'"] a.activateItem, #itemDetails[data-uuid="'+d+'"] a.buyAndActivate').removeClass("isUpgrade")}if(this.inShop===true){this.changeCategory($(".categoryFilter a.active").attr("rel"))}this.updateCategoryAmount()},boughtItemHint:function(){$(".to_inventory .bought_item_notice").show().fadeOut(1000)},openShop:function(){this.currentPage="shop";$("#js_inventorySliderBox").hide();$("#js_shopSliderBox").show();$(".to_inventory").removeClass("active");$(".to_shop").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_SHOP);if(isMobile){$(".js_shopCurrentPage").html(loca.shopText)}},openInventory:function(){this.currentPage="inventory";$("#js_shopSliderBox").hide();$("#js_inventorySliderBox").show();$(".to_shop").removeClass("active");$(".to_inventory").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_INVENTORY);if(isMobile){$(".js_shopCurrentPage").html(loca.inventoryText)}},changeCategory:function(c){inventoryObj.currentCategory=c;$(".planetlink, .moonlink").fragment({category:c});$(".categoryFilter li, .categoryFilter li a").removeClass("active");$('.categoryFilter li a[rel="'+c+'"]').addClass("active").parent().addClass("active");$(".anythingSlider").remove();var d=function(n,a){var o=[];var m=[];var b=0;$.each(n,function(g){if(this.category!=null){var f="$"+this.category.join("$")+"$";if(f.toLowerCase().indexOf("$"+c+"$")!=-1){o[inventoryObj.item_orders[c][this.ref]]=this;if(inventoryObj.item_orders[c][this.ref]>b){b=inventoryObj.item_orders[c][this.ref]}}}});for(var l=0;l<=b;++l){if(o[l]){m[l]=o[l]}}inventoryObj.initalizeSlider(m,a,340,340,null,null,null,false)};if(inventoryObj.currentPage=="shop"){d(inventoryObj.items_shop,"js_shopSlider")}else{if(inventoryObj.currentPage=="inventory"){d(inventoryObj.items_inventory,"js_inventorySlider")}}},updateCategoryAmount:function(){var d;if(inventoryObj.currentPage=="shop"){d=inventoryObj.items_shop}else{if(inventoryObj.currentPage=="inventory"){d=inventoryObj.items_inventory}else{return}}var c=$(".categoryFilter");c.find(".amount").text(0);$.each(d,function(m){if(this.category!=null){for(var a in this.category){var b=this.category[a];var k=c.find('a[rel="'+b+'"] .amount');var l;if(inventoryObj.currentPage=="shop"){l=1}else{if(inventoryObj.currentPage=="inventory"){l=this.amount}}k.text(tsdpkt(getValue(k.text())+l))}}});$.each(c.find("li"),function(b){var a=inventoryObj.currentPage.slice(0,1).toUpperCase()+inventoryObj.currentPage.slice(1);if($(this).hasClass("in"+a)){$(this).show()}else{$(this).hide();if(!c.find("li:visible .active").length){c.find("li:visible:first a").click()}}})}};function GFSlider(d){var c=this;c.duration=500;c.zIndex=10;c.intervalTime=30;c.lastTid=0;c.inAction=false;c.isOpen=false;c.lastObj=false;c.currHeight=d.offsetHeight;c.opacity=1;c.header=document.getElementById("header_text");c.ressButton=document.getElementById("resources_button");c.areaMap=document.getElementById("transImg");this.slideIn=function(b,a,g){if(!c.inAction){c.slideInObj=b;if(c.lastTid!=a||g){b.opacity=1;c.lastTid=a;$("#detail").html('<div id="techDetailLoading"></div>');if(!c.isOpen){if(c.ressButton){c.ressButton.style.display="none"}b.style.height="1px";b.style.display="block";b.style.overflow="hidden";c.inAction=true;c.startTime=new Date().getTime();c.slideInStep();c.isOpen=true}else{loadDetails(c.lastTid)}}else{c.header.style.display="block";c.opacity=0;c.lastTid=0;c.inAction=true;c.isOpen=false;c.startTime=new Date().getTime();c.slideOutObj=c.slideInObj;c.slideOutStep()}}};this.slideInStep=function(){d=c.slideInObj;var a=new Date().getTime();var b=parseInt(c.currHeight*((a-c.startTime)/c.duration));if(b<c.currHeight){d.style.height=(b)+"px";d.style.marginTop=(c.currHeight-1-b)+"px";window.setTimeout(c.slideInStep,c.intervalTime);c.opacity=Math.max(c.opacity-0.1,0);c.header.style.opacity=c.opacity;c.header.style.filter="Alpha(opacity="+(0.5*100)+")"}else{d.style.height=c.currHeight+"px";d.style.marginTop="0px";c.inAction=false;c.header.style.display="none";loadDetails(c.lastTid);if(c.lastObj&&d!=c.lastObj){c.hideLast()}c.lastObj=d}};this.slideOutStep=function(){d=c.slideInObj;var a=new Date().getTime();height=parseInt(c.currHeight*((a-c.startTime)/c.duration));if(height<c.currHeight){d.style.height=(c.currHeight-1-height)+"px";d.style.marginTop=(height)+"px";window.setTimeout(c.slideOutStep,c.intervalTime);c.opacity=Math.max(c.opacity+0.1,0);c.header.style.opacity=c.opacity}else{d.style.height=c.currHeight+"px";d.style.marginTop="0px";c.opacity=1;c.header.style.opacity=c.opacity;if(c.ressButton){c.ressButton.style.display="block"}d.style.display="none";c.inAction=false;c.hideLast()}};this.hideLast=function(){if(c.lastObj){$(".slideIn").removeClass("active");c.lastObj.style.display="none";c.inAction=false}$(document).trigger("ajaxHideElement",c.lastTid)};this.hide=function(a){$(".slideIn").removeClass("active");c.slideOutObj=a;c.opacity=1;c.header.style.opacity=c.opacity;c.header.style.display="block";if(c.ressButton){c.ressButton.style.display="block"}if(c.areaMap){c.areaMap.style.display="block"}c.slideOutObj.style.display="none";c.inAction=false;c.lastTid=0;c.isOpen=false}}function rocketsDestroyed(b){var b=$.parseJSON(b);errorBoxAsArray(b.errorbox);if(!b.errorbox.failed){$(".rocketlayer").dialog("close");gfSlider.slideIn(getElementByIdWithCache("detail"),techID,true)}}function supplyFleet(b){var b=$.parseJSON(b);if(b.status){getAjaxResourcebox();supplyTimes[b.id]=b.time;new simpleCountdown($("#holdingTime-"+b.id),b.time)}errorBoxAsArray(b.errorbox)}function updateSupplyDetails(f,g,d){$("#shipCount").html(gfNumberGetHumanReadable(f));$("#deutCosts").html(gfNumberGetHumanReadable(g));$("span.countdown").hide();$("#holdingTime-"+d).show()}function initAllianceDepot(){$(".overlayDiv[data-page='allydepotlayer'] select").ogameDropDown();$(".holdingTime:first-child").show();for(var b in supplyTimes){new simpleCountdown($("#holdingTime-"+b),supplyTimes[b])}$("#supplyTimeInput").focus(function(){clearInput(this)}).keyup(function(){var a=getValue($("#resources_deuterium").text());var d=getValue($("#deutCosts").text());checkIntInput(this,1,Math.floor(a/d))})}function tabletInitOverviewAdvice(){if(!isMobile){return false}var g=$(".adviceWrapper");var d=g.find("#exodus-indicator, #exodus-timer");var f=g.find("#exodus-indicator-processed");g.prev().before(d);g.prev().before(f);$("#planetdata").after(g)}function tabletInitGalaxyDetails(){if(!isMobile){return false}var b=["js_planet","js_moon","js_debris","js_playerName","js_allyTag"];$(".js_detailRow").css("display","none");$(".js_detailRow").each(function(f){f=$(this).attr("rel");for(var g=0;g<b.length;g++){var a=$("."+b[g]+f);if(a===undefined||a.length==0){if(f==17){continue}return}if(a.attr("class").indexOf("js_no_action")>=0){continue}a.unbind();a.bind("click.planet",function(c){if($(this).hasClass("active")){$(".row *.active").removeClass("active");$(".js_detailRow").css("display","none")}else{$(".row *.active").removeClass("active");if($(".bdaySlotBox")){$(".bdaySlotBox .name").removeClass("active")}$(".js_detailRow").css("display","none");if($(this).html().trim()){$(this).addClass("active");if($(this).attr("class").indexOf("js_planet")>=0){elem=".js_detailRowPlanet"+f}else{if($(this).attr("class").indexOf("js_moon")>=0){elem=".js_detailRowMoon"+f}else{if($(this).attr("class").indexOf("js_debris")>=0){elem=".js_detailRowDebris"+f}else{if($(this).attr("class").indexOf("js_playerName")>=0){elem=".js_detailRowPlayer"+f}else{if($(this).attr("class").indexOf("js_allyTag")>=0){elem=".js_detailRowAlliance"+f}}}}}if(f==17){$(elem).css("display","block")}else{$(elem).css("display","table-row")}}}})}});$("a.planetMoveIcons").bind("click",function(a){a.stopPropagation()})}function tabletToggleTechtreeInfos(g){if(!isMobile){return false}var f=$("div.techtree[data-id='"+g+"']");var d=f.find(".techImage a");d.each(function(){var b=$(this);var c=b.parent().hasClass("built")?"undermark":"overmark";var a=b.data("tech-name");var k=b.data("tech-type");b.append('<div class="short_info" style="display: none"><span class="'+c+'">'+a+"</span><br/>"+k+"</div>")});if(d.length){f.append($('<a id="toggleDetails" href="javascript:void(0)" class="btn_blue">'+LocalizationStrings.moreDetails+"</a>").click(function(){var a=f.find(".short_info");if(a.is(":visible")){$(this).text(LocalizationStrings.moreDetails)}else{$(this).text(LocalizationStrings.lessDetails)}a.toggle()}))}}function tabletInitEmpire(){if(!isMobile){return false}var b=$("#mainWrapper").width();b=(b<1024)?"1024":b;$("#outerWrapper").width(b);$(".reset").hide()}function tabletInitPayment(){if(!isMobile){return false}$("#payment").parent(".overlayDiv").dialog("option","title",paymentLoca.title);document.addEventListener("deviceready",function(){$("#mobilePayment a.js_buyPacket").unbind("click").bind("click",function(){HostApp.StartPayment($(this).attr("ref"),userData.id,constants.name,constants.language)});HostApp.OnPaymentFinished=function(){getAjaxResourcebox(function(b){fadeBox(paymentLoca.success,false);$("#payment").parent().dialog("close");$("#planet #content .level span").attr("class","undermark").text(b.darkmatter.string)})};HostApp.OnPaymentFailed=function(){fadeBox(paymentLoca.error,true)}},false)}function tabletInitGalaxy(){if(!isMobile){return false}$("#galaxyContent").wipetouch({wipeLeft:function(b){if(!$("#galaxyLoading:visible").length){submitOnKey(39)}},wipeRight:function(b){if(!$("#galaxyLoading:visible").length){submitOnKey(37)}},preventDefault:false,preventDefaultWhenTriggering:true,moveX:180,moveY:60})}function initRetinaImages(){if($(".js_replace2x").css("font-size")=="1px"){$("img.js_replace2x").each(function(){$(this).attr("src",$(this).attr("rel"))})}}function setupOverlay(f,d,g){$(".build-it_premium").addClass("overlay");$(".build-it_premium").attr("href",f);$(".build-it_premium").data("overlay-title",d);$(".build-it_premium").data("techid",g)}function setupBuildinglistForBuildItButton(f,g,d){new baulisteCountdown(document.getElementById("possibleInTime"),buildableAt,pageToReload)}function drawErrorbox(q,o,m,k,p,n){var n=n==undefined?false:n;var l=n!==false?$("."+n):$(".build-it_disabled");if(typeof(p)=="undefined"||p==""){p=document.location.href}l.click(function(){if(m!==undefined&&k!==undefined&&p!==undefined){if(q=="notify"){errorBoxNotify(m,o,k.allOk,function(){window.location.href=p})}if(q=="decision"){errorBoxDecision(m,o,k.allYes,k.allNo,function(){window.location.href=p})}}if(q=="fadeBox"){fadeBox(o,true)}})}function initializeBuildItButton(){if(hasCommander&&buildableAt>0){setupBuildinglistForBuildItButton(loca.allDetailNow,techID,showSlotWarning)}if(buttonState){$(".build-it").on("click",function(){sendBuildRequest(null,null,showSlotWarning)})}else{if(couldBeBuild){$errorCount=showErrors()}else{$errorCount=99}if((error==null||error==0)&&$errorCount==0){$(".build-it_premium").on("click",function(){var c=$("#number").val();if(typeof c=="undefined"){c=1}var d=links.overlay+"&amount="+c;setupOverlay(d,overlayTitle,techID)})}}$(document).off("keypress.submitBuild").on("keypress.submitBuild","#contentWrapper #inhalt #number",function(c){if(c.keyCode!=13){return}c.stopPropagation();var d=$(".build-it_premium");if(d.length){d.trigger("click")}else{$(".build-it").trigger("click")}})}function showErrors(){var b={allYes:loca.allYes,allNo:loca.allNo,allOk:loca.allOk};if(isBuildlistNeeded){if(!hasCommander&&!(isShip||isRocket)){drawErrorbox("decision",loca.infoBuildlist,loca.allError,b,links.decisionCommander,"build-it_premium");return 1}if(isRocketAndStorageNotFree){drawErrorbox("notify",loca.noRocketsiloCapacity,loca.allError,b,links.notify);return 1}}else{if(error!==null&&error!==0){if(premiumerror){if(showErrorOnPremiumbutton){drawErrorbox("decision",errorlist[error],loca.allError,b,links[error],buttonClass);return 1}else{drawErrorbox("decision",errorlist[error],loca.allError,b,links[error]);return 1}}else{if(isRocketAndStorageNotFree){drawErrorbox("notify",loca.noRocketsiloCapacity,loca.allError,b,links.notify);return 1}else{if(isBusy){return 1}else{drawErrorbox("notify",errorlist[error],loca.allError,b,"");return 1}}}}}return 0}function initTechDetailsAjax(){initializeBuildItButton();refreshBars("bar_container","filllevel_bar")}function initGlobalTechtree(c){var d=$("div.techtree[data-id='"+c+"']");d.find(".headline").unbind("click").bind("click",function(){$(this).next().toggle(function(){var a=d.parents(".ui-dialog");a.hide();$(this).toggleClass("open");a.show()})});if(openTree=="all"){d.find(".techtree_content").show(0,function(){$(this).addClass("open")})}else{if(openTree!=null){d.find(".techtree_content_"+openTree).show(0,function(){$(this).addClass("open")})}}}function initOverlayName(){$("div.techtree").each(function(){if(typeof($(this).attr("data-title"))!="undefined"){$(this).parent(".overlayDiv").dialog("option","title",$(this).attr("data-title"))}})}function initTechtree(h){var k=$("div.techtree[data-id='"+h+"']");var f=k.find(".techImage").outerHeight(true);var g=20;k.find(".techWrapper.depth1").each(function(){g+=$(this).outerWidth()});k.css("width",g);$(document).ready(function(){var c=jsPlumb.getInstance();c.Defaults.Container=k.find(".graph");c.Defaults.Connector=["Flowchart",{cornerRadius:20}];c.Defaults.Endpoint=["Rectangle",{cssClass:"endpoint",width:1,height:1}];c.Defaults.Anchors=["ContinuousTop","ContinuousBottom"];var H={};$.each(endpoints,function(){var m=k.find(".tech"+this.toString());c.addEndpoint(m);var n=Math.floor(m.find("a").offset().left);var l=Math.floor(m.find("a").offset().top);H[this]=[n,l]});var D;do{D=false;$.each(connections,function(){var m=k.find(".tech"+this.source+" a");var l=k.find(".tech"+this.target+" a");if(m.offset().top>=l.offset().top-10&&m.offset().top<=l.offset().top+10){m.parent().css("margin-top",parseInt(m.parent().css("margin-top").replace(/px/,""))+f);m.parent().parent().find("a[data-tech-id]").each(function(){H[$(this).attr("data-tech-id")][1]+=f});D=true}})}while(D);var B=[];var F=[];for(var C in H){if(B.indexOf(H[C][0])==-1){B.push(H[C][0])}if(F.indexOf(H[C][1])==-1){F.push(H[C][1])}}B.sort(function(m,l){return(m>l?1:-1)});F.sort(function(m,l){return(m>l?1:-1)});var a={};for(var G in H){a[G]={left:B.indexOf(H[G][0]),top:F.indexOf(H[G][1])}}connections.sort(function(m,l){return(Math.abs(a[m.source]["left"]-a[m.target]["left"])<Math.abs(a[l.source]["left"]-a[l.target]["left"]))?-1:1});var d={hasRequirements:{strokeStyle:"#015100",lineWidth:3},hasNotRequirements:{strokeStyle:" #510009",lineWidth:3}};var x=[[0,0.5,-1,0],[0,0.3,-1,0],[0,0.7,-1,0],[0,0.9,-1,0]];var b=[[1,0.5,1,0],[1,0.3,1,0],[1,0.7,1,0],[1,0.9,1,0]];var E=[[0.5,1,0,1],[0.3,1,0,1],[0.7,1,0,1],[0.9,1,0,1]];var y=[[0.5,0,0,-1],[0.3,0,0,-1],[0.7,0,0,-1],[0.9,0,0,-1]];var A={};function I(o,m,l,n){if(!n[o]){n[o]={}}if(n[o][m]==undefined){n[o][m]=0}++n[o][m];return l[n[o][m]-1]}$.each(connections,function(){var m=k.find(".tech"+this.source+" a");var l=k.find(".tech"+this.target+" a");var n={source:m,target:l,overlays:[["Arrow",{location:-5,paintStyle:d[this.paintStyle],width:8,length:8,foldback:0.8}],["Label",{label:this.label,cssClass:"label "+this.paintStyle,location:0.85}]],paintStyle:d[this.paintStyle],hoverPaintStyle:{strokeStyle:"rgb(255, 255, 0)"}};if(a[this.target].left<a[this.source].left){if(!lineInCoordinatesBlocked(a,a[this.source].left,a[this.source].top,a[this.source].left,a[this.target].top)&&!positionInCoordinatesBlocked(a,a[this.source].left,a[this.target].top)&&!lineInCoordinatesBlocked(a,a[this.source].left,a[this.target].top,a[this.target].left,a[this.target].top)){n.anchors=[I(this.source,"top",y,A),I(this.target,"right",b,A)]}else{n.anchors=[I(this.source,"left",x,A),I(this.target,"bottom",E,A)];n.overlays[1][1]=readableVersionOfLabel(n.overlays[1][1],A[this.target].bottom)}}else{if(a[this.target].left>a[this.source].left){if(!lineInCoordinatesBlocked(a,a[this.source].left,a[this.source].top,a[this.source].left,a[this.target].top)&&!positionInCoordinatesBlocked(a,a[this.source].left,a[this.target].top)&&!lineInCoordinatesBlocked(a,a[this.source].left,a[this.target].top,a[this.target].left,a[this.target].top)){n.anchors=[I(this.source,"top",y,A),I(this.target,"left",x,A)]}else{n.anchors=[I(this.source,"right",b,A),I(this.target,"bottom",E,A)];n.overlays[1][1]=readableVersionOfLabel(n.overlays[1][1],A[this.target].bottom)}}else{if(a[this.target].top<a[this.source].top-1&&lineInCoordinatesBlocked(a,a[this.source].left,a[this.source].top,a[this.target].left,a[this.target].top)){n.anchors=[I(this.source,"left",x,A),I(this.target,"left",x,A)]}else{n.anchors=[I(this.source,"top",y,A),I(this.target,"bottom",E,A)];n.overlays[1][1]=readableVersionOfLabel(n.overlays[1][1],A[this.target].bottom)}}}c.connect(n)})});tabletToggleTechtreeInfos(h)}function readableVersionOfLabel(f,g){f.location=(-0.05*g+0.85);var d=f.label.indexOf("/");if(d){}return f}function lineInCoordinatesBlocked(o,q,p,n,r){if(q==n){for(var s in o){if(o[s].left==q&&p>o[s].top&&r<o[s].top){return true}}}else{if(p==r&&q>n){for(var k in o){if(o[k].top==p&&q>o[k].left&&n<o[k].left){return true}}}else{if(p==r&&q<n){for(var m in o){if(o[m].top==p&&q<o[m].left&&n>o[m].left){return true}}}}}return false}function positionInCoordinatesBlocked(h,k,f){for(var g in h){if(h[g].left==k&&h[g].top==f){return true}}return false}var javascriptAvailable=true;var days=new Array("Mon","Tus","Wed","Thu","Fri","Sat","Sun");var months=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");function getFormatedDate(d,g){var f=new Date();f.setTime(d);str=g;str=str.replace("[d]",dezInt(f.getDate(),2));str=str.replace("[D]",days[f.getDay()]);str=str.replace("[m]",dezInt(f.getMonth()+1,2));str=str.replace("[M]",months[f.getMonth()]);str=str.replace("[j]",parseInt(f.getDate()));str=str.replace("[Y]",f.getFullYear());str=str.replace("[y]",f.getFullYear().toString().substr(2,4));str=str.replace("[G]",f.getHours());str=str.replace("[H]",dezInt(f.getHours(),2));str=str.replace("[i]",dezInt(f.getMinutes(),2));str=str.replace("[s]",dezInt(f.getSeconds(),2));return str}function dezInt(h,n,l){l=(l)?l:"0";var m=(h<0)?"-":"",k=(l=="0")?m:"";h=Math.abs(parseInt(h,10));n-=(""+h).length;for(var o=1;o<=n;o++){k+=""+l}k+=((l!="0")?m:"")+h;return k}function getFormatedTime(b){hours=Math.floor(b/3600);timeleft=b%3600;minutes=Math.floor(timeleft/60);timeleft=timeleft%60;seconds=timeleft;return dezInt(hours,2)+":"+dezInt(minutes,2)+":"+dezInt(seconds,2)}function tsdpkt(k){var g="";if(k<0){g="-"}k=Math.abs(k);var f=k%1000;while(k>=1000){var h="";if((k%1000)<100){h="0"}if((k%1000)<10){h="00"}if((k%1000)==0){h="00"}k=Math.abs((k-(k%1000))/1000);f=k%1000+LocalizationStrings.thousandSeperator+h+f}f=g+f;return f}function formatTime(g){var f=Math.floor(g/3600);g-=f*3600;var d=Math.floor(g/60);g-=d*60;if(d<10){d="0"+d}if(g<10){g="0"+g}return f+":"+d+":"+g}function round(g,h){if(h<1||h>14){return false}var k=Math.pow(10,h);var f=(Math.round(g*k)/k).toString();if(f.indexOf(".")==-1){f+="."}f+=k.toString().substring(1);return f.substring(0,f.indexOf(".")+h+1)}function show_hide_menus(b){if($(b).is(":visible")){$(b).hide()}else{$(b).show()}}function change_class(b){if(document.getElementById(b).className=="closed"){document.getElementById(b).className="opened"}else{document.getElementById(b).className="closed"}}function show_hide_tbl(g){var f=document.getElementById(g);try{if(f){f.style.display=(f.style.display=="none"?"table-row":"none")}}catch(d){f.style.display="block"}}function cntchar(g,d){var f=$(g);if(f.val().length>d){f.val(f.val().substr(0,d))}f.parents("form").find(".cntChars").text(f.val().length)}function getSession(){return $('meta[name="ogame-session"]').attr("content")}function showGalaxy(g,d,f){openParentLocation("index.php?page=galaxy&no_header=1&galaxy="+g+"&system="+d+"&planet="+f)}function openParentLocation(c){try{window.opener.document.location.href=c}catch(d){try{window.parent.document.location.href=c}catch(d){document.location.href=c}}}function submitOnEnter(d){var c;if(window.event){c=window.event.keyCode}else{if(d){c=d.which}else{return true}}if(c==13){trySubmit();return false}else{return true}}function formSubmitOnEnter(d,f){var g;if(window.event){g=window.event.keyCode}else{if(f){g=f.which}else{return true}}if(g==13){document.forms[d].submit();return false}else{return true}}function setMaxIntInput(f,d){for(var g in d){if(!$(f).find("#ship_"+g).attr("disabled")){$(f).find("#ship_"+g).val(d[g]);checkIntInput($(f).find("ship_"+g),0,d[g])}}}function clearInput(b){$(b).val("")}function checkIntInput(h,g,k){var f=$(h).val();if(typeof f!="undefined"&&f!=""){intVal=Math.abs(getValue(f));if(k!=null){intVal=Math.min(intVal,k)}$(h).val(intVal)}}function handlerToSubmitAjaxForm(c){var d="submit_"+String(c);if($.isFunction(window[d])){window[d]()}return false}function ajaxCall(d,c){$("#"+c+" select").ogameDropDown("destroy");$("#"+c).html('<p class="ajaxLoad"></p>');$.post(d,function(a){$("#"+c).html(a);$("#"+c+" select").ogameDropDown()})}function ajaxSumbit(f,d,g){$("#"+g+" select").ogameDropDown("destroy");$("#"+g).html('<p class="ajaxLoad"><?=LOCA_ALL_AJAXLOAD ?></p>');$.post(f,$("#"+d).serialize(),function(a){$("#"+g).html(a);$("#"+g+" select").ogameDropDown()})}Number.prototype.isBetween=function(c,d){return this>=c&&this<=d};function getValue(b){result=parseInt(b.toString().replace(/^k$/,"1000").replace(/k/,"000").replace(/^0+/,"").replace(/[^0-9]/g,""));return isNaN(result)?0:result}function loadScript(f,h){if(typeof(loadScript.loadedScripts)=="undefined"){loadScript.loadedScripts={}}if(typeof(loadScript.loadedScripts[f])=="undefined"){loadScript.loadedScripts[f]=true;var g=document.createElement("script");g.type="text/javascript";if(g.readyState){g.onreadystatechange=function(){if(g.readyState=="loaded"||g.readyState=="complete"){g.onreadystatechange=null;h()}}}else{g.onload=function(){h()}}g.src=f;var k=document.getElementsByTagName("head")[0];k.appendChild(g)}else{h()}}function formatNumber(g,k){var m=number_format(getValue(k),0,LocalizationStrings.decimalPoint,LocalizationStrings.thousandsSeparator);var l=$(g);var h=l.getSelection();if(l.val()!=m){if(l.val().length!=m.length){h.start=h.start+(m.length-l.val().length);h.end=h.end+(m.length-l.val().length)}}l.val(m);if(l.is(":focus")){l.setSelection(h)}}function initToggleHeader(b){$("a.toggleHeader").click(function(){$("#planet").toggleClass("shortHeader");$(".c-left").toggleClass("shortCorner");$(".c-right").toggleClass("shortCorner");changeSetting("headerImage",b+"|"+($("#planet.shortHeader").length==1))})}function initFormValidation(){$("form.formValidation").validationEngine({validationEventTrigger:"keyup blur",promptPosition:"centerRight"})}Function.prototype.clone=function(){var f=this;var g=function(){return f.apply(this,arguments)};g.prototype=f.prototype;for(var d in f){if(f.hasOwnProperty(d)&&d!=="prototype"){g[d]=f[d]}}return g};function hideTipsOnTabChange(){$("select").ogameDropDown("hide");Tipped.hideAll()}jQuery.fn.slideFadeToggle=function(f,g,d){return this.animate({opacity:"toggle",width:"toggle"},f,g,d)};function focusOnTabChange(f,d){var g=function(){$(f).focus()};if(d==true){$(document).ready(g)}$(window).unbind("blur").bind("blur",g)}function getIEVersion(){var b=999;if(navigator.appVersion.indexOf("MSIE")!=-1){b=parseFloat(navigator.appVersion.split("MSIE")[1])}return b}ogame.tools={addHover:function(b){$(b).on({mouseenter:function(){$(this).addClass("over")},mouseleave:function(){$(this).removeClass("over")}})},scrollToTop:function(){var b=$(".scroll_to_top");$(window).on("scroll.scrollToTop",function(){$(".scroll_to_top").css({visibility:(b.offset().top>window.innerHeight)?"visible":"hidden"},600)});b.on("click.scrollToTop",function(){$("body, html").animate({scrollTop:0},600)})}};function refreshBars(g,k,f){var h=$("."+g);h.each(function(){var q=$(this),o=q.data("currentAmount"),p=q.data("capacity"),d=o/p*100,a=q.find("."+k);if(d>100){d=100}else{if(d==0){d=0}else{if(d<1.3){d=1.3}}}a.css("width",d+"%");if(d<90){a.attr("class",k+" filllevel_undermark")}else{if(d>90&&d<100){a.attr("class",k+" filllevel_middlemark")}else{a.attr("class",k+" filllevel_overmark")}}if(f){var b=q.find("."+f),c=b.data("premiumPercent");if((d+c)>100){c=100-d}b.css("width",c+"%")}})}function changeTooltip(f,g){var d=$(f);if(d.length==0){return}removeTooltip(d);d.attr("title",g);initTooltips(d)}function removeTooltip(d){var c=$(d);c.each(function(){if($(this).data("tooltipLoaded")){$(this).data("tooltipLoaded",false);Tipped.remove($(this)[0])}})}function getTooltipOptions(d){var g=$(d);var f={skin:"cloud",maxWidth:400,closeButton:false,hideOn:[{element:"self",event:"mouseleave"},{element:"tooltip",event:"mouseenter"}]};if(window.location.href.indexOf("galaxy")!==-1){f.maxWidth=400}if(g.hasClass("tooltipPremium")){f.skin="premium"}if(g.hasClass("tooltipLeft")){f.hook={target:"leftmiddle",tooltip:"righttop"}}else{if(g.hasClass("tooltipRight")){f.hook={target:"rightmiddle",tooltip:"lefttop"}}else{if(g.hasClass("tooltipBottom")){f.hook={target:"bottommiddle",tooltip:"topmiddle"}}}}if(g.data("tooltip-width")){f.maxWidth=g.data("tooltip-width")}if(isMobile||g.hasClass("tooltipClose")){f.hideOthers=true;f.hideOn=false}f.afterUpdate=function(a,c){if(isMobile&&g.data("tooltip-button")){var k=$(document.createElement("div")).addClass("tooltipButton");$(document.createElement("a")).addClass("btn_blue").attr("href","javascript:void(0);").html(g.data("tooltip-button")).bind("click",function(h){if($(c).not("a")&&$(c).find("a").length){c=$(c).find("a")[0]}var m=document.createEvent("MouseEvents");m.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);c.dispatchEvent(m)}).appendTo(k);$(a).append(k)}if(isMobile||g.hasClass("tooltipClose")){var b=$(document.createElement("div")).addClass("close-tooltip");$(a).prepend(b)}Tipped.refresh(c)};return f}function getTooltipSelector(f){var g=".tooltipPremium, .tooltip, .tooltipRight, .tooltipLeft, .tooltipBottom, .tooltipClose, .tooltipHTML, .tooltipRel, .tooltipAJAX, .tooltipCustom, .markItUpButton a";if(typeof(f)=="undefined"){f=g}else{if(typeof(f)=="string"&&!f.match(/\.tooltip/)){var h=g.split(", ");var k=f;for(i in h){f+=", "+k+" "+h[i]}}}return f}function sanitizeTooltip(b){return b.replace(/<\s*script/g,"&lt;script")}function initTooltips(d){initTooltipSkins();d=getTooltipSelector(d);function g(b){var p={};var a=b.split("|");var c=$(document.createElement("h1")).html(a[0]);var o=$(document.createElement("div")).addClass("splitLine");if(typeof a[2]!=="undefined"&&typeof a[3]!=="undefined"){var n=$(document.createElement("h1")).html(a[2]);var q=$(document.createElement("div")).addClass("splitLine");p=$(document.createElement("div")).css("display","none").addClass("htmlTooltip").append(c).append(o).append(a[1]+"</br>").append(n).append(q).append(a[3])}else{p=$(document.createElement("div")).css("display","none").addClass("htmlTooltip").append(c).append(o).append(a[1])}return p[0]}removeTooltip(d);function f(b){var a=$(b);if(a.data("tooltipLoaded")){return}a.data("tooltipLoaded",true);if(isMobile&&a.hasClass("js_hideTipOnMobile")){a.attr("title","");return}var c=getTooltipOptions(a);if(a.hasClass("tooltipCustom")){if(c.hideOn!=false){c.hideOn=[{element:"self",event:"mouseleave"},{element:"tooltip",event:"mouseleave"}]}c.afterUpdate=function(k){$(k).find(".tooltipCustom").each(function(h,n){var o=getTooltipOptions(a);if($(this).hasClass("tooltipHTML")){o.inline=true;o.hideOthers=false;Tipped.create(this,g(sanitizeTooltip($(this).attr("title"))),o)}else{o.hideOthers=false;Tipped.create(this,sanitizeTooltip($(this).attr("title")),o)}})}}if(a.hasClass("tooltipHTML")){if(typeof(a.attr("title"))=="undefined"){return}Tipped.create(a[0],g(sanitizeTooltip(a.attr("title"))),c);return}if(a.hasClass("tooltipRel")){c.inline=true;Tipped.create(a[0],a.attr("rel"),c);return}if(a.hasClass("tooltipAJAX")){$.get(a.attr("rel"),{},function(k){Tipped.create(a[0],k,c)});return}if(typeof(a.attr("title"))=="undefined"||a.attr("title").length==0){return}Tipped.create(a[0],sanitizeTooltip(a.attr("title")),c)}$(document).undelegate(d,"touchstart.tooltipClick").delegate(d,"touchstart.tooltipClick",function(a){if(Tipped.visible(this)){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);this.dispatchEvent(b);a.preventDefault();a.stopPropagation()}});if(typeof(d)=="string"){$(document).undelegate(d,"mouseenter.tooltipLoad touchstart.tooltipLoad").delegate(d,"mouseenter.tooltipLoad touchstart.tooltipLoad",function(a){f(this)})}else{$(d).each(function(){f(this)})}}$(function(){initTooltips()});function initTooltipSkins(){jQuery.extend(Tipped.Skins,{cloud:{border:{size:1,color:[{position:0,color:"#44576b"},{position:1,color:"#2f3b47"}]},background:{color:[{position:0,color:"#303a46"},{position:0.49,color:"#242d38"},{position:0.81,color:"#10181f"},{position:1,color:"#0d1014"}]},offset:{x:0,y:-1,mouse:{x:-12,y:-12}},stem:{height:6,width:11,offset:{x:5,y:5},spacing:0}},premium:{border:{size:1,color:[{position:0,color:"#000"},{position:1,color:"#000"}]},background:{color:[{position:0,color:"#a3e4f0"},{position:0.15,color:"#1cbad7"},{position:1,color:"#0f78b1"}]},offset:{x:0,y:-1,mouse:{x:-12,y:-12}},stem:{height:6,width:11,offset:{x:5,y:5},spacing:0}}})}function initTrader(){var d=false;var f=$.deparam.fragment();if(typeof(f.animation)!="undefined"){if(f.animation=="false"){d=true}}var g={$link:null,$panel:null,close:function(){this.$panel.hide()},setPanel:function(){this.$panel=$("#js_togglePanel"+traderObj.traderId.replace(/#div_trader/,""))},init:function(l){var c=$(l+" .selectWrapper");l=l.replace(/#div_trader/,"");if(!c){return}this.$link=$("#js_toggleLink"+l);this.$panel=$("#js_togglePanel"+l);var a=this.$panel;a.hide();this.$link.unbind("click.selectLink").bind("click.selectLink",function(h){l=traderObj.traderId.replace(/#div_trader/,"");if($(this).hasClass("honor")){return false}if(a.find("ul.active").has("li").length){a.toggle()}return false});$(".selectWrapper .source").unbind("click.selectPlanetOrMoon").bind("click.selectPlanetOrMoon",function(h){g.selectPlanetOrMoon(this)});$("#"+a.attr("id")).find("li").unbind("click.selectSource").bind("click.selectSource",function(h){traderObj.selectSource(this);return false});g.outerClick(c,a);var b=null,m=8000;c.unbind("mouseout.closeSelect").bind("mouseout.closeSelect",function(h){h=h||window.event;var k=(h.relatedTarget)?h.relatedTarget:h.toElement;if(k==c||g.isChildOf(k,c)){return}b=setTimeout(function(){a.hide()},m)}).unbind("mouseover.clearTimeout").bind("mouseover.clearTimeout",function(){if(b){clearTimeout(b)}})},isChildOf:function(a,b){b=b[0];while(a&&a!=b){a=a.parentNode}return a==b},outerClick:function(b,a){$("body").bind("click.outerClick",function(c){if(!c){c=window.event}if(!($(c.target).closest(".selectWrapper")==b)&&a.is(":visible")!=false){a.toggle()}})},selectPlanetOrMoon:function(a){var o;if($(a).hasClass("selected")){return false}var p="",s=null;if($(a).hasClass("js_honor")){$(traderObj.traderId+" .selectWrapper .source").removeClass("selected");$(traderObj.traderId+" .js_honor").addClass("selected");$(traderObj.traderId+" .toggleLink").addClass("honor");var p='<img height="18" src="//gf1.geo.gfsrv.net/cdnfc/f35675179214f8f6f0f8d75740d7db.png" alt="'+loca.honorPoints+'"/><span class="option_source">'+loca.honorPoints+"</span>";$(traderObj.traderId+" .js_valSourcePlanet").html(p);$(traderObj.traderId+" .normalResource").hide();$(traderObj.traderId+" .honorResource").show();return false}var q=$(traderObj.traderId+" .togglePanel");var b="planet";if($(a).hasClass("js_moon")){var c=0;b="moon";for(o in traderObj.planets){if(traderObj.planets[o].isMoon){c++}}if(c==0){return false}}var r=traderObj.planets[traderObj.current.planet];q.find("ul").hide().removeClass("active");q.find("ul."+b).show().addClass("active");$(traderObj.traderId+" .toggleLink").removeClass("honor");$(traderObj.traderId+" .selectWrapper .source").removeClass("selected");$(traderObj.traderId+" .js_"+b).addClass("selected");if($(a).hasClass("js_moon")?r.isMoon:!r.isMoon){s=traderObj.current.planet}else{if(r.otherPlanet!=null&&typeof(traderObj.planets[r.otherPlanet])!="undefined"){s=r.otherPlanet}else{s=q.find("ul."+b+" li:first").attr("id")}}$(traderObj.traderId+" .normalResource").show();$(traderObj.traderId+" .honorResource").hide();q.find("ul li#"+s).click();return false},setToggleLink:function(b){var c=traderObj.traderId.replace(/#div_trader/,""),k=$(b).find("span"),a=traderObj.planets[$(b).attr("id")].name;if(a!=k.text()){k.attr("title",a.replace(/\|/g,"&#124;"))}this.$link=$("#js_toggleLink"+c);this.$link.html($(b).html())}};traderObj={traderBGPos:{"#div_traderResources":"0px 0px","#div_traderAuctioneer":"-546px 0px","#div_traderScrap":"0px -220px","#div_traderImportExport":"-546px -220px"},timer:500,planets:{},honorOutput:0,price:0,deficit:0,priceImportExport:0,sumResources:0,traderId:null,resources:["Metal","Crystal","Deuterium"],current:{planet:currentPlanetId,resource:"",sliderValue:""},barXPos:-180,barYPos:0,percentPaid:0,switchingTrader:false,checkOverbidden:function(){if(playerBid==false||playerBid>=getValue($(".detail_value.currentSum").html())){$(".overbid_text").hide()}else{$(".overbid_text").show()}},refresh:function(){var c=traderObj.traderId;if("#"+$(this).closest(".div_trader").attr("id")!==c){return}var b=$(this).attr("class");var a=new RegExp(/\b(js_slider\w*)\b/);b=(a.test(b))?RegExp.$1:false;if(!b){return}traderObj.current.sliderValue=$(this).slider("value");traderObj.current.resource=b.replace("js_slider","").toLowerCase();if(traderObj.current.resource=="honor"){traderObj.honorOutput=traderObj.current.sliderValue}else{traderObj.planets[traderObj.current.planet].output[traderObj.current.resource]=traderObj.current.sliderValue}formatNumber($(c+" .js_amount.js_"+traderObj.current.resource),traderObj.current.sliderValue);if(c=="#div_traderAuctioneer"){traderObj.price=getValue($(c+" .js_price").html());traderObj.sumAuctioneer();traderObj.checkOverbidden()}else{if(c=="#div_traderImportExport"){traderObj.sumImportExport()}}},resetValues:function(b,c){b=b||traderObj.traderId;c=c||false;for(var k in traderObj.planets){for(var a in traderObj.planets[k].output){traderObj.planets[k].output[a]=0}}traderObj.honorOutput=0;$(".js_amount").val(0);if(traderObj.traderId=="#div_traderAuctioneer"){traderObj.sumAuctioneer()}else{if(traderObj.traderId=="#div_traderImportExport"){traderObj.sumImportExport()}}if(c){b=b.replace(/#div_trader/,"");$("#js_togglePanel"+b).find("li#"+currentPlanetId).click()}g.close()},resetMaxAmount:function(c,s){var b=traderObj.traderId;var u=traderObj.resources;for(var p in traderObj.planets){for(var q=0;q<u.length;q++){var a=u[q].toLowerCase();traderObj.planets[p].input[a]=c[p][a]}}for(var r=0;r<u.length;r++){a=u[r].toLowerCase();var v=traderObj.planets[traderObj.current.planet].input[a];$(b+" .max_planet_"+a).html(number_format(v,0))}honorScore=s;$(b+" .max_planet_honor").html(number_format(Math.max(0,s),0));g.close()},selectSource:function(a){traderObj.current.planet=$(a).attr("id");g.close();g.setToggleLink($(a));var p=traderObj.traderId;var s=traderObj.current.planet;var u=traderObj.resources;for(var r=0;r<u.length;r++){var b=u[r].toLowerCase();var v=traderObj.planets[s].input[b];if(p=="#div_traderImportExport"){var c=(traderObj.priceImportExport/multiplier[b])-traderObj.sumResources+traderObj.planets[s].output[b];var q=Math.min(v,c)}$(p+" .max_planet_"+b).html(number_format(v,0));$(p+" .js_amount.js_"+b).val(number_format(traderObj.planets[s].output[b],0))}},selectTrader:function(p,a,n){a=a||traderObj.timer;$.bbq.pushState({page:p,animation:"false"});$(".planetlink, .moonlink").fragment({page:p,animation:"false"});traderObj.traderId="#div_"+p;var o=traderObj.traderId,q=$(".back_to_overview");var c=function(){if(o=="#div_traderAuctioneer"||o=="#div_traderImportExport"){traderObj.resetValues(null,true)}var h=function(){$("#traderOverview").find(".c-left, .c-right").addClass("c-small");q.show();if(o=="#div_traderAuctioneer"||o=="#div_traderImportExport"){q.addClass("left");q.removeClass("right")}else{if(o=="#div_traderResources"||o=="#div_traderScrap"){q.addClass("right");q.removeClass("left")}}$("#planet #header_text h2").html(loca[p]).parent().show()};if(animation&&!d){$("#traderOverview").find(".c-left, .c-right").hide();$("#planet").animate({backgroundPosition:traderObj.traderBGPos[o],height:"250px"},a,function(){$("#planet").addClass("detail");$("#traderOverview").find(".c-left, .c-right").show();h();if(o=="#div_traderResources"){showTradeNowButton()}})}else{d=false;$("#planet").css("background-position",traderObj.traderBGPos[o]).css("height","250px");h();if(o=="#div_traderResources"){showTradeNowButton()}}g.setPanel();$("#planet").addClass("detail");$(".js_trader").hide();$(o).show();if(o=="#div_traderResources"&&typeof(n)!="undefined"){$(o+" .ui-tabs").tabs("option","active",n)}traderObj.switchingTrader=false};if($(traderObj.traderId).length==0){var b=p.toLowerCase().replace(/^trader/,"");$.ajax({url:traderUrl,type:"POST",data:{show:b,ajax:1},beforeSend:function(){$("#loadingOverlay").addClass(b).show()},success:function(h){$("#inhalt").append(h);$("#loadingOverlay").hide().removeClass(b);c()},error:function(){fadeBox(loca.error,true);$("#loadingOverlay").hide().removeClass(b)}})}else{c()}},submitAuction:function(){var c=traderObj.traderId;var b=getValue($(c+" .js_auctioneerSum").html());if(!$(c+" .right_box .pay").hasClass("disabled")&&traderObj.price>0&&traderObj.deficit<=0){$(c+" .right_box .pay").addClass("disabled");var k={planets:{},honor:traderObj.honorOutput};for(var a in traderObj.planets){k.planets[a]=traderObj.planets[a].output}$.ajax({url:auctionUrl,type:"POST",data:{bid:k,token:auctioneerToken,ajax:1},dataType:"json",success:function(h){auctioneerToken=h.newToken;fadeBox(h.message,h.error);if(!h.error){traderObj.resetValues(c,false);traderObj.resetMaxAmount(h.planetResources,h.honor);traderObj.reloadResources()}},error:function(){fadeBox(loca.error,true)}})}return false},submitImportExport:function(){if(!$(traderObj.traderId+" .right_box .pay").hasClass("disabled")){$(traderObj.traderId+" .right_box .pay").addClass("disabled");var a={planets:{},honor:traderObj.honorOutput};for(planetId in traderObj.planets){a.planets[planetId]=traderObj.planets[planetId].output}$.ajax({url:importUrl,type:"POST",data:{action:"trade",bid:a,token:importToken,ajax:1},dataType:"json",success:function(b){importToken=b.newToken;fadeBox(b.message,b.error);if(!b.error){for(planetId in traderObj.planets){traderObj.planets[planetId].output={metal:0,crystal:0,deuterium:0}}$(traderObj.traderId+" .bargain_overlay").show();$(traderObj.traderId+" .payment").hide();$(traderObj.traderId+" .image_140px a").addClass("slideIn");traderObj.reloadResources();traderObj.updateImportItem(b.item);traderObj.refresh()}},error:function(){fadeBox(loca.error,true)}})}return false},reloadResources:function(a){getAjaxResourcebox(a)},changeImportItem:function(){if($(traderObj.traderId+" .import_bargain.change").hasClass("disabled")){if(darkMatter<importChangeCost){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium)}}else{$(traderObj.traderId+" .import_bargain.change").addClass("disabled");$.ajax({url:importUrl,type:"POST",data:{action:"bargain",token:importToken,ajax:1},dataType:"json",success:function(a){importToken=a.newToken;fadeBox(a.message,a.error);if(!a.error){traderObj.updateImportItem(a.item);traderObj.reloadResources(function(){if(a.item.offersLeft>0&&darkMatter>=importChangeCost){$(traderObj.traderId+" .import_bargain.change").removeClass("disabled")}else{$(traderObj.traderId+" .import_bargain.change").addClass("disabled")}});traderObj.refresh()}},error:function(){fadeBox(loca.error,true)}})}return false},updateImportItem:function(a){$(traderObj.traderId+" .got_item_text").html(a.itemText);$(traderObj.traderId+" .bargain_text").html(a.bargainText);$(traderObj.traderId+" .bargain_cost").html(a.bargainCostText);importChangeCost=a.bargainCost;$(traderObj.traderId+" .image_140px img").attr("src","/cdn/img/item-images/"+a.image+"-140x.png");removeTooltip($(traderObj.traderId+" .image_140px a"));$(traderObj.traderId+" .image_140px a").attr("ref",a.uuid).removeClass("tooltip").addClass("tooltipHTML").attr("title",a.tooltip);initTooltips($(traderObj.traderId+" .image_140px a"));$(traderObj.traderId+" .detail_button .amount").text(a.amount)},takeImportItem:function(){if(!$(traderObj.traderId+" .import_bargain.take").hasClass("disabled")){$(traderObj.traderId+" .import_bargain.change").addClass("disabled");$(traderObj.traderId+" .import_bargain.take").addClass("disabled");$(traderObj.traderId+" .import_bargain.change").addClass("hidden");$(traderObj.traderId+" .import_bargain.take").addClass("hidden");$(traderObj.traderId+" .bargain_cost").addClass("hidden");$.ajax({url:importUrl,type:"POST",data:{action:"takeItem",token:importToken,ajax:1},dataType:"json",success:function(a){importToken=a.newToken;fadeBox(a.message,a.error);if(!a.error){var b=a.item.ref;changeTooltip($(".detail_button[ref='"+b+"']"),a.item.title);$(".detail_button[ref='"+b+"'] span.amount, #itemDetails[data-uuid='"+b+"'] span.amount").html(tsdpkt(a.item.amount));if(a.item.canBeActivated){$('#itemDetails[data-uuid="'+b+'"] a.activateItem').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem').addClass("build-it_disabled").removeClass("build-it")}if(a.item.newOffer==false){$(traderObj.traderId+" .bargain_text").html(a.item.noOfferMessage)}else{traderObj.resetImport(a.item.newOffer)}}},error:function(){fadeBox(loca.error,true)}})}return false},resetImport:function(a){importChangeCost=a.bargainCost;if(darkMatter>=importChangeCost){$(traderObj.traderId+" .import_bargain.change").removeClass("disabled")}else{$(traderObj.traderId+" .import_bargain.change").addClass("disabled")}$(traderObj.traderId+" .import_bargain.take").removeClass("disabled");$(traderObj.traderId+" .import_bargain.change").removeClass("hidden");$(traderObj.traderId+" .import_bargain.take").removeClass("hidden");$(traderObj.traderId+" .bargain_cost").removeClass("hidden");$(traderObj.traderId+" .bargain_overlay").hide();$(traderObj.traderId+" .payment").show();$(traderObj.traderId+" .image_140px img").attr("src","/cdn/img/trader/container_"+a.rarity+".jpg");$(traderObj.traderId+" .image_140px a").removeClass("slideIn").attr("ref","").removeClass("tooltipHTML").addClass("tooltip").removeClass("r_common_140px").removeClass("r_uncommon_140px").removeClass("r_rare_140px").removeClass("r_epic_140px").removeClass("r_buddy_140px").addClass("r_"+a.rarity+"_140px");changeTooltip($(traderObj.traderId+" .image_140px a"),a.tooltip);$(traderObj.traderId+" .js_import_price").removeClass("green_text").text(number_format(a.price,0));$(traderObj.traderId+" .image_140px .amount").text("?");traderObj.priceImportExport=getValue($(".js_import_price").html());traderObj.resetValues(null,true);traderObj.init()},sumAuctioneer:function(){var l=traderObj.traderId;var a=traderObj.price;if(a==0){$("#div_traderAuctioneer .js_amount").attr("disabled","disabled")}else{$("#div_traderAuctioneer .js_amount").removeAttr("disabled")}var c=0;for(var b in traderObj.planets){var m=traderObj.planets[b].output;c+=parseInt(m.metal)*multiplier.metal+parseInt(m.crystal)*multiplier.crystal+parseInt(m.deuterium)*multiplier.deuterium}c+=parseInt(traderObj.honorOutput)*multiplier.honor;c=Math.floor(c);traderObj.deficit=(Number(auctioneer.calculateDeficit())-Number(c));if(traderObj.deficit>0){$(" .js_deficit").html(number_format(traderObj.deficit,0))}else{$(" .js_deficit").html(number_format(0,0))}if(c>0){$("#div_traderAuctioneer .js_auctioneerSum").html("+ "+number_format(c,0))}else{$("#div_traderAuctioneer .js_auctioneerSum").html("")}$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(Math.floor(playerBid+c),0));if(a>0&&traderObj.deficit<=0){$("#div_traderAuctioneer .right_box .pay").removeClass("disabled")}else{$("#div_traderAuctioneer .right_box .pay").addClass("disabled")}},sumImportExport:function(){var o=traderObj.traderId;var n=0;var a=0;var b=0;traderObj.sumResources=0;for(var c in traderObj.planets){var p=traderObj.planets[c].output;n+=parseInt(p.metal)*multiplier.metal;a+=parseInt(p.crystal)*multiplier.crystal;b+=parseInt(p.deuterium)*multiplier.deuterium}var q=traderObj.honorOutput*multiplier.honor;traderObj.sumResources+=n+a+b+q;if(traderObj.sumResources>=traderObj.priceImportExport){traderObj.sumResources=traderObj.priceImportExport}$(o+" .js_sum_price").html(number_format(Math.floor(traderObj.sumResources),0));if(traderObj.sumResources>=traderObj.priceImportExport){$(o+" .js_import_price").addClass("green_text");$(o+" .right_box .pay").removeClass("disabled")}else{$(o+" .js_import_price").removeClass("green_text");$(o+" .right_box .pay").addClass("disabled")}},updateValues:function(x){var c=traderObj.traderId;if(c!=="#"+x.closest(".div_trader").attr("id")){return}var s=x.attr("class");var a=new RegExp(/\b(js_slider\w*)\b/);s=(a.test(s))?RegExp.$1:false;if(!s){return}var u=traderObj.current.planet;var q,b,w;if(s.indexOf("More")!=-1){w=s.replace("More","");q="More"}else{if(s.indexOf("Max")!=-1){w=s.replace("Max","");q="Max"}}traderObj.current.resource=w.replace("js_slider","").toLowerCase()||null;var v=traderObj.current.resource;var r=0;if(v=="honor"){r=Math.max(0,honorScore)}else{r=traderObj.planets[u].input[v]}b=getValue($(c+" ."+w+"Input").val());if(q=="More"){if(c=="#div_traderImportExport"){if(traderObj.sumResources<=traderObj.priceImportExport-1000*multiplier[v]){b+=1000}else{if(traderObj.sumResources<traderObj.priceImportExport){b+=Math.ceil((traderObj.priceImportExport-traderObj.sumResources)/multiplier[v])}}}else{if(c=="#div_traderAuctioneer"&&traderObj.price>0){b+=1000}}if(b>=r){b=Math.max(0,r)}}else{if(q=="Max"){if(c=="#div_traderImportExport"){if(traderObj.sumResources==0){b=Math.min(r,Math.ceil(traderObj.priceImportExport/multiplier[v]))}else{if(traderObj.sumResources.isBetween(0,traderObj.priceImportExport-1)){b=Math.min(r,b+Math.ceil((traderObj.priceImportExport-traderObj.sumResources)/multiplier[v]));b=Math.max(0,b)}}}else{if(c=="#div_traderAuctioneer"&&traderObj.price>0){b=Math.min(r,Math.ceil(getValue($(c+" .js_deficit").html())/multiplier[v]+b))}}if(v=="honor"&&b<0){b=0}}}$(c+" .js_amount."+w+"Input").val(number_format(b,0));if(v=="honor"){traderObj.honorOutput=b}else{traderObj.planets[u].output[v]=b}if(c=="#div_traderImportExport"){traderObj.sumImportExport()}else{if(c=="#div_traderAuctioneer"&&traderObj.price>0){traderObj.sumAuctioneer();traderObj.checkOverbidden()}}},updateValuesInputCanged:function(C){var c=traderObj.traderId;if(c!=="#"+C.closest(".div_trader").attr("id")){return}var w=C.attr("class");var a=new RegExp(/\b(js_slider\w*)\b/);w=(a.test(w))?RegExp.$1:false;if(!w){return}var B=w.replace("Input","");var y=B.replace("js_slider","").toLowerCase();var x=traderObj.current.planet;var v=0;if(y=="honor"){v=Math.max(0,honorScore)}else{v=parseInt(traderObj.planets[x].input[y])}var b=0;if(c=="#div_traderImportExport"){var u=0;for(var s in traderObj.planets){var A=traderObj.planets[s].output;if(y!="metal"){u+=Math.floor(parseInt(A.metal)*multiplier.metal)}if(y!="crystal"){u+=Math.floor(parseInt(A.crystal)*multiplier.crystal)}if(y!="deuterium"){u+=Math.floor(parseInt(A.deuterium)*multiplier.deuterium)}}b=Math.min(getValue(C.val()),Math.ceil((traderObj.priceImportExport-u)/multiplier[y]))}else{if(c=="#div_traderAuctioneer"){b=getValue(C.val())}}b=Math.min(b,v);traderObj.planets[x].output[y]=b;if(y=="honor"){traderObj.honorOutput=b}else{traderObj.planets[x].output[y]=b}if(c=="#div_traderImportExport"){traderObj.sumImportExport()}else{if(c=="#div_traderAuctioneer"){traderObj.sumAuctioneer();traderObj.checkOverbidden()}}formatNumber(c+" .js_amount."+B+"Input",b)},init:function(){$(".honorResource").hide();$("#menuTable a.trader").unbind("click.gotoTrader").bind("click.gotoTrader",function(a){a.preventDefault();traderObj.switchTrader("traderResources")});$(window).unbind("hashchange.switchTrader").bind("hashchange.switchTrader",function(a){var b=$.deparam.fragment(a.fragment);if(typeof(b.page)=="undefined"||b.page==""&&traderObj.traderId!=null){traderObj.returnToOverview()}else{traderObj.switchTrader(b.page)}});$(".small_back_to_overview").unbind("mouseenter").unbind("mouseout").bind("mouseenter",function(){$("#header_text").css("background-position","0 -250px")}).bind("mouseout",function(){$("#header_text").css("background-position","0 0")})},initSliderTrader:function(a){$(a+" .js_valButton").unbind("click.valControl");$(a+" .js_amount").unbind("keyup.inputVal");g.init(a);$(a+" .js_valButton").bind("click.valControl",function(b){traderObj.updateValues($(this));b.stopPropagation()});$(a+" .js_amount").bind("keyup.inputVal",function(b){traderObj.updateValuesInputCanged($(this));b.stopPropagation()})},initImportExport:function(){traderObj.planets=planetResources;traderObj.priceImportExport=getValue($(".js_import_price").html());traderObj.initSliderTrader("#div_traderImportExport");$("#div_traderImportExport .right_box .pay").bind("click",function(){traderObj.submitImportExport()});$("#div_traderImportExport .import_bargain.change").bind("click",function(){traderObj.changeImportItem()});$("#div_traderImportExport .import_bargain.take").bind("click",function(){traderObj.takeImportItem()})},switchTrader:function(a){if(traderObj.switchingTrader){return}traderObj.switchingTrader=true;Tipped.hideAll();$("#planet .close_details:visible").click();if("#div_"+a==traderObj.traderId){return}if(traderObj.traderId!=null||a==""||a==null){traderObj.returnToOverview();if(animation&&!d){setTimeout(function(){traderObj.selectTrader(a)},500)}else{traderObj.selectTrader(a)}}else{traderObj.selectTrader(a)}},returnToOverview:function(){Tipped.hideAll();$("#planet #header_text h2").empty().parent().hide();$("#traderOverview").find(".c-left, .c-right").hide();var a=traderObj.traderId;if(!a){return}$(a).hide();$("#callTrader").hide();if(animation&&!d){$("#planet h2").hide();$("#planet").animate({backgroundPosition:"-273px 0px",height:"470px"},500,function(){$("#planet h2").show();$("#planet").removeClass("detail");$("#traderOverview").find(".c-left, .c-right").show();$(".js_trader").show()})}else{$("#planet").removeClass("detail").css("background-position","-273px 0px").css("height","470px");$(".js_trader").show()}$("#planet a").show();$("#planet .back_to_overview").hide();removeTooltip($("#planet .back_to_overview"));$("#traderOverview").find(".c-left, .c-right").removeClass("c-small");traderObj.traderId=null;traderObj.switchingTrader=false}};breakerObj={costs:null,offer:null,ships:{},locked:false,lastTechId:null,initialize:function(){this.offer=parseInt($(".scrap_offer_amount").html());this.costs=breakerCosts;var a=this;$("#js_anythingSliderShips, #js_anythingSliderDefense").anythingSlider({startStopped:true,buildStartStop:false,expand:true,resizeContents:false,theme:"default",infiniteSlides:false,autoPlay:false,easing:"swing",resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,buildNavigation:false,onInitialized:function(u,y){if(isMobile){var x=1000,v=50,s=0,c=0,w="ontouchend" in document,b=(w)?"touchstart":"mousedown",r=(w)?"touchmove":"mousemove",A=(w)?"touchend":"mouseup";y.$window.bind(b,function(h){c=(new Date()).getTime();s=h.originalEvent.touches?h.originalEvent.touches[0].pageX:h.pageX}).bind(A,function(h){c=0;s=0}).bind(r,function(k){k.preventDefault();var h=k.originalEvent.touches?k.originalEvent.touches[0].pageX:k.pageX,l=(s===0)?0:Math.abs(h-s),m=(new Date()).getTime();if(c!==0&&m-c<x&&l>v){if(h<s){y.goForward()}if(h>s){y.goBack()}c=0;s=0}})}}});$("#js_anythingSliderDefense").parent().parent().hide();$(".scrap_defense").bind("click.tabDefense",function(){$(".scrap_ships").removeClass("selected");$(this).addClass("selected");$("#js_anythingSliderShips").parent().parent().hide();$("#js_anythingSliderDefense").parent().parent().show()});$(".scrap_ships").bind("click.tabShips",function(){$(".scrap_defense").removeClass("selected");$(this).addClass("selected");$("#js_anythingSliderDefense").parent().parent().hide();$("#js_anythingSliderShips").parent().parent().show()});$(".buildingimg a").each(function(){var k=$(this).attr("ref").substr(6,3);var b=$(this).find(".level");var c=b.contents().filter(function(){return this.nodeType==3});a.ships[k]=c.text().replace(/^\s+|\s+$/g,"");c.remove();b.append(tsdpkt(a.ships[k]))});$("#js_scrapBargain").unbind("click").bind("click",function(){if(!$(this).hasClass("disabled")){a.bargain(a)}return false});$("#js_scrapScrapIT").unbind("click").bind("click",function(){if(!$(this).hasClass("disabled")){a.trade(a)}return false});$("input.ship_amount").unbind("focus").bind("focus",function(){a.lastTechId=$(this).attr("name").substr(2,3);$(this).val("")});$("input.ship_amount").unbind("keyup change").bind("keyup change",function(c){a.lastTechId=$(this).attr("name").substr(2,3);formatNumber(this,$(this).val());var b=$(this);clearTimeout(b.data("timer"));b.data("timer",setTimeout(function(){b.removeData("timer");a.updateResources(a)},300))});$(".buildingimg a").unbind("click").bind("click",function(){return false});$(".js_maxShips").unbind("click").bind("click",function(){if(!isMobile){$($(this).attr("ref")).focus()}var b=a.ships[$(this).attr("ref").substr(6,3)];$($(this).attr("ref")).val(tsdpkt(b)).trigger("change");a.updateResources(a);return false});$(".sendAll").unbind("click").bind("click",function(){$(".anythingSlider ul:visible input").each(function(){a.lastTechId=$(this).attr("name").substr(2,3);var b=a.ships[a.lastTechId];$(this).val(tsdpkt(b))});a.updateResources(a,function(b){if(b.error){$(".anythingSlider ul:visible input").val("");$("#div_traderScrap .resource_amount").text(0);a.checkShips(a)}})});$(".sendNone").unbind("click").bind("click",function(){$(".anythingSlider ul:visible input").each(function(){a.lastTechId=$(this).attr("name").substr(2,3);$(this).val("")});a.updateResources(a)});$("#js_bargainCost").text(tsdpkt(this.costs));this.checkMoney(this);this.checkShips(this);this.updateBargain(this)},bargain:function(a){$("#js_scrapBargain").addClass("disabled");$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{bargain:1,token:breakerToken},beforeSend:function(){a.lock(a)},success:function(b){a.unlock(a);breakerToken=b.newToken;fadeBox(b.message,b.error);if(!b.error){a.costs=b.bargainPrice;a.offer=b.percentage;darkMatter=b.resources.dm;a.updateBargain(a);a.updateResources(a);traderObj.reloadResources(function(){a.checkMoney(a);Tipped.show($("#js_scrapBargain")[0])})}$(".scrap_trader_quote").text(b.quote)},error:function(){a.unlock(a)}})},trade:function(a){a.lock(a);var b=a.getTradeArray();var c=function c(){var l=loca.breakerQuestion+'<br/><br/><div style="text-align: left; margin-left: 30px">';var m=0;$.each(b,function(h){l+=this+"x "+loca.shipNames[h]+", ";m++;if(m%2==0){l+="<br/>"}});l=l.replace(/, (<br\/>)?$/,"");l+="</div>";return l};errorBoxDecision(loca.breaker,c(),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:a.lastTechId,finishTrade:1,trade:b,token:breakerToken},success:function(k){a.unlock(a);breakerToken=k.newToken;if(k.error){fadeBox(k.message,true)}else{fadeBox(k.message,false);a.offer=k.percentage;a.costs=k.bargainPrice;a.resetForm();a.updateBargain(a);$("#js_scrapAmountMetal").html(0);$("#js_scrapAmountCrystal").html(0);$("#js_scrapAmountDeuterium").html(0);traderObj.reloadResources(function(){a.updateShips(a)})}$(".scrap_trader_quote").text(k.quote)},error:function(){a.unlock(a);fadeBox(loca.error,true)}})},function(){a.unlock(a)})},updateResources:function(b,a){if(b.locked){return}$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:b.lastTechId,trade:b.getTradeArray(),token:breakerToken},beforeSend:function(){b.lock(b)},success:function(c){breakerToken=c.newToken;if(c.error){fadeBox(c.message,true)}b.locked=false;var l=false;for(var m in c.techAmount){$("#ship_"+m).val(tsdpkt(c.techAmount[m]));if(!l&&$("#ship_"+m).val()!=b.ships[m]){l=true}}$("#js_scrapAmountMetal").html(tsdpkt(c.resources.metal));$("#js_scrapAmountCrystal").html(tsdpkt(c.resources.crystal));$("#js_scrapAmountDeuterium").html(tsdpkt(c.resources.deuterium));if(!b.notFirstOffer){$(".scrap_trader_quote").text(loca.breakerFirstOffer);b.notFirstOffer=true}if(l){b.updateShips(b)}else{b.unlock(b)}if(typeof(a)=="function"){a(c)}},error:function(){b.unlock(b)}})},updateShips:function(a){$.ajax({url:techUrl,type:"POST",dataType:"json",beforeSend:function(){a.lock(a)},success:function(b){$("#div_traderScrap .item").each(function(){var o=$(this).attr("id").substr(6,3);if(typeof(b[o])!="undefined"){var n=0;if(b[o]!=null){n=getValue(b[o])}a.ships[o]=n;var c=$(this).find(".level");c.contents().filter(function(){return this.nodeType==3}).remove();c.append(tsdpkt(n));if(b[o]!=null){var m=$("#button"+o);m.removeClass("on").removeClass("off");if(n>0){m.addClass("on")}else{m.addClass("off")}}}});a.unlock(a)},error:function(){a.unlock(a)}})},getTradeArray:function(){var a={};$("input.ship_amount").each(function(){var b=$(this).attr("name").substr(2,3);if(getValue($(this).val())!=0){a[b]=getValue($(this).val())}});return a},resetForm:function(){$("input.ship_amount").each(function(){$(this).val("0")});removeTooltip($("#js_scrapBargain"));$("#js_scrapBargain").removeClass("tooltip").removeAttr("title")},checkMoney:function(a){if(darkMatter<a.costs){$("#js_scrapBargain").addClass("disabled")}else{if(breakerMaximumPercent<=a.offer){$("#js_scrapBargain").addClass("disabled").addClass("tooltip").attr("title",loca.infoMaxBargain);initTooltips($("#js_scrapBargain"))}else{$("#js_scrapBargain").removeClass("disabled")}}},checkShips:function(a){var b=false;$("input.ship_amount").each(function(){if($(this).val().length>0&&getValue($(this).val())>0){b=true}});if(!b){$("#js_scrapScrapIT").addClass("disabled")}else{$("#js_scrapScrapIT").removeClass("disabled")}},updateBargain:function(a){$(".scrap_offer_amount").css("height",a.offer/100*$(".scrap_offer_amount").parent().css("height").replace("px",""));$(".scrap_offer_amount").html(a.offer+"%");$(".js_bargainCost").text(tsdpkt(a.costs))},lock:function(a){$("#js_scrapBargain").addClass("disabled");$("#js_scrapScrapIT").addClass("disabled");a.locked=true},unlock:function(a){a.locked=false;a.checkShips(a);a.checkMoney(a)}};auctioneer={socket:null,connected:false,timeout:null,retryInterval:5000,historyShown:false,initConnection:function(){try{var a=auctioneer;this.socket=new io.connect("/auctioneer",nodeParams);this.socket.on("connect",function(){a.connected=true;clearTimeout(this.timeout)});this.socket.on("disconnect",function(){a.connected=false;a.retryConnection()});this.socket.on("new auction",function(c){auctionId=c.auctionId;var o=$("#div_traderAuctioneer .detail_value.currentPlayer").html();if(c.oldAuction.player==null){o=loca.auctionNotSold}else{o='<a href="'+c.oldAuction.player.link+'">'+c.oldAuction.player.name+"</a>"}removeTooltip($("#div_traderAuctioneer .image_140px .detail_button"));var s=$("#div_traderAuctioneer .image_140px .detail_button").attr("title");var p=$(".auction_history li:first").hasClass("even")?"odd":"even";var q='                        <li class="'+p+'" style="display: none">                            <a href="javascript:void(0);"                               class="slideIn"                               ref="'+c.oldAuction.item.uuid+'">                                <img height="30" width="30"                                     src="/cdn/img/item-images/'+c.oldAuction.item.imageSmall+'-small.png"                                     alt="" title="'+s+'"                                     class="item_img tooltipHTML tooltipLeft r_'+c.oldAuction.item.rarity+'"/>                            </a>                            <span class="detail sum">'+number_format(c.oldAuction.sum,0)+'</span>                            <span class="detail player">'+o+'</span>                            <span class="detail date_time">'+c.oldAuction.time+"</span>                        </li>";$(".auction_history .history_content ul").prepend(q);$(".auction_history .history_content li:first").slideDown("slow");var r=$("#div_traderAuctioneer .auction_history li").length;if(r>3){$(".auction_history .history_content li:last").slideUp("slow",function(){$(".auction_history .history_content li:eq(21)").remove();var h=$(".auction_history .history_content li:eq(3)");h.addClass("more_auctions_li");if(auctioneer.historyShown){h.show()}});$("#div_traderAuctioneer .auction_history .more").show()}$("#div_traderAuctioneer .image_140px .detail_button").attr("ref",c.item.uuid).attr("title","").removeClass("r_common_140px").removeClass("r_uncommon_140px").removeClass("r_rare_140px").removeClass("r_epic_140px").addClass("r_"+c.item.rarity+"_140px");$("#div_traderAuctioneer .image_140px img").attr("src","/cdn/img/item-images/"+c.item.image+"-140x.png");$("#div_traderAuctioneer .left_header h2").html(loca.auctionRunning);a.setItemTooltip($("#div_traderAuctioneer .image_140px .detail_button"));a.setData({price:1000,sum:0,player:null,bids:0,info:c.info});$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(0,0));$(".noAuctionOverlay").hide();traderObj.resetValues("#div_traderAuctioneer",false);traderObj.checkOverbidden()});this.socket.on("new bid",function(c){if(c.player.id==playerId){playerBid=c.sum;AuctionIdOflastPlayerBid=c.auctionId;$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(Math.floor(playerBid),0))}a.setData({price:c.price,sum:c.sum,player:c.player,bids:c.bids});traderObj.checkOverbidden()});this.socket.on("auction finished",function(c){a.setData({price:0,player:c.player,bids:c.bids,info:c.info});traderObj.resetValues("#div_traderAuctioneer",false);$("#div_traderAuctioneer .js_alreadyBidden").html(number_format(0,0));$("#div_traderAuctioneer .js_auctioneerSum").html("");$("#div_traderAuctioneer .left_header h2").html(loca.auctionFinished);if(c.player!=null){if(c.player.id==playerId){a.setItemTooltip($("#div_traderAuctioneer .image_140px .detail_button"))}}$(".noAuctionOverlay").show();traderObj.checkOverbidden()});this.socket.on("timeLeft",function(c){a.setData({info:c})})}catch(b){}},setItemTooltip:function(a){$.ajax({url:detailUrl,data:{getDetails:1,type:$(a).attr("ref"),ajax:1},dataType:"json",success:function(b){changeTooltip(a,b.title);$("#itemDetails[data-uuid='"+$(a).attr("ref")+"'] .amount,a.detail_button[ref='"+$(a).attr("ref")+"'] .amount").html(tsdpkt(b.amount))},error:function(){fadeBox(loca.error,true)}})},initialize:function(){traderObj.initSliderTrader("#div_traderAuctioneer");traderObj.planets=planetResources;traderObj.price=getValue($(".js_price").html());$("#div_traderAuctioneer .right_box .pay").bind("click",function(){traderObj.submitAuction()});$("#div_traderAuctioneer .auction_history .more").bind("click",function(){if(auctioneer.historyShown){$(this).text("["+loca.auctionShowMore+"]")}else{$(this).text("["+loca.auctionShowLess+"]")}auctioneer.historyShown=!auctioneer.historyShown;$("#div_traderAuctioneer .auction_history .more_auctions_li").slideToggle("slow")});traderObj.sumAuctioneer();traderObj.checkOverbidden();this.initCountdown();loadScript(nodeUrl,this.initConnection)},retryConnection:function(){var a=this;setTimeout(function(){a.initConnection()},5000)},setData:function(a){var b=false;if(typeof(a.player)!="undefined"){if(a.player==null){$("#div_traderAuctioneer .detail_value.currentPlayer").text("");$("#div_traderAuctioneer .detail_value.currentPlayer").attr("href","")}else{$("#div_traderAuctioneer .detail_value.currentPlayer").text(a.player.name);$("#div_traderAuctioneer .detail_value.currentPlayer").attr("href",a.player.link);$("#div_traderAuctioneer .detail_value.currentPlayer").attr("data-player-id",a.player.id);$("#div_traderAuctioneer .detail_value.currentPlayer").data("playerId",a.player.id)}b=true}if(typeof(a.price)!=="undefined"){traderObj.price=a.price;$("#div_traderAuctioneer .js_price").html(number_format(Math.floor(a.price),0));b=true}if(typeof(a.sum)!=="undefined"){$("#div_traderAuctioneer .detail_value.currentSum").html(number_format(Math.floor(a.sum),0));b=true}if(typeof(a.bids)!=="undefined"){$("#div_traderAuctioneer .detail_value.numberOfBids").html(number_format(a.bids,0));b=true}if(typeof(a.info)!=="undefined"&&$.trim($("#div_traderAuctioneer .auction_info").html())!=a.info){$("#div_traderAuctioneer .auction_info").html(a.info);this.initCountdown();b=true}if(b){this.flash();traderObj.sumAuctioneer()}},initCountdown:function(){if(typeof(this.nextAuctionTimer)=="object"){timerHandler.removeCallback(this.nextAuctionTimer.timer)}if($(".nextAuction").length>0){this.nextAuctionTimer=new simpleCountdown($(".nextAuction").get(0),$(".nextAuction").text())}},flash:function(){if(traderObj.traderId=="#div_traderAuctioneer"){$("#div_traderAuctioneer .overlay").fadeIn("normal",function(){$(this).fadeOut("normal")})}},calculateDeficit:function(){var a=0;if(Math.floor(traderObj.price)==0){a=0}else{if(auctionId!=AuctionIdOflastPlayerBid){a=Math.floor(traderObj.price)}else{a=Math.floor(traderObj.price)-Math.floor(playerBid)}}return Math.floor(a)}};$(".js_trader").hover(function(){var a=$(this).attr("id").replace("js_trader","").toLowerCase();$(this).addClass(a+"_link_hover")},function(){var a=$(this).attr("id").replace("js_trader","").toLowerCase();$(".trader_link").each(function(c,b){$(this).removeClass(a+"_link_hover")})});$(".right_box .pay, .value-control, .ui-slider-handle, .bargain, .scrap_it, .source").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});traderObj.init();$(document).undelegate(".js_trader","click").delegate(".js_trader","click",function(){var a=$(this).attr("id").replace("js_","");traderObj.switchTrader(a)}).undelegate("#planet .js_backToOverview","click").delegate("#planet .js_backToOverview","click",function(){$.bbq.pushState({page:"",animation:""});$(".planetlink, .moonlink").fragment({page:"",animation:""})});var f=$.deparam.fragment();if(typeof(f.page)!="undefined"&&f.page!=""){traderObj.selectTrader(f.page,undefined,f.tab)}};